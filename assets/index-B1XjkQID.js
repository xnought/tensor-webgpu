(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const s of i)if(s.type==="childList")for(const a of s.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&r(a)}).observe(document,{childList:!0,subtree:!0});function n(i){const s={};return i.integrity&&(s.integrity=i.integrity),i.referrerPolicy&&(s.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?s.credentials="include":i.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function r(i){if(i.ep)return;i.ep=!0;const s=n(i);fetch(i.href,s)}})();const xn=!1;var Lt=Array.isArray,kr=Array.prototype.indexOf,qt=Array.from,Br=Object.defineProperty,Me=Object.getOwnPropertyDescriptor,Jn=Object.getOwnPropertyDescriptors,Dr=Object.prototype,Rr=Array.prototype,jt=Object.getPrototypeOf;function Tr(t){return t()}function yn(t){for(var e=0;e<t.length;e++)t[e]()}const Z=2,Xn=4,wt=8,Ht=16,re=32,Be=64,at=128,te=256,ut=512,G=1024,le=2048,be=4096,oe=8192,$t=16384,Ur=32768,Wt=65536,Cr=1<<17,Fr=1<<19,Zn=1<<20,Ie=Symbol("$state"),Gr=Symbol("legacy props"),Lr=Symbol("");function Qn(t){return t===this.v}function qr(t,e){return t!=t?e==e:t!==e||t!==null&&typeof t=="object"||typeof t=="function"}function zt(t){return!qr(t,this.v)}function jr(t){throw new Error("https://svelte.dev/e/effect_in_teardown")}function Hr(){throw new Error("https://svelte.dev/e/effect_in_unowned_derived")}function Wr(t){throw new Error("https://svelte.dev/e/effect_orphan")}function zr(){throw new Error("https://svelte.dev/e/effect_update_depth_exceeded")}function Yr(t){throw new Error("https://svelte.dev/e/props_invalid_value")}function Vr(){throw new Error("https://svelte.dev/e/state_descriptors_fixed")}function Kr(){throw new Error("https://svelte.dev/e/state_prototype_fixed")}function Jr(){throw new Error("https://svelte.dev/e/state_unsafe_local_read")}function Xr(){throw new Error("https://svelte.dev/e/state_unsafe_mutation")}let De=!1,Zr=!1;function Qr(){De=!0}const ei=1,ti=2,ni=16,ri=1,ii=2,si=4,ai=8,ui=16,er=1,oi=2,j=Symbol();function fi(t){throw new Error("https://svelte.dev/e/lifecycle_outside_component")}let N=null;function bn(t){N=t}function Yt(t,e=!1,n){N={p:N,c:null,e:null,m:!1,s:t,x:null,l:null},De&&!e&&(N.l={s:null,u:null,r1:[],r2:K(!1)})}function Vt(t){const e=N;if(e!==null){const a=e.e;if(a!==null){var n=M,r=P;e.e=null;try{for(var i=0;i<a.length;i++){var s=a[i];pe(s.effect),Ne(s.reaction),fr(s.fn)}}finally{pe(n),Ne(r)}}N=e.p,e.m=!0}return{}}function Ot(){return!De||N!==null&&N.l===null}function K(t,e){var n={f:0,v:t,reactions:null,equals:Qn,rv:0,wv:0};return n}function Kt(t,e=!1){var r;const n=K(t);return e||(n.equals=zt),De&&N!==null&&N.l!==null&&((r=N.l).s??(r.s=[])).push(n),n}function Fe(t,e=!1){return li(Kt(t,e))}function li(t){return P!==null&&!fe&&P.f&Z&&(Q===null?wi([t]):Q.push(t)),t}function T(t,e){return P!==null&&!fe&&Ot()&&P.f&(Z|Ht)&&(Q===null||!Q.includes(t))&&Xr(),tr(t,e)}function tr(t,e){return t.equals(e)||(t.v,t.v=e,t.wv=mr(),nr(t,le),Ot()&&M!==null&&M.f&G&&!(M.f&(re|Be))&&(ae===null?$i([t]):ae.push(t))),e}function nr(t,e){var n=t.reactions;if(n!==null)for(var r=Ot(),i=n.length,s=0;s<i;s++){var a=n[s],o=a.f;o&le||!r&&a===M||(ne(a,e),o&(G|te)&&(o&Z?nr(a,be):It(a)))}}let ci=!1;function Ee(t,e=null,n){if(typeof t!="object"||t===null||Ie in t)return t;const r=jt(t);if(r!==Dr&&r!==Rr)return t;var i=new Map,s=Lt(t),a=K(0);s&&i.set("length",K(t.length));var o;return new Proxy(t,{defineProperty(f,u,c){(!("value"in c)||c.configurable===!1||c.enumerable===!1||c.writable===!1)&&Vr();var d=i.get(u);return d===void 0?(d=K(c.value),i.set(u,d)):T(d,Ee(c.value,o)),!0},deleteProperty(f,u){var c=i.get(u);if(c===void 0)u in f&&i.set(u,K(j));else{if(s&&typeof u=="string"){var d=i.get("length"),l=Number(u);Number.isInteger(l)&&l<d.v&&T(d,l)}T(c,j),wn(a)}return!0},get(f,u,c){var p;if(u===Ie)return t;var d=i.get(u),l=u in f;if(d===void 0&&(!l||(p=Me(f,u))!=null&&p.writable)&&(d=K(Ee(l?f[u]:j,o)),i.set(u,d)),d!==void 0){var h=E(d);return h===j?void 0:h}return Reflect.get(f,u,c)},getOwnPropertyDescriptor(f,u){var c=Reflect.getOwnPropertyDescriptor(f,u);if(c&&"value"in c){var d=i.get(u);d&&(c.value=E(d))}else if(c===void 0){var l=i.get(u),h=l==null?void 0:l.v;if(l!==void 0&&h!==j)return{enumerable:!0,configurable:!0,value:h,writable:!0}}return c},has(f,u){var h;if(u===Ie)return!0;var c=i.get(u),d=c!==void 0&&c.v!==j||Reflect.has(f,u);if(c!==void 0||M!==null&&(!d||(h=Me(f,u))!=null&&h.writable)){c===void 0&&(c=K(d?Ee(f[u],o):j),i.set(u,c));var l=E(c);if(l===j)return!1}return d},set(f,u,c,d){var A;var l=i.get(u),h=u in f;if(s&&u==="length")for(var p=c;p<l.v;p+=1){var b=i.get(p+"");b!==void 0?T(b,j):p in f&&(b=K(j),i.set(p+"",b))}l===void 0?(!h||(A=Me(f,u))!=null&&A.writable)&&(l=K(void 0),T(l,Ee(c,o)),i.set(u,l)):(h=l.v!==j,T(l,Ee(c,o)));var $=Reflect.getOwnPropertyDescriptor(f,u);if($!=null&&$.set&&$.set.call(d,c),!h){if(s&&typeof u=="string"){var v=i.get("length"),S=Number(u);Number.isInteger(S)&&S>=v.v&&T(v,S+1)}wn(a)}return!0},ownKeys(f){E(a);var u=Reflect.ownKeys(f).filter(l=>{var h=i.get(l);return h===void 0||h.v!==j});for(var[c,d]of i)d.v!==j&&!(c in f)&&u.push(c);return u},setPrototypeOf(){Kr()}})}function wn(t,e=1){T(t,t.v+e)}var $n,rr,ir;function di(){if($n===void 0){$n=window;var t=Element.prototype,e=Node.prototype;rr=Me(e,"firstChild").get,ir=Me(e,"nextSibling").get,t.__click=void 0,t.__className="",t.__attributes=null,t.__styles=null,t.__e=void 0,Text.prototype.__t=void 0}}function hi(t=""){return document.createTextNode(t)}function ue(t){return rr.call(t)}function Et(t){return ir.call(t)}function me(t,e){return ue(t)}function sr(t,e){{var n=ue(t);return n instanceof Comment&&n.data===""?Et(n):n}}function Ge(t,e=1,n=!1){let r=t;for(;e--;)r=Et(r);return r}function pi(t){t.textContent=""}function qe(t){var e=Z|le,n=P!==null&&P.f&Z?P:null;return M===null||n!==null&&n.f&te?e|=te:M.f|=Zn,{ctx:N,deps:null,effects:null,equals:Qn,f:e,fn:t,reactions:null,rv:0,v:null,wv:0,parent:n??M}}function se(t){const e=qe(t);return e.equals=zt,e}function ar(t){var e=t.effects;if(e!==null){t.effects=null;for(var n=0;n<e.length;n+=1)he(e[n])}}function gi(t){for(var e=t.parent;e!==null;){if(!(e.f&Z))return e;e=e.parent}return null}function mi(t){var e,n=M;pe(gi(t));try{ar(t),e=_r(t)}finally{pe(n)}return e}function ur(t){var e=mi(t),n=(ve||t.f&te)&&t.deps!==null?be:G;ne(t,n),t.equals(e)||(t.v=e,t.wv=mr())}function or(t){M===null&&P===null&&Wr(),P!==null&&P.f&te&&M===null&&Hr(),Qt&&jr()}function vi(t,e){var n=e.last;n===null?e.last=e.first=t:(n.next=t,t.prev=n,e.last=t)}function Ve(t,e,n,r=!0){var i=(t&Be)!==0,s=M,a={ctx:N,deps:null,nodes_start:null,nodes_end:null,f:t|le,first:null,fn:e,last:null,next:null,parent:i?null:s,prev:null,teardown:null,transitions:null,wv:0};if(n){var o=Pe;try{En(!0),Mt(a),a.f|=Ur}catch(c){throw he(a),c}finally{En(o)}}else e!==null&&It(a);var f=n&&a.deps===null&&a.first===null&&a.nodes_start===null&&a.teardown===null&&(a.f&(Zn|at))===0;if(!f&&!i&&r&&(s!==null&&vi(a,s),P!==null&&P.f&Z)){var u=P;(u.effects??(u.effects=[])).push(a)}return a}function Bt(t){or();var e=M!==null&&(M.f&re)!==0&&N!==null&&!N.m;if(e){var n=N;(n.e??(n.e=[])).push({fn:t,effect:M,reaction:P})}else{var r=fr(t);return r}}function _i(t){return or(),Jt(t)}function xi(t){const e=Ve(Be,t,!0);return(n={})=>new Promise(r=>{n.outro?ot(e,()=>{he(e),r(void 0)}):(he(e),r(void 0))})}function fr(t){return Ve(Xn,t,!1)}function On(t,e){var n=N,r={effect:null,ran:!1};n.l.r1.push(r),r.effect=Jt(()=>{t(),!r.ran&&(r.ran=!0,T(n.l.r2,!0),He(e))})}function yi(){var t=N;Jt(()=>{if(E(t.l.r2)){for(var e of t.l.r1){var n=e.effect;n.f&G&&ne(n,be),Re(n)&&Mt(n),e.ran=!1}t.l.r2.v=!1}})}function Jt(t){return Ve(wt,t,!0)}function rt(t,e=[],n=qe){const r=e.map(n);return Xt(()=>t(...r.map(E)))}function Xt(t,e=0){return Ve(wt|Ht|e,t,!0)}function je(t,e=!0){return Ve(wt|re,t,!0,e)}function lr(t){var e=t.teardown;if(e!==null){const n=Qt,r=P;An(!0),Ne(null);try{e.call(null)}finally{An(n),Ne(r)}}}function cr(t,e=!1){var n=t.first;for(t.first=t.last=null;n!==null;){var r=n.next;he(n,e),n=r}}function bi(t){for(var e=t.first;e!==null;){var n=e.next;e.f&re||he(e),e=n}}function he(t,e=!0){var n=!1;if((e||t.f&Fr)&&t.nodes_start!==null){for(var r=t.nodes_start,i=t.nodes_end;r!==null;){var s=r===i?null:Et(r);r.remove(),r=s}n=!0}cr(t,e&&!n),ht(t,0),ne(t,$t);var a=t.transitions;if(a!==null)for(const f of a)f.stop();lr(t);var o=t.parent;o!==null&&o.first!==null&&dr(t),t.next=t.prev=t.teardown=t.ctx=t.deps=t.fn=t.nodes_start=t.nodes_end=null}function dr(t){var e=t.parent,n=t.prev,r=t.next;n!==null&&(n.next=r),r!==null&&(r.prev=n),e!==null&&(e.first===t&&(e.first=r),e.last===t&&(e.last=n))}function ot(t,e){var n=[];Zt(t,n,!0),hr(n,()=>{he(t),e&&e()})}function hr(t,e){var n=t.length;if(n>0){var r=()=>--n||e();for(var i of t)i.out(r)}else e()}function Zt(t,e,n){if(!(t.f&oe)){if(t.f^=oe,t.transitions!==null)for(const a of t.transitions)(a.is_global||n)&&e.push(a);for(var r=t.first;r!==null;){var i=r.next,s=(r.f&Wt)!==0||(r.f&re)!==0;Zt(r,e,s?n:!1),r=i}}}function ft(t){pr(t,!0)}function pr(t,e){if(t.f&oe){t.f^=oe,t.f&G||(t.f^=G),Re(t)&&(ne(t,le),It(t));for(var n=t.first;n!==null;){var r=n.next,i=(n.f&Wt)!==0||(n.f&re)!==0;pr(n,i?e:!1),n=r}if(t.transitions!==null)for(const s of t.transitions)(s.is_global||e)&&s.in()}}let it=!1,lt=!1,ct=null,Pe=!1,Qt=!1;function En(t){Pe=t}function An(t){Qt=t}let Dt=[],Le=0;let P=null,fe=!1;function Ne(t){P=t}let M=null;function pe(t){M=t}let Q=null;function wi(t){Q=t}let H=null,Y=0,ae=null;function $i(t){ae=t}let gr=1,dt=0,ve=!1;function mr(){return++gr}function Re(t){var u;var e=t.f;if(e&le)return!0;if(e&be){var n=t.deps,r=(e&te)!==0;if(n!==null){var i,s,a=(e&ut)!==0,o=r&&M!==null&&!ve,f=n.length;if(a||o){for(i=0;i<f;i++)s=n[i],(a||!((u=s==null?void 0:s.reactions)!=null&&u.includes(t)))&&(s.reactions??(s.reactions=[])).push(t);a&&(t.f^=ut)}for(i=0;i<f;i++)if(s=n[i],Re(s)&&ur(s),s.wv>t.wv)return!0}(!r||M!==null&&!ve)&&ne(t,G)}return!1}function Oi(t,e){for(var n=e;n!==null;){if(n.f&at)try{n.fn(t);return}catch{n.f^=at}n=n.parent}throw it=!1,t}function Ei(t){return(t.f&$t)===0&&(t.parent===null||(t.parent.f&at)===0)}function At(t,e,n,r){if(it){if(n===null&&(it=!1),Ei(e))throw t;return}n!==null&&(it=!0);{Oi(t,e);return}}function vr(t,e,n=0){var r=t.reactions;if(r!==null)for(var i=0;i<r.length;i++){var s=r[i];s.f&Z?vr(s,e,n+1):e===s&&(n===0?ne(s,le):s.f&G&&ne(s,be),It(s))}}function _r(t){var h;var e=H,n=Y,r=ae,i=P,s=ve,a=Q,o=N,f=fe,u=t.f;H=null,Y=0,ae=null,P=u&(re|Be)?null:t,ve=(u&te)!==0&&(!Pe||(i===null||f)&&t.parent!==null),Q=null,bn(t.ctx),fe=!1,dt++;try{var c=(0,t.fn)(),d=t.deps;if(H!==null){var l;if(ht(t,Y),d!==null&&Y>0)for(d.length=Y+H.length,l=0;l<H.length;l++)d[Y+l]=H[l];else t.deps=d=H;if(!ve)for(l=Y;l<d.length;l++)((h=d[l]).reactions??(h.reactions=[])).push(t)}else d!==null&&Y<d.length&&(ht(t,Y),d.length=Y);if(Ot()&&ae!==null&&!(t.f&(Z|be|le)))for(l=0;l<ae.length;l++)vr(ae[l],t);return i!==null&&dt++,c}finally{H=e,Y=n,ae=r,P=i,ve=s,Q=a,bn(o),fe=f}}function Ai(t,e){let n=e.reactions;if(n!==null){var r=kr.call(n,t);if(r!==-1){var i=n.length-1;i===0?n=e.reactions=null:(n[r]=n[i],n.pop())}}n===null&&e.f&Z&&(H===null||!H.includes(e))&&(ne(e,be),e.f&(te|ut)||(e.f^=ut),ar(e),ht(e,0))}function ht(t,e){var n=t.deps;if(n!==null)for(var r=e;r<n.length;r++)Ai(t,n[r])}function Mt(t){var e=t.f;if(!(e&$t)){ne(t,G);var n=M,r=N;M=t;try{e&Ht?bi(t):cr(t),lr(t);var i=_r(t);t.teardown=typeof i=="function"?i:null,t.wv=gr;var s=t.deps,a;xn&&Zr&&t.f&le}catch(o){At(o,t,n,r||t.ctx)}finally{M=n}}}function Mi(){if(Le>1e3){Le=0;try{zr()}catch(t){if(ct!==null)At(t,ct,null);else throw t}}Le++}function Ii(t){var e=t.length;if(e!==0){Mi();var n=Pe;Pe=!0;try{for(var r=0;r<e;r++){var i=t[r];i.f&G||(i.f^=G);var s=[];xr(i,s),Pi(s)}}finally{Pe=n}}}function Pi(t){var e=t.length;if(e!==0)for(var n=0;n<e;n++){var r=t[n];if(!(r.f&($t|oe)))try{Re(r)&&(Mt(r),r.deps===null&&r.first===null&&r.nodes_start===null&&(r.teardown===null?dr(r):r.fn=null))}catch(i){At(i,r,null,r.ctx)}}}function Si(){if(lt=!1,Le>1001)return;const t=Dt;Dt=[],Ii(t),lt||(Le=0,ct=null)}function It(t){lt||(lt=!0,queueMicrotask(Si)),ct=t;for(var e=t;e.parent!==null;){e=e.parent;var n=e.f;if(n&(Be|re)){if(!(n&G))return;e.f^=G}}Dt.push(e)}function xr(t,e){var n=t.first,r=[];e:for(;n!==null;){var i=n.f,s=(i&re)!==0,a=s&&(i&G)!==0,o=n.next;if(!a&&!(i&oe))if(i&wt){if(s)n.f^=G;else{var f=P;try{P=n,Re(n)&&Mt(n)}catch(l){At(l,n,null,n.ctx)}finally{P=f}}var u=n.first;if(u!==null){n=u;continue}}else i&Xn&&r.push(n);if(o===null){let l=n.parent;for(;l!==null;){if(t===l)break e;var c=l.next;if(c!==null){n=c;continue e}l=l.parent}}n=o}for(var d=0;d<r.length;d++)u=r[d],e.push(u),xr(u,e)}function E(t){var e=t.f,n=(e&Z)!==0;if(P!==null&&!fe){Q!==null&&Q.includes(t)&&Jr();var r=P.deps;t.rv<dt&&(t.rv=dt,H===null&&r!==null&&r[Y]===t?Y++:H===null?H=[t]:H.push(t))}else if(n&&t.deps===null&&t.effects===null){var i=t,s=i.parent;s!==null&&!(s.f&te)&&(i.f^=te)}return n&&(i=t,Re(i)&&ur(i)),t.v}function He(t){var e=fe;try{return fe=!0,t()}finally{fe=e}}const Ni=-7169;function ne(t,e){t.f=t.f&Ni|e}function Ue(t){if(!(typeof t!="object"||!t||t instanceof EventTarget)){if(Ie in t)Rt(t);else if(!Array.isArray(t))for(let e in t){const n=t[e];typeof n=="object"&&n&&Ie in n&&Rt(n)}}}function Rt(t,e=new Set){if(typeof t=="object"&&t!==null&&!(t instanceof EventTarget)&&!e.has(t)){e.add(t),t instanceof Date&&t.getTime();for(let r in t)try{Rt(t[r],e)}catch{}const n=jt(t);if(n!==Object.prototype&&n!==Array.prototype&&n!==Map.prototype&&n!==Set.prototype&&n!==Date.prototype){const r=Jn(n);for(let i in r){const s=r[i].get;if(s)try{s.call(t)}catch{}}}}}const ki=["touchstart","touchmove"];function Bi(t){return ki.includes(t)}const Di=new Set,Mn=new Set;function Ze(t){var S;var e=this,n=e.ownerDocument,r=t.type,i=((S=t.composedPath)==null?void 0:S.call(t))||[],s=i[0]||t.target,a=0,o=t.__root;if(o){var f=i.indexOf(o);if(f!==-1&&(e===document||e===window)){t.__root=e;return}var u=i.indexOf(e);if(u===-1)return;f<=u&&(a=f)}if(s=i[a]||t.target,s!==e){Br(t,"currentTarget",{configurable:!0,get(){return s||n}});var c=P,d=M;Ne(null),pe(null);try{for(var l,h=[];s!==null;){var p=s.assignedSlot||s.parentNode||s.host||null;try{var b=s["__"+r];if(b!==void 0&&!s.disabled)if(Lt(b)){var[$,...v]=b;$.apply(s,[t,...v])}else b.call(s,t)}catch(A){l?h.push(A):l=A}if(t.cancelBubble||p===e||p===null)break;s=p}if(l){for(let A of h)queueMicrotask(()=>{throw A});throw l}}finally{t.__root=e,delete t.currentTarget,Ne(c),pe(d)}}}function yr(t){var e=document.createElement("template");return e.innerHTML=t,e.content}function pt(t,e){var n=M;n.nodes_start===null&&(n.nodes_start=t,n.nodes_end=e)}function Ke(t,e){var n=(e&er)!==0,r=(e&oi)!==0,i,s=!t.startsWith("<!>");return()=>{i===void 0&&(i=yr(s?t:"<!>"+t),n||(i=ue(i)));var a=r?document.importNode(i,!0):i.cloneNode(!0);if(n){var o=ue(a),f=a.lastChild;pt(o,f)}else pt(a,a);return a}}function br(t,e,n="svg"){var r=!t.startsWith("<!>"),i=(e&er)!==0,s=`<${n}>${r?t:"<!>"+t}</${n}>`,a;return()=>{if(!a){var o=yr(s),f=ue(o);if(i)for(a=document.createDocumentFragment();ue(f);)a.appendChild(ue(f));else a=ue(f)}var u=a.cloneNode(!0);if(i){var c=ue(u),d=u.lastChild;pt(c,d)}else pt(u,u);return u}}function xe(t,e){t!==null&&t.before(e)}function wr(t,e){var n=e==null?"":typeof e=="object"?e+"":e;n!==(t.__t??(t.__t=t.nodeValue))&&(t.__t=n,t.nodeValue=n+"")}function Ri(t,e){return Ti(t,e)}const $e=new Map;function Ti(t,{target:e,anchor:n,props:r={},events:i,context:s,intro:a=!0}){di();var o=new Set,f=d=>{for(var l=0;l<d.length;l++){var h=d[l];if(!o.has(h)){o.add(h);var p=Bi(h);e.addEventListener(h,Ze,{passive:p});var b=$e.get(h);b===void 0?(document.addEventListener(h,Ze,{passive:p}),$e.set(h,1)):$e.set(h,b+1)}}};f(qt(Di)),Mn.add(f);var u=void 0,c=xi(()=>{var d=n??e.appendChild(hi());return je(()=>{if(s){Yt({});var l=N;l.c=s}i&&(r.$$events=i),u=t(d,r)||{},s&&Vt()}),()=>{var p;for(var l of o){e.removeEventListener(l,Ze);var h=$e.get(l);--h===0?(document.removeEventListener(l,Ze),$e.delete(l)):$e.set(l,h)}Mn.delete(f),d!==n&&((p=d.parentNode)==null||p.removeChild(d))}});return Ui.set(u,c),u}let Ui=new WeakMap;function gt(t,e,n=!1){var r=t,i=null,s=null,a=j,o=n?Wt:0,f=!1;const u=(d,l=!0)=>{f=!0,c(l,d)},c=(d,l)=>{a!==(a=d)&&(a?(i?ft(i):l&&(i=je(()=>l(r))),s&&ot(s,()=>{s=null})):(s?ft(s):l&&(s=je(()=>l(r))),i&&ot(i,()=>{i=null})))};Xt(()=>{f=!1,e(u),f||c(null,null)},o)}function Ci(t,e){return e}function Fi(t,e,n,r){for(var i=[],s=e.length,a=0;a<s;a++)Zt(e[a].e,i,!0);var o=s>0&&i.length===0&&n!==null;if(o){var f=n.parentNode;pi(f),f.append(n),r.clear(),ce(t,e[0].prev,e[s-1].next)}hr(i,()=>{for(var u=0;u<s;u++){var c=e[u];o||(r.delete(c.k),ce(t,c.prev,c.next)),he(c.e,!o)}})}function Gi(t,e,n,r,i,s=null){var a=t,o={flags:e,items:new Map,first:null},f=null,u=!1,c=se(()=>{var d=n();return Lt(d)?d:d==null?[]:qt(d)});Xt(()=>{var d=E(c),l=d.length;u&&l===0||(u=l===0,Li(d,o,a,i,e,r,n),s!==null&&(l===0?f?ft(f):f=je(()=>s(a)):f!==null&&ot(f,()=>{f=null})),E(c))})}function Li(t,e,n,r,i,s,a){var o=t.length,f=e.items,u=e.first,c=u,d,l=null,h=[],p=[],b,$,v,S;for(S=0;S<o;S+=1){if(b=t[S],$=s(b,S),v=f.get($),v===void 0){var A=c?c.e.nodes_start:n;l=ji(A,e,l,l===null?e.first:l.next,b,$,S,r,i,a),f.set($,l),h=[],p=[],c=l.next;continue}if(qi(v,b,S),v.e.f&oe&&ft(v.e),v!==c){if(d!==void 0&&d.has(v)){if(h.length<p.length){var _=p[0],g;l=_.prev;var w=h[0],I=h[h.length-1];for(g=0;g<h.length;g+=1)In(h[g],_,n);for(g=0;g<p.length;g+=1)d.delete(p[g]);ce(e,w.prev,I.next),ce(e,l,w),ce(e,I,_),c=_,l=I,S-=1,h=[],p=[]}else d.delete(v),In(v,c,n),ce(e,v.prev,v.next),ce(e,v,l===null?e.first:l.next),ce(e,l,v),l=v;continue}for(h=[],p=[];c!==null&&c.k!==$;)c.e.f&oe||(d??(d=new Set)).add(c),p.push(c),c=c.next;if(c===null)continue;v=c}h.push(v),l=v,c=v.next}if(c!==null||d!==void 0){for(var x=d===void 0?[]:qt(d);c!==null;)c.e.f&oe||x.push(c),c=c.next;var D=x.length;if(D>0){var U=null;Fi(e,x,U,f)}}M.first=e.first&&e.first.e,M.last=l&&l.e}function qi(t,e,n,r){tr(t.v,e),t.i=n}function ji(t,e,n,r,i,s,a,o,f,u){var c=(f&ei)!==0,d=(f&ni)===0,l=c?d?Kt(i):K(i):i,h=f&ti?K(a):a,p={i:h,v:l,k:s,a:null,e:null,prev:n,next:r};try{return p.e=je(()=>o(t,l,h,u),ci),p.e.prev=n&&n.e,p.e.next=r&&r.e,n===null?e.first=p:(n.next=p,n.e.next=p.e),r!==null&&(r.prev=p,r.e.prev=p.e),p}finally{}}function In(t,e,n){for(var r=t.next?t.next.e.nodes_start:n,i=e?e.e.nodes_start:n,s=t.e.nodes_start;s!==r;){var a=Et(s);i.before(s),s=a}}function ce(t,e,n){e===null?t.first=n:(e.next=n,e.e.next=n&&n.e),n!==null&&(n.prev=e,n.e.prev=e&&e.e)}function V(t,e,n,r){var i=t.__attributes??(t.__attributes={});i[e]!==(i[e]=n)&&(e==="style"&&"__styles"in t&&(t.__styles={}),e==="loading"&&(t[Lr]=n),n==null?t.removeAttribute(e):typeof n!="string"&&Hi(t).includes(e)?t[e]=n:t.setAttribute(e,n))}var Pn=new Map;function Hi(t){var e=Pn.get(t.nodeName);if(e)return e;Pn.set(t.nodeName,e=[]);for(var n,r=t,i=Element.prototype;i!==r;){n=Jn(r);for(var s in n)n[s].set&&e.push(s);r=jt(r)}return e}function $r(t=!1){const e=N,n=e.l.u;if(!n)return;let r=()=>Ue(e.s);if(t){let i=0,s={};const a=qe(()=>{let o=!1;const f=e.s;for(const u in f)f[u]!==s[u]&&(s[u]=f[u],o=!0);return o&&i++,i});r=()=>E(a)}n.b.length&&_i(()=>{Sn(e,r),yn(n.b)}),Bt(()=>{const i=He(()=>n.m.map(Tr));return()=>{for(const s of i)typeof s=="function"&&s()}}),n.a.length&&Bt(()=>{Sn(e,r),yn(n.a)})}function Sn(t,e){if(t.l.s)for(const n of t.l.s)E(n);e()}let Qe=!1;function Wi(t){var e=Qe;try{return Qe=!1,[t(),Qe]}finally{Qe=e}}function Nn(t){for(var e=M,n=M;e!==null&&!(e.f&(re|Be));)e=e.parent;try{return pe(e),t()}finally{pe(n)}}function Pt(t,e,n,r){var I;var i=(n&ri)!==0,s=!De||(n&ii)!==0,a=(n&ai)!==0,o=(n&ui)!==0,f=!1,u;a?[u,f]=Wi(()=>t[e]):u=t[e];var c=Ie in t||Gr in t,d=a&&(((I=Me(t,e))==null?void 0:I.set)??(c&&e in t&&(x=>t[e]=x)))||void 0,l=r,h=!0,p=!1,b=()=>(p=!0,h&&(h=!1,o?l=He(r):l=r),l);u===void 0&&r!==void 0&&(d&&s&&Yr(),u=b(),d&&d(u));var $;if(s)$=()=>{var x=t[e];return x===void 0?b():(h=!0,p=!1,x)};else{var v=Nn(()=>(i?qe:se)(()=>t[e]));v.f|=Cr,$=()=>{var x=E(v);return x!==void 0&&(l=void 0),x===void 0?l:x}}if(!(n&si))return $;if(d){var S=t.$$legacy;return function(x,D){return arguments.length>0?((!s||!D||S||f)&&d(D?$():x),x):$()}}var A=!1,_=!1,g=Kt(u),w=Nn(()=>qe(()=>{var x=$(),D=E(g);return A?(A=!1,_=!0,D):(_=!1,g.v=x)}));return i||(w.equals=zt),function(x,D){if(arguments.length>0){const U=D?E(w):s&&a?Ee(x):x;return w.equals(U)||(A=!0,T(g,U),p&&l!==void 0&&(l=U),He(()=>E(w))),x}return E(w)}}function zi(t){N===null&&fi(),De&&N.l!==null?Yi(N).m.push(t):Bt(()=>{const e=He(t);if(typeof e=="function")return e})}function Yi(t){var e=t.l;return e.u??(e.u={a:[],b:[],m:[]})}const Vi="5";typeof window<"u"&&(window.__svelte||(window.__svelte={v:new Set})).v.add(Vi);Qr();const Oe={f32:Float32Array,u32:Uint32Array,i32:Int32Array},Or=Uint32Array,Ki=Uint32Array;function q(t){let e=1;for(const n of t)e*=n;return e}function Ji(t=0,e=1){const n=1-Math.random(),r=Math.random();return Math.sqrt(-2*Math.log(n))*Math.cos(2*Math.PI*r)*e+t}function St(t){let e=new Array(t.length);e[e.length-1]=1;for(let n=t.length-1;n>0;n--)e[n-1]=e[n]*t[n];return e}function F(t,e){return Math.ceil(t/e)}function ge(t){const e=new t.constructor(t.length);for(let n=0;n<t.length;n++)e[n]=t[n];return e}function kn(t,e){const n=ge(t);for(let r=0;r<e.length;r++){const i=e[r];t[r]=n[i]}}function Xi(t,e,n){const r=t[e];t[e]=n,t[n]=r}function Ce(t,e){if(t.length!==e.length)return!1;for(let n=0;n<t.length;n++)if(t[n]!==e[n])return!1;return!0}function Zi(t,e,n,r=1/0){let i="";function s(a,o){for(let f=0;f<e[a];f++){if(f>r){i+="...";return}const u=o+f*n[a];if(a===e.length-1)i+=`${t[u]}`,f<e[a]-1&&(i+=", ");else{if(f>0)for(let c=0;c<a+1;c++)i+=" ";if(i+="[",s(a+1,u),i+="]",f<e[a]-1){i+=",";for(let c=0;c<e.length-a-1;c++)i+=`
`}}}}return i+="[",s(0,0),i+="]",i}function Te(t,e){return e<0?t+=e:e}function R(t,e,n="gid.x",r=-1,i=""){let s="",a=1;for(let o=t.length-1+r+1;o>=0;o--){const f=`(${i}(${n}/${a})%${t[o]})`;a*=t[o];const u=e[o];s+=`(${u}*${f})`,o>0&&(s+="+")}return s}function Bn(t,e,n){const r=new t.constructor(t.length+1);r[e]=n;let i=0;for(let s=0;s<r.length;s++)s!==e&&(r[s]=t[i],i++);return r}let B;class m{constructor(e,n,r,i,s=!0){O(B,"GPU must exist. Tensor.setDevice() once!"),this.gpuBuffer=e,this.shape=Or.from(n),this.strides=Ki.from(r),this.dtype=i,this.owned=s}get DTypedArray(){return Oe[this.dtype]}static setDevice(e){O(e!==void 0,"device not found!"),B=new en(e)}static get gpu(){return O(B!==void 0,"gpu not found!"),B}setGPUBuffer(e,n=void 0){n=n===void 0?this.shape:n,e=this.DTypedArray.from(e),q(n)!==q(this.shape)&&(this.gpuBuffer.free(),this.gpuBuffer=B.memAlloc(e.byteLength)),B.memcpyHostToDevice(this.gpuBuffer,e)}static fill(e,n,r="f32"){const i=q(n),s=B.memAlloc(i*Oe[r].BYTES_PER_ELEMENT),a=256;return B.SourceModule(`
			@group(0) @binding(0) var<storage, read_write> data: array<${r}>;
			@compute @workgroup_size(${a})
			fn main(@builtin(global_invocation_id) gid : vec3u) {
				if(gid.x < ${i}) {
					data[gid.x] = ${r}(${e});
				}
			}`).getFunction("main")([F(i,a)],s),new m(s,n,St(n),r)}static tensor(e,n,r="f32"){const i=new Oe[r](e),s=B.memAlloc(i.byteLength);return B.memcpyHostToDevice(s,i),new m(s,n,St(n),r)}static empty(e,n="f32"){const r=B.memAlloc(q(e)*Oe[n].BYTES_PER_ELEMENT);return new m(r,e,St(e),n)}static random(e,n="f32"){const r=new Oe[n](q(e)).fill(0).map(i=>Math.random());return m.tensor(r,e,n)}static randn(e,n=0,r=1,i="f32"){const s=new Oe[i](q(e)).fill(0).map(a=>Ji(n,r));return m.tensor(s,e,i)}static _elementWiseUnaryOpInplace(e,n){const r=q(e.shape),i=256,s=e.dtype;B.SourceModule(`
			@group(0) @binding(0) var<storage, read_write> dst: array<${s}>;
			@compute @workgroup_size(${i})
			fn main(@builtin(global_invocation_id) gid : vec3u) {
				if(gid.x < ${r}) {
					let dstIdx = ${R(e.shape,e.strides,"gid.x",-1)};
					${n}
				}
			}
			`).getFunction("main")([F(r,i)],e.gpuBuffer)}_elementWiseUnaryOpInplace(e){return m._elementWiseUnaryOpInplace(this,e),this}static _elementWiseUnaryOp(e,n,r){O(Ce(e.shape,n.shape),"dst must have shape as src");const i=q(e.shape),s=256,a=e.dtype;B.SourceModule(`
			@group(0) @binding(0) var<storage, read_write> dst: array<${a}>;
			@group(0) @binding(1) var<storage, read> src: array<${a}>;
			@compute @workgroup_size(${s})
			fn main(@builtin(global_invocation_id) gid : vec3u) {
				if(gid.x < ${i}) {
					let srcIdx = ${R(n.shape,n.strides,"gid.x",-1)};
					let dstIdx = ${R(e.shape,e.strides,"gid.x",-1)};
					${r}
				}
			}
			`).getFunction("main")([F(i,s)],e.gpuBuffer,n.gpuBuffer)}_elementWiseUnaryOp(e){const n=m.empty(this.shape,this.dtype);return m._elementWiseUnaryOp(n,this,e),n}static sumLastDimension(e,n){O(e.dtype===n.dtype,"dst and src dtypes must match"),O(e.shape.at(-1)===1,"dimension we sum over should be 1 in dst");const r=q(e.shape),i=256,s=e.dtype;return B.SourceModule(`
			@group(0) @binding(0) var<storage, read_write> dst: array<${s}>;
			@group(0) @binding(1) var<storage, read> src: array<${s}>;

			@compute @workgroup_size(${i})
			fn main(@builtin(global_invocation_id) gid : vec3u) {
				if(gid.x < ${r}) {
					let baseSrcIdx = ${R(n.shape,n.strides,"gid.x",-2)};
					let baseDstIdx = ${R(e.shape,e.strides,"gid.x",-2)};
					var summed = ${s}(0);
					for(var i: u32 = 0; i < ${n.shape.at(-1)}; i++) {
						summed += src[baseSrcIdx + i*${n.strides.at(-1)}];
					}
					dst[baseDstIdx] = summed;
				}
			}`).getFunction("main")([F(r,i)],e.gpuBuffer,n.gpuBuffer),e}static reduceAnyDimensionGivenLastDimensionFunc(e,n,r,i=-1){const s=new Uint8Array(r.shape.length).fill(0).map((o,f)=>f);i=Te(r.shape.length,i);const a=r.shape.length-1;Xi(s,i,a),e(n.transpose(s),r.transpose(s))}static sum(e,n,r=-1){m.reduceAnyDimensionGivenLastDimensionFunc(m.sumLastDimension,e,n,r)}static _elementWiseBinaryOp(e,n,r,i){O(Ce(n.shape,r.shape),"srcA and srcB must have the same shape"),O(Ce(e.shape,r.shape),"dst, srcA, and srcB, must have the same shape");const s=q(e.shape),a=256,o=e.dtype;B.SourceModule(`
			@group(0) @binding(0) var<storage, read_write> dst: array<${o}>;
			@group(0) @binding(1) var<storage, read> srcA: array<${o}>;
			@group(0) @binding(2) var<storage, read> srcB: array<${o}>;

		 	@compute @workgroup_size(${a})
		 	fn main(@builtin(global_invocation_id) gid : vec3u) {
				if(gid.x < ${s}) {
					let dstIdx = ${R(e.shape,e.strides,"gid.x",-1)};
					let srcAIdx = ${R(n.shape,n.strides,"gid.x",-1)};
					let srcBIdx = ${R(r.shape,r.strides,"gid.x",-1)};
					${i}
				}
			}`).getFunction("main")([F(s,a)],e.gpuBuffer,n.gpuBuffer,r.gpuBuffer)}_elementWiseBinaryOp(e,n){let r=!1;typeof e=="number"&&(e=m.tensor([e],this.shape,this.dtype),r=!0);const i=m.empty(e.shape,e.dtype);return m._elementWiseBinaryOp(i,this,e,n),r&&e.free(),i}static _elementWiseBinaryOpInplace(e,n,r){O(Ce(e.shape,n.shape),"dst, src, must have the same shape");const i=q(e.shape),s=256,a=e.dtype;B.SourceModule(`
			@group(0) @binding(0) var<storage, read_write> dst: array<${a}>;
			@group(0) @binding(1) var<storage, read> src: array<${a}>;

		 	@compute @workgroup_size(${s})
		 	fn main(@builtin(global_invocation_id) gid : vec3u) {
				if(gid.x < ${i}) {
					let dstIdx = ${R(e.shape,e.strides,"gid.x",-1)};
					let srcIdx = ${R(n.shape,n.strides,"gid.x",-1)};
					${r}
				}
			}`).getFunction("main")([F(i,s)],e.gpuBuffer,n.gpuBuffer)}add(e){return this._elementWiseBinaryOp(e,"dst[dstIdx] = srcA[srcAIdx]+srcB[srcBIdx];")}sub(e){return this._elementWiseBinaryOp(e,"dst[dstIdx] = srcA[srcAIdx]-srcB[srcBIdx];")}mul(e){return this._elementWiseBinaryOp(e,"dst[dstIdx] = srcA[srcAIdx]*srcB[srcBIdx];")}div(e){return this._elementWiseBinaryOp(e,"dst[dstIdx] = srcA[srcAIdx]/srcB[srcBIdx];")}pow(e){return this._elementWiseBinaryOp(e,`dst[dstIdx] = ${this.dtype}(pow(f32(srcA[srcAIdx]), f32(srcB[srcBIdx])));`)}add_(e){return m._elementWiseBinaryOpInplace(this,e,"dst[dstIdx] += src[srcIdx];"),this}sub_(e){return m._elementWiseBinaryOpInplace(this,e,"dst[dstIdx] -= src[srcIdx];"),this}sum(e=-1){const n=ge(this.shape);n[Te(n.length,e)]=1;const r=m.empty(n,this.dtype);return m.sum(r,this,e),r}static maxLastDim(e,n){O(e.dtype===n.dtype,"dst and src dtypes must match"),O(e.shape.at(-1)===1,"dimension we sum over should be 1 in dst");const r=q(e.shape),i=256,s=e.dtype;return B.SourceModule(`
			@group(0) @binding(0) var<storage, read_write> dst: array<${s}>;
			@group(0) @binding(1) var<storage, read> src: array<${s}>;

			@compute @workgroup_size(${i})
			fn main(@builtin(global_invocation_id) gid : vec3u) {
				if(gid.x < ${r}) {
					let baseSrcIdx = ${R(n.shape,n.strides,"gid.x",-2)};
					let baseDstIdx = ${R(e.shape,e.strides,"gid.x",-2)};
					var max: ${s} = src[baseSrcIdx];
					for(var i: u32 = 0; i < ${n.shape.at(-1)}; i++) {
						let cur = src[baseSrcIdx + i*${n.strides.at(-1)}];
						if(cur > max) {
							max = cur;
						}
					}
					dst[baseDstIdx] = max;
				}
			}`).getFunction("main")([F(r,i)],e.gpuBuffer,n.gpuBuffer),e}static max(e,n,r=-1){m.reduceAnyDimensionGivenLastDimensionFunc(m.maxLastDim,e,n,r)}max(e=-1){const n=ge(this.shape);n[Te(n.length,e)]=1;const r=m.empty(n,this.dtype);return m.max(r,this,e),r}softmax(e=-1){const n=this.max(e),r=this.sub(n.expand(this.shape)),i=r.exp(),s=i.sum(e),a=i.div(s.expand(i.shape));return n.free(),r.free(),s.free(),i.free(),a}fillInplace(e){return this._elementWiseUnaryOpInplace(`dst[dstIdx] = ${this.dtype}(${e});`)}contiguous(){return this._elementWiseUnaryOp(dst,src,"dst[dstIdx] = src[srcIdx];")}exp(){return this._elementWiseUnaryOp("dst[dstIdx] = exp(src[srcIdx]);")}relu(){return this._elementWiseUnaryOp("dst[dstIdx] = max(src[srcIdx], 0);")}reciprocal(){return this._elementWiseUnaryOp(other,"dst[dstIdx] = 1/src[srcIdx];")}log(e=1e-6){return this._elementWiseUnaryOp(`dst[dstIdx] = log(src[srcIdx] + ${e});`)}get T(){return this.transpose()}transpose(e=void 0){if(this.shape===1)return this;e===void 0&&(e=[this.shape.length-1,0]);const n=ge(this.shape),r=ge(this.strides);return kn(n,e),kn(r,e),new m(this.gpuBuffer,n,r,this.dtype,!1)}unsqueeze(e=0){e=Te(this.shape.length+1,e);const n=Bn(this.shape,e,1),r=this.shape.slice(e).reduce((s,a)=>s*a,1),i=Bn(this.strides,e,r);return new m(this.gpuBuffer,n,i,this.dtype,!1)}expandTo(e,n){if(n=Te(this.shape.length,n),e===this.shape[n])return this;const r=ge(this.shape),i=ge(this.strides);return r[n]=e,i[n]=0,new m(this.gpuBuffer,r,i,this.dtype,!1)}expand(e){O(e.length===this.shape.length,"Must have same number of dims");let n=this;for(let r=0;r<e.length;r++){const i=e[r];n=n.expandTo(i,r)}return n}static matmul(e,n,r){O(n.shape.length===2&&r.shape.length===2&&e.shape.length===2,"tensors are matrix shaped"),O(n.shape.at(-1)===r.shape.at(0),"Inner dimension must be the same"),O(e.shape[0]===n.shape[0]&&e.shape[1]===r.shape[1],"output dimension lines up");const i=n.shape[1],s=e.dtype,a=16,o=16,f=B.SourceModule(`
			@group(0) @binding(0) var<storage, read_write> dst: array<${s}>;
			@group(0) @binding(1) var<storage, read> srcA: array<${s}>;
			@group(0) @binding(2) var<storage, read> srcB: array<${s}>;

		 	@compute @workgroup_size(${a}, ${o})
		 	fn main(@builtin(global_invocation_id) gid : vec3u) {
				let i = gid.x;
				let j = gid.y;
				if(gid.x < ${e.shape[0]} && gid.y < ${e.shape[1]}) {
					var summed: ${s} = 0;
					for(var k: u32 = 0; k < ${i}; k++) {
						let srcAIdx = i*${n.strides[0]} + k*${n.strides[1]};
						let srcBIdx = k*${r.strides[0]} + j*${r.strides[1]};
						summed += srcA[srcAIdx]*srcB[srcBIdx];	
					}

					let dstIdx = i*${e.strides[0]} + j*${e.strides[1]};
					dst[dstIdx] = summed;
				}
			}
		`).getFunction("main"),u=[F(e.shape[0],a),F(e.shape[1],o)];f(u,e.gpuBuffer,n.gpuBuffer,r.gpuBuffer)}matmul(e){const n=m.empty([this.shape[0],e.shape[1]],this.dtype);return m.matmul(n,this,e),n}static bmm(e,n,r){O(n.shape.at(-1)===r.shape.at(-2),"Inner dimension must be the same"),O(e.shape.at(-2)===n.shape.at(-2)&&e.shape.at(-1)===r.shape.at(-1),"output dimension lines up");const i=q(e.shape.slice(0,-2)),s=e.shape.at(-2),a=e.shape.at(-1),o=n.shape.at(-1),f=e.dtype,u=4,c=8,d=8,l=B.SourceModule(`
			@group(0) @binding(0) var<storage, read_write> dst: array<${f}>;
			@group(0) @binding(1) var<storage, read> srcA: array<${f}>;
			@group(0) @binding(2) var<storage, read> srcB: array<${f}>;

		 	@compute @workgroup_size(${u}, ${c}, ${d})
		 	fn main(@builtin(global_invocation_id) gid : vec3u) {
				let b = gid.x;
				let i = gid.y;
				let j = gid.z;
				if(b < ${i} && i < ${s} && j < ${a}) {
					let srcAOffset = ${R(n.shape,n.strides,"b",-3)};
					let srcBOffset = ${R(r.shape,r.strides,"b",-3)};
					let dstOffset = ${R(e.shape,e.strides,"b",-3)};

					var summed: ${f} = 0;
					for(var k: u32 = 0; k < ${o}; k++) {
						let srcAIdx = srcAOffset + i*${n.strides.at(-2)} + k*${n.strides.at(-1)};
						let srcBIdx = srcBOffset + k*${r.strides.at(-2)} + j*${r.strides.at(-1)};
						summed += srcA[srcAIdx]*srcB[srcBIdx];	
					}

					let dstIdx = dstOffset + i*${e.strides.at(-2)} + j*${e.strides.at(-1)};
					dst[dstIdx] = summed;
				}
			}
		`).getFunction("main"),h=[F(i,u),F(s,c),F(a,d)];l(h,e.gpuBuffer,n.gpuBuffer,r.gpuBuffer)}bmm(e){const n=[...this.shape.slice(0,-2),this.shape.at(-2),e.shape.at(-1)],r=m.empty(n);return m.bmm(r,this,e),r}static _softmaxJacobianLastDim(e,n){O(e.shape.at(-1)===e.shape.at(-2)&&e.shape.at(-1)===n.shape.at(-1));const r=q(e.shape.slice(-2)),i=e.shape.at(-1),s=e.dtype,a=4,o=8,f=8,u=B.SourceModule(`
			@group(0) @binding(0) var<storage, read_write> dst: array<${s}>;
			@group(0) @binding(1) var<storage, read> s: array<${s}>;

		 	@compute @workgroup_size(${a}, ${o}, ${f})
		 	fn main(@builtin(global_invocation_id) gid : vec3u) {
				let b = gid.x;
				let i = gid.y;
				let j = gid.z;

				if(b < ${r} && i < ${i} && j < ${i}) {
					let dstOffset = ${R(e.shape,e.strides,"b",-3)};
					let sOffset = ${R(n.shape,n.strides,"b",-2)};

					let siIdx = sOffset + i*${n.strides.at(-1)};
					let sjIdx = sOffset + j*${n.strides.at(-1)};
					let dijIdx = dstOffset + i*${e.strides.at(-2)} + j*${e.strides.at(-1)};

					let si = s[siIdx];
					let sj = s[sjIdx];
					if(i!=j) {
						dst[dijIdx] = -si*sj;
					}
					else {
						dst[dijIdx] = si*(1-si);
					}
				}
			}
		`).getFunction("main"),c=[F(r,a),F(i,o),F(i,f)];u(c,e.gpuBuffer,n.gpuBuffer)}_softmaxJacobian(){const e=this.shape.at(-1),n=m.empty([...this.shape.slice(0,-1),e,e]);return m._softmaxJacobianLastDim(n,this),n}async print(e=!0){this.assertNotFreed();const n=await this.cpuBuffer();let r="";r+=`dtype='${this.dtype}', `,r+=`shape=[${this.shape}], `,r+=`strides=[${this.strides}],
`,r+=`gpuBuffer=
${Zi(n,this.shape,this.strides,e?8:1/0)}
`,console.log(r)}async cpuBuffer(){return B.mapGPUToCPU(this.gpuBuffer,this.DTypedArray)}free(){this.gpuBuffer===void 0&&console.warn("Tried to free a gpuBuffer twice!"),this.gpuBuffer&&this.owned&&B.free(this.gpuBuffer),this.gpuBuffer=void 0}assertNotFreed(){O(this.gpuBuffer!==void 0,"This GPU Buffer has already been freed.")}}function O(t,e="ASSERT FAILED"){if(!t)throw new Error(e)}class en{constructor(e){this.device=e}static async init(){const e=await navigator.gpu.requestAdapter();O(e,"adapter exists");const n=await e.requestDevice();return O(n,"device exists"),new en(n)}async deviceSynchronize(){await this.device.queue.onSubmittedWorkDone()}memAlloc(e,n=GPUBufferUsage.STORAGE|GPUBufferUsage.COPY_DST|GPUBufferUsage.COPY_SRC){return O(e>0),this.device.createBuffer({size:e,usage:n})}memcpyHostToDevice(e,n){this.device.queue.writeBuffer(e,0,n,0)}async memcpyDeviceToHost(e,n){e.set(await this.mapGPUToCPU(n,e.constructor))}free(e){e.destroy()}async printGPUBuffer(e,n=Float32Array){const r=await this.mapGPUToCPU(e,n);console.log(Array.from(r),r.constructor.name)}printDeviceInfo(){console.table(this.device.adapterInfo)}async mapGPUToCPU(e,n=Float32Array){const r=this.memAlloc(e.size,GPUBufferUsage.COPY_DST|GPUBufferUsage.MAP_READ),i=this.device.createCommandEncoder();return i.copyBufferToBuffer(e,0,r,0,e.size),this.device.queue.submit([i.finish()]),await r.mapAsync(GPUMapMode.READ),new n(r.getMappedRange())}SourceModule(e){return new Qi(this,e)}}class Qi{constructor(e,n){this.gpu=e,this.device=e.device,this.kernel=n}getFunctionExplicitBindings(e){const n=this.device.createShaderModule({code:this.kernel}),r=this.device.createComputePipeline({layout:"auto",compute:{module:n,entryPoint:e}}),i=r.getBindGroupLayout(0);return(s,...a)=>{O(s!==void 0);const o=this.device.createBindGroup({layout:i,entries:a}),f=this.device.createCommandEncoder(),u=f.beginComputePass();u.setPipeline(r),u.setBindGroup(0,o),u.dispatchWorkgroups(...s),u.end(),this.device.queue.submit([f.finish()])}}getFunctionOnlyBuffers(e){const n=this.getFunctionExplicitBindings(e);return(r,...i)=>{const s=i.map((a,o)=>({binding:o,resource:{buffer:a}}));n(r,...s)}}getFunction(e,n=!1){return n?this.getFunctionExplicitBindings(e):this.getFunctionOnlyBuffers(e)}}const es=14,[Dn,tn,nn,rn,sn,an,un,on,fn,ln,cn,dn,hn,pn]=new Array(es).fill(0).map((t,e)=>e),ts={[nn]:([t],e)=>t.sum(e),[sn]:([t])=>t.pow(2),[on]:([t],e)=>t.transpose(e),[fn]:([t],e)=>t.expand(e),[ln]:([t])=>t.relu(),[dn]:([t])=>t.exp(),[hn]:([t],e)=>t.softmax(e),[pn]:([t])=>t.log()},ns={[nn]:([t],e,n)=>[()=>n.expand(t.shape)],[sn]:([t],e,n)=>[()=>{const i=t.mul(2),s=n.mul(i);return i.free(),s}],[on]:([t],e,n,r)=>[()=>n.transpose(r)],[fn]:([t],e,n,r)=>[()=>n.expand(t.shape)],[ln]:([t],e,n)=>[()=>e._elementWiseBinaryOp(n,`
				let result = srcA[srcAIdx];
				let resultGrad = srcB[srcBIdx];
				if(result > 0) {
					dst[dstIdx] = resultGrad;
				} else {
					dst[dstIdx] = 0;
				}
				`)],[dn]:([t],e,n)=>[()=>n.mul(e)],[hn]:([t],e,n)=>[()=>{const i=e._softmaxJacobian(),s=n.unsqueeze(1).bmm(i);return s.shape=e.shape,s.strides=e.strides,s}],[pn]:([t],e,n)=>[()=>{const i=t.pow(-1),s=n.mul(i);return i.free(),s}]},rs={[tn]:([t,e])=>t.add(e),[rn]:([t,e])=>t.sub(e),[an]:([t,e])=>t.mul(e),[un]:([t,e])=>t.matmul(e),[cn]:([t,e])=>t.div(e)},is={[tn]:([t,e],n,r)=>[()=>r,()=>r],[rn]:([t,e],n,r)=>[()=>r,()=>r.mul(-1)],[an]:([t,e],n,r)=>[()=>r.mul(e),()=>r.mul(t)],[un]:([t,e],n,r)=>[()=>r.matmul(e.T),()=>t.T.matmul(r)],[cn]:([t,e],n,r)=>[()=>{const a=typeof e=="number"?m.tensor([1/e],t.shape):e.pow(-1),o=r.mul(a);return a.free(),o},()=>{const a=typeof e=="number"?m.tensor([1/(e*e)],t.shape):e.pow(-2),o=t.mul(-1),f=o.mul(a),u=r.mul(a);return a.free(),f.free(),o.free(),u}]};class de{constructor(e,n,r=[],i=void 0,s=!1){this.childArgs=n,this.opArgs=r,this.OP_CODE=e,this.tensor=i,this.grad=void 0,this.requiresGrad=s}static tensor(e,n=!1){return new de(Dn,[],[],e,n,e.shape)}get shape(){return O(this.tensor,"Tensor must exist to get shape. TODO: implement shape tracker to get around this."),this.tensor.shape}_unaryOp(e,...n){return new de(e,[this],n,void 0,this.requiresGrad)}softmax(e=-1){return this._unaryOp(hn,e)}exp(){return this._unaryOp(dn)}sum(e){return this._unaryOp(nn,e)}square(){return this._unaryOp(sn)}get T(){return this.transpose()}transpose(e=void 0){return this._unaryOp(on,e)}expand(e){return this._unaryOp(fn,e)}relu(){return this._unaryOp(ln)}log(){return this._unaryOp(pn)}_binaryOp(e,n,...r){return new de(n,[this,e],r,void 0,this.requiresGrad||e.requiresGrad)}div(e){return this._binaryOp(e,cn)}add(e){return this._binaryOp(e,tn)}sub(e){return this._binaryOp(e,rn)}mul(e){return this._binaryOp(e,an)}matmul(e){return this._binaryOp(e,un)}_getOpFunc(){let e;if(this.childArgs.length===1)e=ts;else if(this.childArgs.length===2)e=rs;else throw new Error("Unknown op length");return O(this.OP_CODE in e,"Must have the function in the OP_MAP"),e[this.OP_CODE]}_getBackwardsOpFunc(){let e;if(this.childArgs.length===1)e=ns;else if(this.childArgs.length===2)e=is;else throw new Error("Unknown op length");return O(this.OP_CODE in e,"Must have the function in the OP_MAP"),e[this.OP_CODE]}forward(){if(this.OP_CODE===Dn)return this.tensor;let e=new Array(this.childArgs.length);for(let r=0;r<this.childArgs.length;r++){const i=this.childArgs[r];typeof i=="number"?e[r]=i:e[r]=i.forward()}const n=this._getOpFunc();return this.tensor=n(e,...this.opArgs),this.tensor}_accumulateGradient(e){this.grad===void 0&&(this.grad=m.fill(0,this.tensor.shape,this.tensor.dtype)),this.grad.add_(e)}backward(){O(this.tensor,"result needs to be evaluated"),O(Ce(new Or(this.tensor.shape.length).fill(1),this.tensor.shape),"Needs to be called on a reduce value (shape dimensions all 1)");const e=r=>{if(O(r.tensor,"result needs to be evaluated"),r.childArgs.length===0)return;const i=r._getBackwardsOpFunc(),s=r.childArgs.map(o=>typeof o=="number"?o:o.tensor),a=i(s,r.tensor,r.grad,...r.opArgs);for(let o=0;o<r.childArgs.length;o++){const f=r.childArgs[o],u=a[o];if(typeof f=="number"||f.requiresGrad===!1)continue;const c=u();f._accumulateGradient(c),e(f)}},n=m.fill(1,this.tensor.shape,this.tensor.dtype);this._accumulateGradient(n),e(this)}zeroGrad(){if(!(!this.grad||!this.requiresGrad)){this.grad.fillInplace(0);for(let e=0;e<this.childArgs.length;e++)typeof this.childArgs[e]!="number"&&this.childArgs[e].zeroGrad()}}freeGraph(){this.grad&&(this.grad.free(),this.grad=void 0),this.tensor&&(this.tensor.free(),this.tensor=void 0);for(let e=0;e<this.childArgs.length;e++)typeof this.childArgs[e]!="number"&&this.childArgs[e].freeGraph()}async print(...e){O(this.tensor,"result must be populated to print"),await this.tensor.print(...e)}}class ss{constructor(e,n=.001){e.forEach(r=>O(r.requiresGrad,"Parameters must require gradients")),this.params=e,this.lr=n}update(){for(const e of this.params){O(e.grad&&e.tensor,"Can update data with gradient.");const n=e.grad.mul(this.lr);e.tensor.sub_(n),n.free()}}}function st(t,e){return t==null||e==null?NaN:t<e?-1:t>e?1:t>=e?0:NaN}function as(t,e){return t==null||e==null?NaN:e<t?-1:e>t?1:e>=t?0:NaN}function Er(t){let e,n,r;t.length!==2?(e=st,n=(o,f)=>st(t(o),f),r=(o,f)=>t(o)-f):(e=t===st||t===as?t:us,n=t,r=t);function i(o,f,u=0,c=o.length){if(u<c){if(e(f,f)!==0)return c;do{const d=u+c>>>1;n(o[d],f)<0?u=d+1:c=d}while(u<c)}return u}function s(o,f,u=0,c=o.length){if(u<c){if(e(f,f)!==0)return c;do{const d=u+c>>>1;n(o[d],f)<=0?u=d+1:c=d}while(u<c)}return u}function a(o,f,u=0,c=o.length){const d=i(o,f,u,c-1);return d>u&&r(o[d-1],f)>-r(o[d],f)?d-1:d}return{left:i,center:a,right:s}}function us(){return 0}function os(t){return t===null?NaN:+t}const fs=Er(st),ls=fs.right;Er(os).center;const cs=Math.sqrt(50),ds=Math.sqrt(10),hs=Math.sqrt(2);function mt(t,e,n){const r=(e-t)/Math.max(0,n),i=Math.floor(Math.log10(r)),s=r/Math.pow(10,i),a=s>=cs?10:s>=ds?5:s>=hs?2:1;let o,f,u;return i<0?(u=Math.pow(10,-i)/a,o=Math.round(t*u),f=Math.round(e*u),o/u<t&&++o,f/u>e&&--f,u=-u):(u=Math.pow(10,i)*a,o=Math.round(t/u),f=Math.round(e/u),o*u<t&&++o,f*u>e&&--f),f<o&&.5<=n&&n<2?mt(t,e,n*2):[o,f,u]}function ps(t,e,n){if(e=+e,t=+t,n=+n,!(n>0))return[];if(t===e)return[t];const r=e<t,[i,s,a]=r?mt(e,t,n):mt(t,e,n);if(!(s>=i))return[];const o=s-i+1,f=new Array(o);if(r)if(a<0)for(let u=0;u<o;++u)f[u]=(s-u)/-a;else for(let u=0;u<o;++u)f[u]=(s-u)*a;else if(a<0)for(let u=0;u<o;++u)f[u]=(i+u)/-a;else for(let u=0;u<o;++u)f[u]=(i+u)*a;return f}function Tt(t,e,n){return e=+e,t=+t,n=+n,mt(t,e,n)[2]}function gs(t,e,n){e=+e,t=+t,n=+n;const r=e<t,i=r?Tt(e,t,n):Tt(t,e,n);return(r?-1:1)*(i<0?1/-i:i)}function ms(t,e){switch(arguments.length){case 0:break;case 1:this.range(t);break;default:this.range(e).domain(t);break}return this}function gn(t,e,n){t.prototype=e.prototype=n,n.constructor=t}function Ar(t,e){var n=Object.create(t.prototype);for(var r in e)n[r]=e[r];return n}function Je(){}var We=.7,vt=1/We,Se="\\s*([+-]?\\d+)\\s*",ze="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",ee="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",vs=/^#([0-9a-f]{3,8})$/,_s=new RegExp(`^rgb\\(${Se},${Se},${Se}\\)$`),xs=new RegExp(`^rgb\\(${ee},${ee},${ee}\\)$`),ys=new RegExp(`^rgba\\(${Se},${Se},${Se},${ze}\\)$`),bs=new RegExp(`^rgba\\(${ee},${ee},${ee},${ze}\\)$`),ws=new RegExp(`^hsl\\(${ze},${ee},${ee}\\)$`),$s=new RegExp(`^hsla\\(${ze},${ee},${ee},${ze}\\)$`),Rn={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};gn(Je,Ye,{copy(t){return Object.assign(new this.constructor,this,t)},displayable(){return this.rgb().displayable()},hex:Tn,formatHex:Tn,formatHex8:Os,formatHsl:Es,formatRgb:Un,toString:Un});function Tn(){return this.rgb().formatHex()}function Os(){return this.rgb().formatHex8()}function Es(){return Mr(this).formatHsl()}function Un(){return this.rgb().formatRgb()}function Ye(t){var e,n;return t=(t+"").trim().toLowerCase(),(e=vs.exec(t))?(n=e[1].length,e=parseInt(e[1],16),n===6?Cn(e):n===3?new W(e>>8&15|e>>4&240,e>>4&15|e&240,(e&15)<<4|e&15,1):n===8?et(e>>24&255,e>>16&255,e>>8&255,(e&255)/255):n===4?et(e>>12&15|e>>8&240,e>>8&15|e>>4&240,e>>4&15|e&240,((e&15)<<4|e&15)/255):null):(e=_s.exec(t))?new W(e[1],e[2],e[3],1):(e=xs.exec(t))?new W(e[1]*255/100,e[2]*255/100,e[3]*255/100,1):(e=ys.exec(t))?et(e[1],e[2],e[3],e[4]):(e=bs.exec(t))?et(e[1]*255/100,e[2]*255/100,e[3]*255/100,e[4]):(e=ws.exec(t))?Ln(e[1],e[2]/100,e[3]/100,1):(e=$s.exec(t))?Ln(e[1],e[2]/100,e[3]/100,e[4]):Rn.hasOwnProperty(t)?Cn(Rn[t]):t==="transparent"?new W(NaN,NaN,NaN,0):null}function Cn(t){return new W(t>>16&255,t>>8&255,t&255,1)}function et(t,e,n,r){return r<=0&&(t=e=n=NaN),new W(t,e,n,r)}function As(t){return t instanceof Je||(t=Ye(t)),t?(t=t.rgb(),new W(t.r,t.g,t.b,t.opacity)):new W}function Ut(t,e,n,r){return arguments.length===1?As(t):new W(t,e,n,r??1)}function W(t,e,n,r){this.r=+t,this.g=+e,this.b=+n,this.opacity=+r}gn(W,Ut,Ar(Je,{brighter(t){return t=t==null?vt:Math.pow(vt,t),new W(this.r*t,this.g*t,this.b*t,this.opacity)},darker(t){return t=t==null?We:Math.pow(We,t),new W(this.r*t,this.g*t,this.b*t,this.opacity)},rgb(){return this},clamp(){return new W(ye(this.r),ye(this.g),ye(this.b),_t(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:Fn,formatHex:Fn,formatHex8:Ms,formatRgb:Gn,toString:Gn}));function Fn(){return`#${_e(this.r)}${_e(this.g)}${_e(this.b)}`}function Ms(){return`#${_e(this.r)}${_e(this.g)}${_e(this.b)}${_e((isNaN(this.opacity)?1:this.opacity)*255)}`}function Gn(){const t=_t(this.opacity);return`${t===1?"rgb(":"rgba("}${ye(this.r)}, ${ye(this.g)}, ${ye(this.b)}${t===1?")":`, ${t})`}`}function _t(t){return isNaN(t)?1:Math.max(0,Math.min(1,t))}function ye(t){return Math.max(0,Math.min(255,Math.round(t)||0))}function _e(t){return t=ye(t),(t<16?"0":"")+t.toString(16)}function Ln(t,e,n,r){return r<=0?t=e=n=NaN:n<=0||n>=1?t=e=NaN:e<=0&&(t=NaN),new X(t,e,n,r)}function Mr(t){if(t instanceof X)return new X(t.h,t.s,t.l,t.opacity);if(t instanceof Je||(t=Ye(t)),!t)return new X;if(t instanceof X)return t;t=t.rgb();var e=t.r/255,n=t.g/255,r=t.b/255,i=Math.min(e,n,r),s=Math.max(e,n,r),a=NaN,o=s-i,f=(s+i)/2;return o?(e===s?a=(n-r)/o+(n<r)*6:n===s?a=(r-e)/o+2:a=(e-n)/o+4,o/=f<.5?s+i:2-s-i,a*=60):o=f>0&&f<1?0:a,new X(a,o,f,t.opacity)}function Is(t,e,n,r){return arguments.length===1?Mr(t):new X(t,e,n,r??1)}function X(t,e,n,r){this.h=+t,this.s=+e,this.l=+n,this.opacity=+r}gn(X,Is,Ar(Je,{brighter(t){return t=t==null?vt:Math.pow(vt,t),new X(this.h,this.s,this.l*t,this.opacity)},darker(t){return t=t==null?We:Math.pow(We,t),new X(this.h,this.s,this.l*t,this.opacity)},rgb(){var t=this.h%360+(this.h<0)*360,e=isNaN(t)||isNaN(this.s)?0:this.s,n=this.l,r=n+(n<.5?n:1-n)*e,i=2*n-r;return new W(Nt(t>=240?t-240:t+120,i,r),Nt(t,i,r),Nt(t<120?t+240:t-120,i,r),this.opacity)},clamp(){return new X(qn(this.h),tt(this.s),tt(this.l),_t(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const t=_t(this.opacity);return`${t===1?"hsl(":"hsla("}${qn(this.h)}, ${tt(this.s)*100}%, ${tt(this.l)*100}%${t===1?")":`, ${t})`}`}}));function qn(t){return t=(t||0)%360,t<0?t+360:t}function tt(t){return Math.max(0,Math.min(1,t||0))}function Nt(t,e,n){return(t<60?e+(n-e)*t/60:t<180?n:t<240?e+(n-e)*(240-t)/60:e)*255}const mn=t=>()=>t;function Ps(t,e){return function(n){return t+n*e}}function Ss(t,e,n){return t=Math.pow(t,n),e=Math.pow(e,n)-t,n=1/n,function(r){return Math.pow(t+r*e,n)}}function Ns(t){return(t=+t)==1?Ir:function(e,n){return n-e?Ss(e,n,t):mn(isNaN(e)?n:e)}}function Ir(t,e){var n=e-t;return n?Ps(t,n):mn(isNaN(t)?e:t)}const jn=function t(e){var n=Ns(e);function r(i,s){var a=n((i=Ut(i)).r,(s=Ut(s)).r),o=n(i.g,s.g),f=n(i.b,s.b),u=Ir(i.opacity,s.opacity);return function(c){return i.r=a(c),i.g=o(c),i.b=f(c),i.opacity=u(c),i+""}}return r.gamma=t,r}(1);function ks(t,e){e||(e=[]);var n=t?Math.min(e.length,t.length):0,r=e.slice(),i;return function(s){for(i=0;i<n;++i)r[i]=t[i]*(1-s)+e[i]*s;return r}}function Bs(t){return ArrayBuffer.isView(t)&&!(t instanceof DataView)}function Ds(t,e){var n=e?e.length:0,r=t?Math.min(n,t.length):0,i=new Array(r),s=new Array(n),a;for(a=0;a<r;++a)i[a]=vn(t[a],e[a]);for(;a<n;++a)s[a]=e[a];return function(o){for(a=0;a<r;++a)s[a]=i[a](o);return s}}function Rs(t,e){var n=new Date;return t=+t,e=+e,function(r){return n.setTime(t*(1-r)+e*r),n}}function xt(t,e){return t=+t,e=+e,function(n){return t*(1-n)+e*n}}function Ts(t,e){var n={},r={},i;(t===null||typeof t!="object")&&(t={}),(e===null||typeof e!="object")&&(e={});for(i in e)i in t?n[i]=vn(t[i],e[i]):r[i]=e[i];return function(s){for(i in n)r[i]=n[i](s);return r}}var Ct=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,kt=new RegExp(Ct.source,"g");function Us(t){return function(){return t}}function Cs(t){return function(e){return t(e)+""}}function Fs(t,e){var n=Ct.lastIndex=kt.lastIndex=0,r,i,s,a=-1,o=[],f=[];for(t=t+"",e=e+"";(r=Ct.exec(t))&&(i=kt.exec(e));)(s=i.index)>n&&(s=e.slice(n,s),o[a]?o[a]+=s:o[++a]=s),(r=r[0])===(i=i[0])?o[a]?o[a]+=i:o[++a]=i:(o[++a]=null,f.push({i:a,x:xt(r,i)})),n=kt.lastIndex;return n<e.length&&(s=e.slice(n),o[a]?o[a]+=s:o[++a]=s),o.length<2?f[0]?Cs(f[0].x):Us(e):(e=f.length,function(u){for(var c=0,d;c<e;++c)o[(d=f[c]).i]=d.x(u);return o.join("")})}function vn(t,e){var n=typeof e,r;return e==null||n==="boolean"?mn(e):(n==="number"?xt:n==="string"?(r=Ye(e))?(e=r,jn):Fs:e instanceof Ye?jn:e instanceof Date?Rs:Bs(e)?ks:Array.isArray(e)?Ds:typeof e.valueOf!="function"&&typeof e.toString!="function"||isNaN(e)?Ts:xt)(t,e)}function Gs(t,e){return t=+t,e=+e,function(n){return Math.round(t*(1-n)+e*n)}}function Ls(t){return function(){return t}}function qs(t){return+t}var Hn=[0,1];function Ae(t){return t}function Ft(t,e){return(e-=t=+t)?function(n){return(n-t)/e}:Ls(isNaN(e)?NaN:.5)}function js(t,e){var n;return t>e&&(n=t,t=e,e=n),function(r){return Math.max(t,Math.min(e,r))}}function Hs(t,e,n){var r=t[0],i=t[1],s=e[0],a=e[1];return i<r?(r=Ft(i,r),s=n(a,s)):(r=Ft(r,i),s=n(s,a)),function(o){return s(r(o))}}function Ws(t,e,n){var r=Math.min(t.length,e.length)-1,i=new Array(r),s=new Array(r),a=-1;for(t[r]<t[0]&&(t=t.slice().reverse(),e=e.slice().reverse());++a<r;)i[a]=Ft(t[a],t[a+1]),s[a]=n(e[a],e[a+1]);return function(o){var f=ls(t,o,1,r)-1;return s[f](i[f](o))}}function zs(t,e){return e.domain(t.domain()).range(t.range()).interpolate(t.interpolate()).clamp(t.clamp()).unknown(t.unknown())}function Ys(){var t=Hn,e=Hn,n=vn,r,i,s,a=Ae,o,f,u;function c(){var l=Math.min(t.length,e.length);return a!==Ae&&(a=js(t[0],t[l-1])),o=l>2?Ws:Hs,f=u=null,d}function d(l){return l==null||isNaN(l=+l)?s:(f||(f=o(t.map(r),e,n)))(r(a(l)))}return d.invert=function(l){return a(i((u||(u=o(e,t.map(r),xt)))(l)))},d.domain=function(l){return arguments.length?(t=Array.from(l,qs),c()):t.slice()},d.range=function(l){return arguments.length?(e=Array.from(l),c()):e.slice()},d.rangeRound=function(l){return e=Array.from(l),n=Gs,c()},d.clamp=function(l){return arguments.length?(a=l?!0:Ae,c()):a!==Ae},d.interpolate=function(l){return arguments.length?(n=l,c()):n},d.unknown=function(l){return arguments.length?(s=l,d):s},function(l,h){return r=l,i=h,c()}}function Vs(){return Ys()(Ae,Ae)}function Ks(t){return Math.abs(t=Math.round(t))>=1e21?t.toLocaleString("en").replace(/,/g,""):t.toString(10)}function yt(t,e){if((n=(t=e?t.toExponential(e-1):t.toExponential()).indexOf("e"))<0)return null;var n,r=t.slice(0,n);return[r.length>1?r[0]+r.slice(2):r,+t.slice(n+1)]}function ke(t){return t=yt(Math.abs(t)),t?t[1]:NaN}function Js(t,e){return function(n,r){for(var i=n.length,s=[],a=0,o=t[0],f=0;i>0&&o>0&&(f+o+1>r&&(o=Math.max(1,r-f)),s.push(n.substring(i-=o,i+o)),!((f+=o+1)>r));)o=t[a=(a+1)%t.length];return s.reverse().join(e)}}function Xs(t){return function(e){return e.replace(/[0-9]/g,function(n){return t[+n]})}}var Zs=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function bt(t){if(!(e=Zs.exec(t)))throw new Error("invalid format: "+t);var e;return new _n({fill:e[1],align:e[2],sign:e[3],symbol:e[4],zero:e[5],width:e[6],comma:e[7],precision:e[8]&&e[8].slice(1),trim:e[9],type:e[10]})}bt.prototype=_n.prototype;function _n(t){this.fill=t.fill===void 0?" ":t.fill+"",this.align=t.align===void 0?">":t.align+"",this.sign=t.sign===void 0?"-":t.sign+"",this.symbol=t.symbol===void 0?"":t.symbol+"",this.zero=!!t.zero,this.width=t.width===void 0?void 0:+t.width,this.comma=!!t.comma,this.precision=t.precision===void 0?void 0:+t.precision,this.trim=!!t.trim,this.type=t.type===void 0?"":t.type+""}_n.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(this.width===void 0?"":Math.max(1,this.width|0))+(this.comma?",":"")+(this.precision===void 0?"":"."+Math.max(0,this.precision|0))+(this.trim?"~":"")+this.type};function Qs(t){e:for(var e=t.length,n=1,r=-1,i;n<e;++n)switch(t[n]){case".":r=i=n;break;case"0":r===0&&(r=n),i=n;break;default:if(!+t[n])break e;r>0&&(r=0);break}return r>0?t.slice(0,r)+t.slice(i+1):t}var Pr;function ea(t,e){var n=yt(t,e);if(!n)return t+"";var r=n[0],i=n[1],s=i-(Pr=Math.max(-8,Math.min(8,Math.floor(i/3)))*3)+1,a=r.length;return s===a?r:s>a?r+new Array(s-a+1).join("0"):s>0?r.slice(0,s)+"."+r.slice(s):"0."+new Array(1-s).join("0")+yt(t,Math.max(0,e+s-1))[0]}function Wn(t,e){var n=yt(t,e);if(!n)return t+"";var r=n[0],i=n[1];return i<0?"0."+new Array(-i).join("0")+r:r.length>i+1?r.slice(0,i+1)+"."+r.slice(i+1):r+new Array(i-r.length+2).join("0")}const zn={"%":(t,e)=>(t*100).toFixed(e),b:t=>Math.round(t).toString(2),c:t=>t+"",d:Ks,e:(t,e)=>t.toExponential(e),f:(t,e)=>t.toFixed(e),g:(t,e)=>t.toPrecision(e),o:t=>Math.round(t).toString(8),p:(t,e)=>Wn(t*100,e),r:Wn,s:ea,X:t=>Math.round(t).toString(16).toUpperCase(),x:t=>Math.round(t).toString(16)};function Yn(t){return t}var Vn=Array.prototype.map,Kn=["y","z","a","f","p","n","","m","","k","M","G","T","P","E","Z","Y"];function ta(t){var e=t.grouping===void 0||t.thousands===void 0?Yn:Js(Vn.call(t.grouping,Number),t.thousands+""),n=t.currency===void 0?"":t.currency[0]+"",r=t.currency===void 0?"":t.currency[1]+"",i=t.decimal===void 0?".":t.decimal+"",s=t.numerals===void 0?Yn:Xs(Vn.call(t.numerals,String)),a=t.percent===void 0?"%":t.percent+"",o=t.minus===void 0?"":t.minus+"",f=t.nan===void 0?"NaN":t.nan+"";function u(d){d=bt(d);var l=d.fill,h=d.align,p=d.sign,b=d.symbol,$=d.zero,v=d.width,S=d.comma,A=d.precision,_=d.trim,g=d.type;g==="n"?(S=!0,g="g"):zn[g]||(A===void 0&&(A=12),_=!0,g="g"),($||l==="0"&&h==="=")&&($=!0,l="0",h="=");var w=b==="$"?n:b==="#"&&/[boxX]/.test(g)?"0"+g.toLowerCase():"",I=b==="$"?r:/[%p]/.test(g)?a:"",x=zn[g],D=/[defgprs%]/.test(g);A=A===void 0?6:/[gprs]/.test(g)?Math.max(1,Math.min(21,A)):Math.max(0,Math.min(20,A));function U(y){var C=w,k=I,L,J,z;if(g==="c")k=x(y)+k,y="";else{y=+y;var we=y<0||1/y<0;if(y=isNaN(y)?f:x(Math.abs(y),A),_&&(y=Qs(y)),we&&+y==0&&p!=="+"&&(we=!1),C=(we?p==="("?p:o:p==="-"||p==="("?"":p)+C,k=(g==="s"?Kn[8+Pr/3]:"")+k+(we&&p==="("?")":""),D){for(L=-1,J=y.length;++L<J;)if(z=y.charCodeAt(L),48>z||z>57){k=(z===46?i+y.slice(L+1):y.slice(L))+k,y=y.slice(0,L);break}}}S&&!$&&(y=e(y,1/0));var Xe=C.length+y.length+k.length,ie=Xe<v?new Array(v-Xe+1).join(l):"";switch(S&&$&&(y=e(ie+y,ie.length?v-k.length:1/0),ie=""),h){case"<":y=C+y+k+ie;break;case"=":y=C+ie+y+k;break;case"^":y=ie.slice(0,Xe=ie.length>>1)+C+y+k+ie.slice(Xe);break;default:y=ie+C+y+k;break}return s(y)}return U.toString=function(){return d+""},U}function c(d,l){var h=u((d=bt(d),d.type="f",d)),p=Math.max(-8,Math.min(8,Math.floor(ke(l)/3)))*3,b=Math.pow(10,-p),$=Kn[8+p/3];return function(v){return h(b*v)+$}}return{format:u,formatPrefix:c}}var nt,Sr,Nr;na({thousands:",",grouping:[3],currency:["$",""]});function na(t){return nt=ta(t),Sr=nt.format,Nr=nt.formatPrefix,nt}function ra(t){return Math.max(0,-ke(Math.abs(t)))}function ia(t,e){return Math.max(0,Math.max(-8,Math.min(8,Math.floor(ke(e)/3)))*3-ke(Math.abs(t)))}function sa(t,e){return t=Math.abs(t),e=Math.abs(e)-t,Math.max(0,ke(e)-ke(t))+1}function aa(t,e,n,r){var i=gs(t,e,n),s;switch(r=bt(r??",f"),r.type){case"s":{var a=Math.max(Math.abs(t),Math.abs(e));return r.precision==null&&!isNaN(s=ia(i,a))&&(r.precision=s),Nr(r,a)}case"":case"e":case"g":case"p":case"r":{r.precision==null&&!isNaN(s=sa(i,Math.max(Math.abs(t),Math.abs(e))))&&(r.precision=s-(r.type==="e"));break}case"f":case"%":{r.precision==null&&!isNaN(s=ra(i))&&(r.precision=s-(r.type==="%")*2);break}}return Sr(r)}function ua(t){var e=t.domain;return t.ticks=function(n){var r=e();return ps(r[0],r[r.length-1],n??10)},t.tickFormat=function(n,r){var i=e();return aa(i[0],i[i.length-1],n??10,r)},t.nice=function(n){n==null&&(n=10);var r=e(),i=0,s=r.length-1,a=r[i],o=r[s],f,u,c=10;for(o<a&&(u=a,a=o,o=u,u=i,i=s,s=u);c-- >0;){if(u=Tt(a,o,n),u===f)return r[i]=a,r[s]=o,e(r);if(u>0)a=Math.floor(a/u)*u,o=Math.ceil(o/u)*u;else if(u<0)a=Math.ceil(a*u)/u,o=Math.floor(o*u)/u;else break;f=u}return t},t}function Gt(){var t=Vs();return t.copy=function(){return zs(t,Gt())},ms.apply(t,arguments),ua(t)}var oa=br('<line stroke="black"></line>'),fa=br('<!><circle fill="black"></circle><text> </text>',1),la=Ke('<div><div>Loss History</div> <div><svg style="overflow: visible; outline: 1px solid black;"><!></svg></div></div>');function ca(t,e){Yt(e,!1);const n=Fe(),r=Fe();let i=Pt(e,"height",8,250),s=Pt(e,"width",8,500),a=Pt(e,"loss",24,()=>[]);function o(h){if(h.length===0)return 0;let p=h[0];for(let b=0;b<h.length;b++)h[b]>p&&(p=h[b]);return p}On(()=>(Ue(a()),Ue(s())),()=>{T(n,Gt().domain([0,a().length-1]).range([0,s()]))}),On(()=>(Ue(a()),Ue(i())),()=>{T(r,Gt().domain([0,o(a())]).range([i(),0]))}),yi(),$r();var f=la(),u=Ge(me(f),2),c=me(u),d=me(c);{var l=h=>{var p=fa(),b=sr(p);Gi(b,1,()=>({length:a().length-1}),Ci,(A,_,g)=>{var w=oa();const I=se(()=>g),x=se(()=>g+1),D=se(()=>a()[E(I)]),U=se(()=>a()[E(x)]);V(w,"stroke-width",2),rt((y,C,k,L)=>{V(w,"x1",y),V(w,"x2",C),V(w,"y1",k),V(w,"y2",L)},[()=>E(n)(E(I)),()=>E(n)(E(x)),()=>E(r)(E(D)),()=>E(r)(E(U))],se),xe(A,w)});var $=Ge(b);V($,"r",4);var v=Ge($),S=me(v);rt((A,_)=>{V($,"cx",s()),V($,"cy",A),V(v,"x",s()+4),V(v,"y",A),wr(S,_)},[()=>E(r)(a().at(-1)),()=>a().at(-1).toFixed(5)],se),xe(h,p)};gt(d,h=>{a().length>0&&h(l)})}rt(()=>{V(c,"width",s()),V(c,"height",i())}),xe(t,f),Vt()}var da=Ke("<div>Loading MNIST Test 10k data...</div>"),ha=Ke("<div> </div>"),pa=Ke("<!> <!> <div><!></div>",1);function ga(t,e){Yt(e,!1);let n=Fe(!1);async function r(){T(n,!0);const g=await(await fetch("mnist_test.json")).json(),w=g.x,I=g.y;return T(n,!1),[w,I]}function i(_,g){const x=de.tensor(m.randn([_,g],0,.1),!0),D=de.tensor(m.randn([1,g],0,.1),!0);return[x,D]}function s(_,g=[728,128],w=32,I=10){let x=[];for(let k=0;k<g.length-1;k++){const[L,J]=i(g[k],g[k+1]);x.push(L),x.push(J),_=_.matmul(L).add(J.expand([w,g[k+1]])).relu()}const[D,U]=i(g.at(-1),I);return x.push(D),x.push(U),[_.matmul(D).add(U.expand([w,I])).softmax(-1),x]}function a(_,g,w=32){return _.log().mul(g).sum(-1).sum(0).mul(-1/w)}function o(_){const g=new Float32Array(_.length*_[0].length);for(let w=0;w<_.length;w++)for(let I=0;I<_[0].length;I++)g[w*_[0].length+I]=_[w][I];return g}const f=64,u=.1,c=5;let d=Fe([]),l=Fe();zi(async()=>{const g=await(await navigator.gpu.requestAdapter()).requestDevice();T(l,{vendor:g.adapterInfo.vendor,architecture:g.adapterInfo.architecture}),m.setDevice(g);const[w,I]=await r(),x=de.tensor(m.fill(1,[f,28*28])),[D,U]=s(x,[28*28,128,128],f),y=de.tensor(m.fill(1,[f,10])),C=a(D,y,f),k=new ss(U,u),L=(J,z)=>o(J.slice(z,z+f));for(let J=0;J<c;J++){console.log("EPOCH"+(J+1));for(let z=0;z<w.length-f;z+=f)if(x.tensor.setGPUBuffer(L(w,z)),y.tensor.setGPUBuffer(L(I,z)),C.forward(),C.zeroGrad(),C.backward(),k.update(),z%10===0){const we=await C.tensor.cpuBuffer();E(d).push(we[0]),T(d,E(d))}}}),$r();var h=pa(),p=sr(h);{var b=_=>{var g=da();xe(_,g)};gt(p,_=>{E(n)&&_(b)})}var $=Ge(p,2);{var v=_=>{var g=ha(),w=me(g);rt(I=>wr(w,`Running on ${I??""}`),[()=>JSON.stringify(E(l),null,4)],se),xe(_,g)};gt($,_=>{E(l)&&_(v)})}var S=Ge($,2),A=me(S);ca(A,{get loss(){return E(d)}}),xe(t,h),Vt()}var ma=Ke("<main><!></main>");function va(t){var e=ma(),n=me(e);{var r=i=>{ga(i,{})};gt(n,i=>{i(r)})}xe(t,e)}Ri(va,{target:document.getElementById("app")});
