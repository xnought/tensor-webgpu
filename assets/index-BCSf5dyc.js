(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const s of i)if(s.type==="childList")for(const a of s.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&r(a)}).observe(document,{childList:!0,subtree:!0});function n(i){const s={};return i.integrity&&(s.integrity=i.integrity),i.referrerPolicy&&(s.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?s.credentials="include":i.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function r(i){if(i.ep)return;i.ep=!0;const s=n(i);fetch(i.href,s)}})();const Or=!1;var Un=Array.isArray,gs=Array.prototype.indexOf,qn=Array.from,vs=Object.defineProperty,te=Object.getOwnPropertyDescriptor,oi=Object.getOwnPropertyDescriptors,_s=Object.prototype,ms=Array.prototype,Gn=Object.getPrototypeOf;function ys(t){return t()}function En(t){for(var e=0;e<t.length;e++)t[e]()}const ht=2,ui=4,Ae=8,Hn=16,bt=32,ae=64,Fe=128,wt=256,Le=512,X=1024,kt=2048,Vt=4096,Mt=8192,on=16384,ws=32768,Wn=65536,xs=1<<17,bs=1<<19,fi=1<<20,Gt=Symbol("$state"),As=Symbol("legacy props"),Es=Symbol("");function li(t){return t===this.v}function Os(t,e){return t!=t?e==e:t!==e||t!==null&&typeof t=="object"||typeof t=="function"}function zn(t){return!Os(t,this.v)}function $s(t){throw new Error("https://svelte.dev/e/effect_in_teardown")}function Ss(){throw new Error("https://svelte.dev/e/effect_in_unowned_derived")}function Ms(t){throw new Error("https://svelte.dev/e/effect_orphan")}function Ns(){throw new Error("https://svelte.dev/e/effect_update_depth_exceeded")}function Is(t){throw new Error("https://svelte.dev/e/props_invalid_value")}function ks(){throw new Error("https://svelte.dev/e/state_descriptors_fixed")}function Ps(){throw new Error("https://svelte.dev/e/state_prototype_fixed")}function Bs(){throw new Error("https://svelte.dev/e/state_unsafe_local_read")}function Ds(){throw new Error("https://svelte.dev/e/state_unsafe_mutation")}let oe=!1,Ts=!1;function Rs(){oe=!0}const Yn=1,Vn=2,ci=4,Cs=8,Fs=16,Ls=1,Us=2,qs=4,Gs=8,Hs=16,hi=1,Ws=2,tt=Symbol();function zs(t){throw new Error("https://svelte.dev/e/lifecycle_outside_component")}let C=null;function $r(t){C=t}function un(t,e=!1,n){C={p:C,c:null,e:null,m:!1,s:t,x:null,l:null},oe&&!e&&(C.l={s:null,u:null,r1:[],r2:at(!1)})}function fn(t){const e=C;if(e!==null){const a=e.e;if(a!==null){var n=B,r=R;e.e=null;try{for(var i=0;i<a.length;i++){var s=a[i];xt(s.effect),Tt(s.reaction),Kn(s.fn)}}finally{xt(n),Tt(r)}}C=e.p,e.m=!0}return{}}function ln(){return!oe||C!==null&&C.l===null}function at(t,e){var n={f:0,v:t,reactions:null,equals:li,rv:0,wv:0};return n}function Xn(t,e=!1){var r;const n=at(t);return e||(n.equals=zn),oe&&C!==null&&C.l!==null&&((r=C.l).s??(r.s=[])).push(n),n}function st(t,e=!1){return Ys(Xn(t,e))}function Ys(t){return R!==null&&!Nt&&R.f&ht&&(mt===null?sa([t]):mt.push(t)),t}function Vs(t,e){return D(t,zt(()=>m(t))),e}function D(t,e){return R!==null&&!Nt&&ln()&&R.f&(ht|Hn)&&(mt===null||!mt.includes(t))&&Ds(),On(t,e)}function On(t,e){return t.equals(e)||(t.v,t.v=e,t.wv=Si(),di(t,kt),ln()&&B!==null&&B.f&X&&!(B.f&(bt|ae))&&($t===null?aa([t]):$t.push(t))),e}function di(t,e){var n=t.reactions;if(n!==null)for(var r=ln(),i=n.length,s=0;s<i;s++){var a=n[s],o=a.f;o&kt||!r&&a===B||(dt(a,e),o&(X|wt)&&(o&ht?di(a,Vt):gn(a)))}}let Xs=!1;function jt(t,e=null,n){if(typeof t!="object"||t===null||Gt in t)return t;const r=Gn(t);if(r!==_s&&r!==ms)return t;var i=new Map,s=Un(t),a=at(0);s&&i.set("length",at(t.length));var o;return new Proxy(t,{defineProperty(f,u,l){(!("value"in l)||l.configurable===!1||l.enumerable===!1||l.writable===!1)&&ks();var h=i.get(u);return h===void 0?(h=at(l.value),i.set(u,h)):D(h,jt(l.value,o)),!0},deleteProperty(f,u){var l=i.get(u);if(l===void 0)u in f&&i.set(u,at(tt));else{if(s&&typeof u=="string"){var h=i.get("length"),c=Number(u);Number.isInteger(c)&&c<h.v&&D(h,c)}D(l,tt),Sr(a)}return!0},get(f,u,l){var p;if(u===Gt)return t;var h=i.get(u),c=u in f;if(h===void 0&&(!c||(p=te(f,u))!=null&&p.writable)&&(h=at(jt(c?f[u]:tt,o)),i.set(u,h)),h!==void 0){var d=m(h);return d===tt?void 0:d}return Reflect.get(f,u,l)},getOwnPropertyDescriptor(f,u){var l=Reflect.getOwnPropertyDescriptor(f,u);if(l&&"value"in l){var h=i.get(u);h&&(l.value=m(h))}else if(l===void 0){var c=i.get(u),d=c==null?void 0:c.v;if(c!==void 0&&d!==tt)return{enumerable:!0,configurable:!0,value:d,writable:!0}}return l},has(f,u){var d;if(u===Gt)return!0;var l=i.get(u),h=l!==void 0&&l.v!==tt||Reflect.has(f,u);if(l!==void 0||B!==null&&(!h||(d=te(f,u))!=null&&d.writable)){l===void 0&&(l=at(h?jt(f[u],o):tt),i.set(u,l));var c=m(l);if(c===tt)return!1}return h},set(f,u,l,h){var b;var c=i.get(u),d=u in f;if(s&&u==="length")for(var p=l;p<c.v;p+=1){var g=i.get(p+"");g!==void 0?D(g,tt):p in f&&(g=at(tt),i.set(p+"",g))}c===void 0?(!d||(b=te(f,u))!=null&&b.writable)&&(c=at(void 0),D(c,jt(l,o)),i.set(u,c)):(d=c.v!==tt,D(c,jt(l,o)));var w=Reflect.getOwnPropertyDescriptor(f,u);if(w!=null&&w.set&&w.set.call(h,l),!d){if(s&&typeof u=="string"){var I=i.get("length"),M=Number(u);Number.isInteger(M)&&M>=I.v&&D(I,M+1)}Sr(a)}return!0},ownKeys(f){m(a);var u=Reflect.ownKeys(f).filter(c=>{var d=i.get(c);return d===void 0||d.v!==tt});for(var[l,h]of i)h.v!==tt&&!(l in f)&&u.push(l);return u},setPrototypeOf(){Ps()}})}function Sr(t,e=1){D(t,t.v+e)}var Mr,pi,gi;function Ks(){if(Mr===void 0){Mr=window;var t=Element.prototype,e=Node.prototype;pi=te(e,"firstChild").get,gi=te(e,"nextSibling").get,t.__click=void 0,t.__className="",t.__attributes=null,t.__styles=null,t.__e=void 0,Text.prototype.__t=void 0}}function vi(t=""){return document.createTextNode(t)}function St(t){return pi.call(t)}function cn(t){return gi.call(t)}function lt(t,e){return St(t)}function ke(t,e){{var n=St(t);return n instanceof Comment&&n.data===""?cn(n):n}}function vt(t,e=1,n=!1){let r=t;for(;e--;)r=cn(r);return r}function Js(t){t.textContent=""}function me(t){var e=ht|kt,n=R!==null&&R.f&ht?R:null;return B===null||n!==null&&n.f&wt?e|=wt:B.f|=fi,{ctx:C,deps:null,effects:null,equals:li,f:e,fn:t,reactions:null,rv:0,v:null,wv:0,parent:n??B}}function _t(t){const e=me(t);return e.equals=zn,e}function _i(t){var e=t.effects;if(e!==null){t.effects=null;for(var n=0;n<e.length;n+=1)Dt(e[n])}}function Zs(t){for(var e=t.parent;e!==null;){if(!(e.f&ht))return e;e=e.parent}return null}function js(t){var e,n=B;xt(Zs(t));try{_i(t),e=Ni(t)}finally{xt(n)}return e}function mi(t){var e=js(t),n=(Lt||t.f&wt)&&t.deps!==null?Vt:X;dt(t,n),t.equals(e)||(t.v=e,t.wv=Si())}function yi(t){B===null&&R===null&&Ms(),R!==null&&R.f&wt&&B===null&&Ss(),Qn&&$s()}function Qs(t,e){var n=e.last;n===null?e.last=e.first=t:(n.next=t,t.prev=n,e.last=t)}function ue(t,e,n,r=!0){var i=(t&ae)!==0,s=B,a={ctx:C,deps:null,nodes_start:null,nodes_end:null,f:t|kt,first:null,fn:e,last:null,next:null,parent:i?null:s,prev:null,teardown:null,transitions:null,wv:0};if(n){var o=ee;try{Nr(!0),pn(a),a.f|=ws}catch(l){throw Dt(a),l}finally{Nr(o)}}else e!==null&&gn(a);var f=n&&a.deps===null&&a.first===null&&a.nodes_start===null&&a.teardown===null&&(a.f&(fi|Fe))===0;if(!f&&!i&&r&&(s!==null&&Qs(a,s),R!==null&&R.f&ht)){var u=R;(u.effects??(u.effects=[])).push(a)}return a}function ta(t){const e=ue(Ae,null,!1);return dt(e,X),e.teardown=t,e}function $n(t){yi();var e=B!==null&&(B.f&bt)!==0&&C!==null&&!C.m;if(e){var n=C;(n.e??(n.e=[])).push({fn:t,effect:B,reaction:R})}else{var r=Kn(t);return r}}function ea(t){return yi(),hn(t)}function na(t){const e=ue(ae,t,!0);return(n={})=>new Promise(r=>{n.outro?qe(e,()=>{Dt(e),r(void 0)}):(Dt(e),r(void 0))})}function Kn(t){return ue(ui,t,!1)}function Ue(t,e){var n=C,r={effect:null,ran:!1};n.l.r1.push(r),r.effect=hn(()=>{t(),!r.ran&&(r.ran=!0,D(n.l.r2,!0),zt(e))})}function wi(){var t=C;hn(()=>{if(m(t.l.r2)){for(var e of t.l.r1){var n=e.effect;n.f&X&&dt(n,Vt),fe(n)&&pn(n),e.ran=!1}t.l.r2.v=!1}})}function hn(t){return ue(Ae,t,!0)}function Ht(t,e=[],n=me){const r=e.map(n);return Jn(()=>t(...r.map(m)))}function Jn(t,e=0){return ue(Ae|Hn|e,t,!0)}function ye(t,e=!0){return ue(Ae|bt,t,!0,e)}function xi(t){var e=t.teardown;if(e!==null){const n=Qn,r=R;Ir(!0),Tt(null);try{e.call(null)}finally{Ir(n),Tt(r)}}}function bi(t,e=!1){var n=t.first;for(t.first=t.last=null;n!==null;){var r=n.next;Dt(n,e),n=r}}function ra(t){for(var e=t.first;e!==null;){var n=e.next;e.f&bt||Dt(e),e=n}}function Dt(t,e=!0){var n=!1;if((e||t.f&bs)&&t.nodes_start!==null){for(var r=t.nodes_start,i=t.nodes_end;r!==null;){var s=r===i?null:cn(r);r.remove(),r=s}n=!0}bi(t,e&&!n),Ye(t,0),dt(t,on);var a=t.transitions;if(a!==null)for(const f of a)f.stop();xi(t);var o=t.parent;o!==null&&o.first!==null&&Ai(t),t.next=t.prev=t.teardown=t.ctx=t.deps=t.fn=t.nodes_start=t.nodes_end=null}function Ai(t){var e=t.parent,n=t.prev,r=t.next;n!==null&&(n.next=r),r!==null&&(r.prev=n),e!==null&&(e.first===t&&(e.first=r),e.last===t&&(e.last=n))}function qe(t,e){var n=[];Zn(t,n,!0),Ei(n,()=>{Dt(t),e&&e()})}function Ei(t,e){var n=t.length;if(n>0){var r=()=>--n||e();for(var i of t)i.out(r)}else e()}function Zn(t,e,n){if(!(t.f&Mt)){if(t.f^=Mt,t.transitions!==null)for(const a of t.transitions)(a.is_global||n)&&e.push(a);for(var r=t.first;r!==null;){var i=r.next,s=(r.f&Wn)!==0||(r.f&bt)!==0;Zn(r,e,s?n:!1),r=i}}}function Ge(t){Oi(t,!0)}function Oi(t,e){if(t.f&Mt){t.f^=Mt,t.f&X||(t.f^=X),fe(t)&&(dt(t,kt),gn(t));for(var n=t.first;n!==null;){var r=n.next,i=(n.f&Wn)!==0||(n.f&bt)!==0;Oi(n,i?e:!1),n=r}if(t.transitions!==null)for(const s of t.transitions)(s.is_global||e)&&s.in()}}let Sn=!1,Mn=[];function ia(){Sn=!1;const t=Mn.slice();Mn=[],En(t)}function jn(t){Sn||(Sn=!0,queueMicrotask(ia)),Mn.push(t)}let Pe=!1,He=!1,We=null,ee=!1,Qn=!1;function Nr(t){ee=t}function Ir(t){Qn=t}let Nn=[],_e=0;let R=null,Nt=!1;function Tt(t){R=t}let B=null;function xt(t){B=t}let mt=null;function sa(t){mt=t}let et=null,rt=0,$t=null;function aa(t){$t=t}let $i=1,ze=0,Lt=!1;function Si(){return++$i}function fe(t){var u;var e=t.f;if(e&kt)return!0;if(e&Vt){var n=t.deps,r=(e&wt)!==0;if(n!==null){var i,s,a=(e&Le)!==0,o=r&&B!==null&&!Lt,f=n.length;if(a||o){for(i=0;i<f;i++)s=n[i],(a||!((u=s==null?void 0:s.reactions)!=null&&u.includes(t)))&&(s.reactions??(s.reactions=[])).push(t);a&&(t.f^=Le)}for(i=0;i<f;i++)if(s=n[i],fe(s)&&mi(s),s.wv>t.wv)return!0}(!r||B!==null&&!Lt)&&dt(t,X)}return!1}function oa(t,e){for(var n=e;n!==null;){if(n.f&Fe)try{n.fn(t);return}catch{n.f^=Fe}n=n.parent}throw Pe=!1,t}function ua(t){return(t.f&on)===0&&(t.parent===null||(t.parent.f&Fe)===0)}function dn(t,e,n,r){if(Pe){if(n===null&&(Pe=!1),ua(e))throw t;return}n!==null&&(Pe=!0);{oa(t,e);return}}function Mi(t,e,n=0){var r=t.reactions;if(r!==null)for(var i=0;i<r.length;i++){var s=r[i];s.f&ht?Mi(s,e,n+1):e===s&&(n===0?dt(s,kt):s.f&X&&dt(s,Vt),gn(s))}}function Ni(t){var d;var e=et,n=rt,r=$t,i=R,s=Lt,a=mt,o=C,f=Nt,u=t.f;et=null,rt=0,$t=null,R=u&(bt|ae)?null:t,Lt=(u&wt)!==0&&(!ee||(i===null||f)&&t.parent!==null),mt=null,$r(t.ctx),Nt=!1,ze++;try{var l=(0,t.fn)(),h=t.deps;if(et!==null){var c;if(Ye(t,rt),h!==null&&rt>0)for(h.length=rt+et.length,c=0;c<et.length;c++)h[rt+c]=et[c];else t.deps=h=et;if(!Lt)for(c=rt;c<h.length;c++)((d=h[c]).reactions??(d.reactions=[])).push(t)}else h!==null&&rt<h.length&&(Ye(t,rt),h.length=rt);if(ln()&&$t!==null&&!(t.f&(ht|Vt|kt)))for(c=0;c<$t.length;c++)Mi($t[c],t);return i!==null&&ze++,l}finally{et=e,rt=n,$t=r,R=i,Lt=s,mt=a,$r(o),Nt=f}}function fa(t,e){let n=e.reactions;if(n!==null){var r=gs.call(n,t);if(r!==-1){var i=n.length-1;i===0?n=e.reactions=null:(n[r]=n[i],n.pop())}}n===null&&e.f&ht&&(et===null||!et.includes(e))&&(dt(e,Vt),e.f&(wt|Le)||(e.f^=Le),_i(e),Ye(e,0))}function Ye(t,e){var n=t.deps;if(n!==null)for(var r=e;r<n.length;r++)fa(t,n[r])}function pn(t){var e=t.f;if(!(e&on)){dt(t,X);var n=B,r=C;B=t;try{e&Hn?ra(t):bi(t),xi(t);var i=Ni(t);t.teardown=typeof i=="function"?i:null,t.wv=$i;var s=t.deps,a;Or&&Ts&&t.f&kt}catch(o){dn(o,t,n,r||t.ctx)}finally{B=n}}}function la(){if(_e>1e3){_e=0;try{Ns()}catch(t){if(We!==null)dn(t,We,null);else throw t}}_e++}function ca(t){var e=t.length;if(e!==0){la();var n=ee;ee=!0;try{for(var r=0;r<e;r++){var i=t[r];i.f&X||(i.f^=X);var s=[];Ii(i,s),ha(s)}}finally{ee=n}}}function ha(t){var e=t.length;if(e!==0)for(var n=0;n<e;n++){var r=t[n];if(!(r.f&(on|Mt)))try{fe(r)&&(pn(r),r.deps===null&&r.first===null&&r.nodes_start===null&&(r.teardown===null?Ai(r):r.fn=null))}catch(i){dn(i,r,null,r.ctx)}}}function da(){if(He=!1,_e>1001)return;const t=Nn;Nn=[],ca(t),He||(_e=0,We=null)}function gn(t){He||(He=!0,queueMicrotask(da)),We=t;for(var e=t;e.parent!==null;){e=e.parent;var n=e.f;if(n&(ae|bt)){if(!(n&X))return;e.f^=X}}Nn.push(e)}function Ii(t,e){var n=t.first,r=[];t:for(;n!==null;){var i=n.f,s=(i&bt)!==0,a=s&&(i&X)!==0,o=n.next;if(!a&&!(i&Mt))if(i&Ae){if(s)n.f^=X;else{var f=R;try{R=n,fe(n)&&pn(n)}catch(c){dn(c,n,null,n.ctx)}finally{R=f}}var u=n.first;if(u!==null){n=u;continue}}else i&ui&&r.push(n);if(o===null){let c=n.parent;for(;c!==null;){if(t===c)break t;var l=c.next;if(l!==null){n=l;continue t}c=c.parent}}n=o}for(var h=0;h<r.length;h++)u=r[h],e.push(u),Ii(u,e)}function m(t){var e=t.f,n=(e&ht)!==0;if(R!==null&&!Nt){mt!==null&&mt.includes(t)&&Bs();var r=R.deps;t.rv<ze&&(t.rv=ze,et===null&&r!==null&&r[rt]===t?rt++:et===null?et=[t]:et.push(t))}else if(n&&t.deps===null&&t.effects===null){var i=t,s=i.parent;s!==null&&!(s.f&wt)&&(i.f^=wt)}return n&&(i=t,fe(i)&&mi(i)),t.v}function zt(t){var e=Nt;try{return Nt=!0,t()}finally{Nt=e}}const pa=-7169;function dt(t,e){t.f=t.f&pa|e}function Ut(t){if(!(typeof t!="object"||!t||t instanceof EventTarget)){if(Gt in t)In(t);else if(!Array.isArray(t))for(let e in t){const n=t[e];typeof n=="object"&&n&&Gt in n&&In(n)}}}function In(t,e=new Set){if(typeof t=="object"&&t!==null&&!(t instanceof EventTarget)&&!e.has(t)){e.add(t),t instanceof Date&&t.getTime();for(let r in t)try{In(t[r],e)}catch{}const n=Gn(t);if(n!==Object.prototype&&n!==Array.prototype&&n!==Map.prototype&&n!==Set.prototype&&n!==Date.prototype){const r=oi(n);for(let i in r){const s=r[i].get;if(s)try{s.call(t)}catch{}}}}}const ga=["touchstart","touchmove"];function va(t){return ga.includes(t)}function _a(t){var e=R,n=B;Tt(null),xt(null);try{return t()}finally{Tt(e),xt(n)}}const ma=new Set,kr=new Set;function ya(t,e,n,r={}){function i(s){if(r.capture||he.call(e,s),!s.cancelBubble)return _a(()=>n==null?void 0:n.call(this,s))}return t.startsWith("pointer")||t.startsWith("touch")||t==="wheel"?jn(()=>{e.addEventListener(t,i,r)}):e.addEventListener(t,i,r),i}function Be(t,e,n,r,i){var s={capture:r,passive:i},a=ya(t,e,n,s);(e===document.body||e===window||e===document)&&ta(()=>{e.removeEventListener(t,a,s)})}function he(t){var M;var e=this,n=e.ownerDocument,r=t.type,i=((M=t.composedPath)==null?void 0:M.call(t))||[],s=i[0]||t.target,a=0,o=t.__root;if(o){var f=i.indexOf(o);if(f!==-1&&(e===document||e===window)){t.__root=e;return}var u=i.indexOf(e);if(u===-1)return;f<=u&&(a=f)}if(s=i[a]||t.target,s!==e){vs(t,"currentTarget",{configurable:!0,get(){return s||n}});var l=R,h=B;Tt(null),xt(null);try{for(var c,d=[];s!==null;){var p=s.assignedSlot||s.parentNode||s.host||null;try{var g=s["__"+r];if(g!==void 0&&!s.disabled)if(Un(g)){var[w,...I]=g;w.apply(s,[t,...I])}else g.call(s,t)}catch(b){c?d.push(b):c=b}if(t.cancelBubble||p===e||p===null)break;s=p}if(c){for(let b of d)queueMicrotask(()=>{throw b});throw c}}finally{t.__root=e,delete t.currentTarget,Tt(l),xt(h)}}}function ki(t){var e=document.createElement("template");return e.innerHTML=t,e.content}function Ve(t,e){var n=B;n.nodes_start===null&&(n.nodes_start=t,n.nodes_end=e)}function At(t,e){var n=(e&hi)!==0,r=(e&Ws)!==0,i,s=!t.startsWith("<!>");return()=>{i===void 0&&(i=ki(s?t:"<!>"+t),n||(i=St(i)));var a=r?document.importNode(i,!0):i.cloneNode(!0);if(n){var o=St(a),f=a.lastChild;Ve(o,f)}else Ve(a,a);return a}}function Pi(t,e,n="svg"){var r=!t.startsWith("<!>"),i=(e&hi)!==0,s=`<${n}>${r?t:"<!>"+t}</${n}>`,a;return()=>{if(!a){var o=ki(s),f=St(o);if(i)for(a=document.createDocumentFragment();St(f);)a.appendChild(St(f));else a=St(f)}var u=a.cloneNode(!0);if(i){var l=St(u),h=u.lastChild;Ve(l,h)}else Ve(u,u);return u}}function ot(t,e){t!==null&&t.before(e)}function kn(t,e){var n=e==null?"":typeof e=="object"?e+"":e;n!==(t.__t??(t.__t=t.nodeValue))&&(t.__t=n,t.nodeValue=n+"")}function wa(t,e){return xa(t,e)}const Jt=new Map;function xa(t,{target:e,anchor:n,props:r={},events:i,context:s,intro:a=!0}){Ks();var o=new Set,f=h=>{for(var c=0;c<h.length;c++){var d=h[c];if(!o.has(d)){o.add(d);var p=va(d);e.addEventListener(d,he,{passive:p});var g=Jt.get(d);g===void 0?(document.addEventListener(d,he,{passive:p}),Jt.set(d,1)):Jt.set(d,g+1)}}};f(qn(ma)),kr.add(f);var u=void 0,l=na(()=>{var h=n??e.appendChild(vi());return ye(()=>{if(s){un({});var c=C;c.c=s}i&&(r.$$events=i),u=t(h,r)||{},s&&fn()}),()=>{var p;for(var c of o){e.removeEventListener(c,he);var d=Jt.get(c);--d===0?(document.removeEventListener(c,he),Jt.delete(c)):Jt.set(c,d)}kr.delete(f),h!==n&&((p=h.parentNode)==null||p.removeChild(h))}});return ba.set(u,l),u}let ba=new WeakMap;function Ft(t,e,n=!1){var r=t,i=null,s=null,a=tt,o=n?Wn:0,f=!1;const u=(h,c=!0)=>{f=!0,l(c,h)},l=(h,c)=>{a!==(a=h)&&(a?(i?Ge(i):c&&(i=ye(()=>c(r))),s&&qe(s,()=>{s=null})):(s?Ge(s):c&&(s=ye(()=>c(r))),i&&qe(i,()=>{i=null})))};Jn(()=>{f=!1,e(u),f||l(null,null)},o)}function Bi(t,e){return e}function Aa(t,e,n,r){for(var i=[],s=e.length,a=0;a<s;a++)Zn(e[a].e,i,!0);var o=s>0&&i.length===0&&n!==null;if(o){var f=n.parentNode;Js(f),f.append(n),r.clear(),Pt(t,e[0].prev,e[s-1].next)}Ei(i,()=>{for(var u=0;u<s;u++){var l=e[u];o||(r.delete(l.k),Pt(t,l.prev,l.next)),Dt(l.e,!o)}})}function Di(t,e,n,r,i,s=null){var a=t,o={flags:e,items:new Map,first:null},f=(e&ci)!==0;if(f){var u=t;a=u.appendChild(vi())}var l=null,h=!1,c=_t(()=>{var d=n();return Un(d)?d:d==null?[]:qn(d)});Jn(()=>{var d=m(c),p=d.length;h&&p===0||(h=p===0,Ea(d,o,a,i,e,r,n),s!==null&&(p===0?l?Ge(l):l=ye(()=>s(a)):l!==null&&qe(l,()=>{l=null})),m(c))})}function Ea(t,e,n,r,i,s,a){var L,J,v,y;var o=(i&Cs)!==0,f=(i&(Yn|Vn))!==0,u=t.length,l=e.items,h=e.first,c=h,d,p=null,g,w=[],I=[],M,b,A,x;if(o)for(x=0;x<u;x+=1)M=t[x],b=s(M,x),A=l.get(b),A!==void 0&&((L=A.a)==null||L.measure(),(g??(g=new Set)).add(A));for(x=0;x<u;x+=1){if(M=t[x],b=s(M,x),A=l.get(b),A===void 0){var q=c?c.e.nodes_start:n;p=$a(q,e,p,p===null?e.first:p.next,M,b,x,r,i,a),l.set(b,p),w=[],I=[],c=p.next;continue}if(f&&Oa(A,M,x,i),A.e.f&Mt&&(Ge(A.e),o&&((J=A.a)==null||J.unfix(),(g??(g=new Set)).delete(A))),A!==c){if(d!==void 0&&d.has(A)){if(w.length<I.length){var G=I[0],E;p=G.prev;var N=w[0],F=w[w.length-1];for(E=0;E<w.length;E+=1)Pr(w[E],G,n);for(E=0;E<I.length;E+=1)d.delete(I[E]);Pt(e,N.prev,F.next),Pt(e,p,N),Pt(e,F,G),c=G,p=F,x-=1,w=[],I=[]}else d.delete(A),Pr(A,c,n),Pt(e,A.prev,A.next),Pt(e,A,p===null?e.first:p.next),Pt(e,p,A),p=A;continue}for(w=[],I=[];c!==null&&c.k!==b;)c.e.f&Mt||(d??(d=new Set)).add(c),I.push(c),c=c.next;if(c===null)continue;A=c}w.push(A),p=A,c=A.next}if(c!==null||d!==void 0){for(var _=d===void 0?[]:qn(d);c!==null;)c.e.f&Mt||_.push(c),c=c.next;var T=_.length;if(T>0){var P=i&ci&&u===0?n:null;if(o){for(x=0;x<T;x+=1)(v=_[x].a)==null||v.measure();for(x=0;x<T;x+=1)(y=_[x].a)==null||y.fix()}Aa(e,_,P,l)}}o&&jn(()=>{var $;if(g!==void 0)for(A of g)($=A.a)==null||$.apply()}),B.first=e.first&&e.first.e,B.last=p&&p.e}function Oa(t,e,n,r){r&Yn&&On(t.v,e),r&Vn?On(t.i,n):t.i=n}function $a(t,e,n,r,i,s,a,o,f,u){var l=(f&Yn)!==0,h=(f&Fs)===0,c=l?h?Xn(i):at(i):i,d=f&Vn?at(a):a,p={i:d,v:c,k:s,a:null,e:null,prev:n,next:r};try{return p.e=ye(()=>o(t,c,d,u),Xs),p.e.prev=n&&n.e,p.e.next=r&&r.e,n===null?e.first=p:(n.next=p,n.e.next=p.e),r!==null&&(r.prev=p,r.e.prev=p.e),p}finally{}}function Pr(t,e,n){for(var r=t.next?t.next.e.nodes_start:n,i=e?e.e.nodes_start:n,s=t.e.nodes_start;s!==r;){var a=cn(s);i.before(s),s=a}}function Pt(t,e,n){e===null?t.first=n:(e.next=n,e.e.next=n&&n.e),n!==null&&(n.prev=e,n.e.prev=e&&e.e)}function V(t,e,n,r){var i=t.__attributes??(t.__attributes={});i[e]!==(i[e]=n)&&(e==="style"&&"__styles"in t&&(t.__styles={}),e==="loading"&&(t[Es]=n),n==null?t.removeAttribute(e):typeof n!="string"&&Sa(t).includes(e)?t[e]=n:t.setAttribute(e,n))}var Br=new Map;function Sa(t){var e=Br.get(t.nodeName);if(e)return e;Br.set(t.nodeName,e=[]);for(var n,r=t,i=Element.prototype;i!==r;){n=oi(r);for(var s in n)n[s].set&&e.push(s);r=Gn(r)}return e}function Dr(t,e){return t===e||(t==null?void 0:t[Gt])===e}function Ma(t={},e,n,r){return Kn(()=>{var i,s;return hn(()=>{i=s,s=[],zt(()=>{t!==n(...s)&&(e(t,...s),i&&Dr(n(...i),t)&&e(null,...i))})}),()=>{jn(()=>{s&&Dr(n(...s),t)&&e(null,...s)})}}),t}function tr(t=!1){const e=C,n=e.l.u;if(!n)return;let r=()=>Ut(e.s);if(t){let i=0,s={};const a=me(()=>{let o=!1;const f=e.s;for(const u in f)f[u]!==s[u]&&(s[u]=f[u],o=!0);return o&&i++,i});r=()=>m(a)}n.b.length&&ea(()=>{Tr(e,r),En(n.b)}),$n(()=>{const i=zt(()=>n.m.map(ys));return()=>{for(const s of i)typeof s=="function"&&s()}}),n.a.length&&$n(()=>{Tr(e,r),En(n.a)})}function Tr(t,e){if(t.l.s)for(const n of t.l.s)m(n);e()}let $e=!1;function Na(t){var e=$e;try{return $e=!1,[t(),$e]}finally{$e=e}}function Rr(t){for(var e=B,n=B;e!==null&&!(e.f&(bt|ae));)e=e.parent;try{return xt(e),t()}finally{xt(n)}}function it(t,e,n,r){var G;var i=(n&Ls)!==0,s=!oe||(n&Us)!==0,a=(n&Gs)!==0,o=(n&Hs)!==0,f=!1,u;a?[u,f]=Na(()=>t[e]):u=t[e];var l=Gt in t||As in t,h=a&&(((G=te(t,e))==null?void 0:G.set)??(l&&e in t&&(E=>t[e]=E)))||void 0,c=r,d=!0,p=!1,g=()=>(p=!0,d&&(d=!1,o?c=zt(r):c=r),c);u===void 0&&r!==void 0&&(h&&s&&Is(),u=g(),h&&h(u));var w;if(s)w=()=>{var E=t[e];return E===void 0?g():(d=!0,p=!1,E)};else{var I=Rr(()=>(i?me:_t)(()=>t[e]));I.f|=xs,w=()=>{var E=m(I);return E!==void 0&&(c=void 0),E===void 0?c:E}}if(!(n&qs))return w;if(h){var M=t.$$legacy;return function(E,N){return arguments.length>0?((!s||!N||M||f)&&h(N?w():E),E):w()}}var b=!1,A=!1,x=Xn(u),q=Rr(()=>me(()=>{var E=w(),N=m(x);return b?(b=!1,A=!0,N):(A=!1,x.v=E)}));return i||(q.equals=zn),function(E,N){if(arguments.length>0){const F=N?m(q):s&&a?jt(E):E;return q.equals(F)||(b=!0,D(x,F),p&&c!==void 0&&(c=F),zt(()=>m(q))),E}return m(q)}}function Ti(t){C===null&&zs(),oe&&C.l!==null?Ia(C).m.push(t):$n(()=>{const e=zt(t);if(typeof e=="function")return e})}function Ia(t){var e=t.l;return e.u??(e.u={a:[],b:[],m:[]})}const ka="5";typeof window<"u"&&(window.__svelte||(window.__svelte={v:new Set})).v.add(ka);Rs();const Zt={f32:Float32Array,u32:Uint32Array,i32:Int32Array},Ri=Uint32Array,Pa=Uint32Array;function Q(t){let e=1;for(const n of t)e*=n;return e}function Ba(t=0,e=1){const n=1-Math.random(),r=Math.random();return Math.sqrt(-2*Math.log(n))*Math.cos(2*Math.PI*r)*e+t}function xn(t){let e=new Array(t.length);e[e.length-1]=1;for(let n=t.length-1;n>0;n--)e[n-1]=e[n]*t[n];return e}function K(t,e){return Math.ceil(t/e)}function Ct(t){const e=new t.constructor(t.length);for(let n=0;n<t.length;n++)e[n]=t[n];return e}function Cr(t,e){const n=Ct(t);for(let r=0;r<e.length;r++){const i=e[r];t[r]=n[i]}}function Da(t,e,n){const r=t[e];t[e]=n,t[n]=r}function de(t,e){if(t.length!==e.length)return!1;for(let n=0;n<t.length;n++)if(t[n]!==e[n])return!1;return!0}function Ta(t,e,n,r=1/0){let i="";function s(a,o){for(let f=0;f<e[a];f++){if(f>r){i+="...";return}const u=o+f*n[a];if(a===e.length-1)i+=`${t[u]}`,f<e[a]-1&&(i+=", ");else{if(f>0)for(let l=0;l<a+1;l++)i+=" ";if(i+="[",s(a+1,u),i+="]",f<e[a]-1){i+=",";for(let l=0;l<e.length-a-1;l++)i+=`
`}}}}return i+="[",s(0,0),i+="]",i}function le(t,e){return e<0?t+=e:e}function H(t,e,n="gid.x",r=-1,i=""){let s="",a=1;for(let o=t.length-1+r+1;o>=0;o--){const f=`(${i}(${n}/${a})%${t[o]})`;a*=t[o];const u=e[o];s+=`(${u}*${f})`,o>0&&(s+="+")}return s}function Fr(t,e,n){const r=new t.constructor(t.length+1);r[e]=n;let i=0;for(let s=0;s<r.length;s++)s!==e&&(r[s]=t[i],i++);return r}let U;class O{constructor(e,n,r,i,s=!0){k(U,"GPU must exist. Tensor.setDevice() once!"),this.gpuBuffer=e,this.shape=Ri.from(n),this.strides=Pa.from(r),this.dtype=i,this.owned=s}get DTypedArray(){return Zt[this.dtype]}static setDevice(e){k(e!==void 0,"device not found!"),U=new er(e)}static get gpu(){return k(U!==void 0,"gpu not found!"),U}setGPUBuffer(e,n=void 0){n=n===void 0?this.shape:n,e=this.DTypedArray.from(e),Q(n)!==Q(this.shape)&&(this.gpuBuffer.free(),this.gpuBuffer=U.memAlloc(e.byteLength)),U.memcpyHostToDevice(this.gpuBuffer,e)}static fill(e,n,r="f32"){const i=Q(n),s=U.memAlloc(i*Zt[r].BYTES_PER_ELEMENT),a=256;return U.SourceModule(`
			@group(0) @binding(0) var<storage, read_write> data: array<${r}>;
			@compute @workgroup_size(${a})
			fn main(@builtin(global_invocation_id) gid : vec3u) {
				if(gid.x < ${i}) {
					data[gid.x] = ${r}(${e});
				}
			}`).getFunction("main")([K(i,a)],s),new O(s,n,xn(n),r)}static tensor(e,n,r="f32"){const i=new Zt[r](e),s=U.memAlloc(i.byteLength);return U.memcpyHostToDevice(s,i),new O(s,n,xn(n),r)}static empty(e,n="f32"){const r=U.memAlloc(Q(e)*Zt[n].BYTES_PER_ELEMENT);return new O(r,e,xn(e),n)}static random(e,n="f32"){const r=new Zt[n](Q(e)).fill(0).map(i=>Math.random());return O.tensor(r,e,n)}static randn(e,n=0,r=1,i="f32"){const s=new Zt[i](Q(e)).fill(0).map(a=>Ba(n,r));return O.tensor(s,e,i)}static _elementWiseUnaryOpInplace(e,n){const r=Q(e.shape),i=256,s=e.dtype;U.SourceModule(`
			@group(0) @binding(0) var<storage, read_write> dst: array<${s}>;
			@compute @workgroup_size(${i})
			fn main(@builtin(global_invocation_id) gid : vec3u) {
				if(gid.x < ${r}) {
					let dstIdx = ${H(e.shape,e.strides,"gid.x",-1)};
					${n}
				}
			}
			`).getFunction("main")([K(r,i)],e.gpuBuffer)}_elementWiseUnaryOpInplace(e){return O._elementWiseUnaryOpInplace(this,e),this}static _elementWiseUnaryOp(e,n,r){k(de(e.shape,n.shape),"dst must have shape as src");const i=Q(e.shape),s=256,a=e.dtype;U.SourceModule(`
			@group(0) @binding(0) var<storage, read_write> dst: array<${a}>;
			@group(0) @binding(1) var<storage, read> src: array<${a}>;
			@compute @workgroup_size(${s})
			fn main(@builtin(global_invocation_id) gid : vec3u) {
				if(gid.x < ${i}) {
					let srcIdx = ${H(n.shape,n.strides,"gid.x",-1)};
					let dstIdx = ${H(e.shape,e.strides,"gid.x",-1)};
					${r}
				}
			}
			`).getFunction("main")([K(i,s)],e.gpuBuffer,n.gpuBuffer)}_elementWiseUnaryOp(e){const n=O.empty(this.shape,this.dtype);return O._elementWiseUnaryOp(n,this,e),n}static sumLastDimension(e,n){k(e.dtype===n.dtype,"dst and src dtypes must match"),k(e.shape.at(-1)===1,"dimension we sum over should be 1 in dst");const r=Q(e.shape),i=256,s=e.dtype;return U.SourceModule(`
			@group(0) @binding(0) var<storage, read_write> dst: array<${s}>;
			@group(0) @binding(1) var<storage, read> src: array<${s}>;

			@compute @workgroup_size(${i})
			fn main(@builtin(global_invocation_id) gid : vec3u) {
				if(gid.x < ${r}) {
					let baseSrcIdx = ${H(n.shape,n.strides,"gid.x",-2)};
					let baseDstIdx = ${H(e.shape,e.strides,"gid.x",-2)};
					var summed = ${s}(0);
					for(var i: u32 = 0; i < ${n.shape.at(-1)}; i++) {
						summed += src[baseSrcIdx + i*${n.strides.at(-1)}];
					}
					dst[baseDstIdx] = summed;
				}
			}`).getFunction("main")([K(r,i)],e.gpuBuffer,n.gpuBuffer),e}static reduceAnyDimensionGivenLastDimensionFunc(e,n,r,i=-1){const s=new Uint8Array(r.shape.length).fill(0).map((o,f)=>f);i=le(r.shape.length,i);const a=r.shape.length-1;Da(s,i,a),e(n.transpose(s),r.transpose(s))}static sum(e,n,r=-1){O.reduceAnyDimensionGivenLastDimensionFunc(O.sumLastDimension,e,n,r)}static _elementWiseBinaryOp(e,n,r,i){k(de(n.shape,r.shape),"srcA and srcB must have the same shape"),k(de(e.shape,r.shape),"dst, srcA, and srcB, must have the same shape");const s=Q(e.shape),a=256,o=e.dtype;U.SourceModule(`
			@group(0) @binding(0) var<storage, read_write> dst: array<${o}>;
			@group(0) @binding(1) var<storage, read> srcA: array<${o}>;
			@group(0) @binding(2) var<storage, read> srcB: array<${o}>;

		 	@compute @workgroup_size(${a})
		 	fn main(@builtin(global_invocation_id) gid : vec3u) {
				if(gid.x < ${s}) {
					let dstIdx = ${H(e.shape,e.strides,"gid.x",-1)};
					let srcAIdx = ${H(n.shape,n.strides,"gid.x",-1)};
					let srcBIdx = ${H(r.shape,r.strides,"gid.x",-1)};
					${i}
				}
			}`).getFunction("main")([K(s,a)],e.gpuBuffer,n.gpuBuffer,r.gpuBuffer)}_elementWiseBinaryOp(e,n){let r=!1;typeof e=="number"&&(e=O.tensor([e],this.shape,this.dtype),r=!0);const i=O.empty(e.shape,e.dtype);return O._elementWiseBinaryOp(i,this,e,n),r&&e.free(),i}static _elementWiseBinaryOpInplace(e,n,r){k(de(e.shape,n.shape),"dst, src, must have the same shape");const i=Q(e.shape),s=256,a=e.dtype;U.SourceModule(`
			@group(0) @binding(0) var<storage, read_write> dst: array<${a}>;
			@group(0) @binding(1) var<storage, read> src: array<${a}>;

		 	@compute @workgroup_size(${s})
		 	fn main(@builtin(global_invocation_id) gid : vec3u) {
				if(gid.x < ${i}) {
					let dstIdx = ${H(e.shape,e.strides,"gid.x",-1)};
					let srcIdx = ${H(n.shape,n.strides,"gid.x",-1)};
					${r}
				}
			}`).getFunction("main")([K(i,s)],e.gpuBuffer,n.gpuBuffer)}add(e){return this._elementWiseBinaryOp(e,"dst[dstIdx] = srcA[srcAIdx]+srcB[srcBIdx];")}sub(e){return this._elementWiseBinaryOp(e,"dst[dstIdx] = srcA[srcAIdx]-srcB[srcBIdx];")}mul(e){return this._elementWiseBinaryOp(e,"dst[dstIdx] = srcA[srcAIdx]*srcB[srcBIdx];")}div(e){return this._elementWiseBinaryOp(e,"dst[dstIdx] = srcA[srcAIdx]/srcB[srcBIdx];")}pow(e){return this._elementWiseBinaryOp(e,`dst[dstIdx] = ${this.dtype}(pow(f32(srcA[srcAIdx]), f32(srcB[srcBIdx])));`)}add_(e){return O._elementWiseBinaryOpInplace(this,e,"dst[dstIdx] += src[srcIdx];"),this}sub_(e){return O._elementWiseBinaryOpInplace(this,e,"dst[dstIdx] -= src[srcIdx];"),this}sum(e=-1){const n=Ct(this.shape);n[le(n.length,e)]=1;const r=O.empty(n,this.dtype);return O.sum(r,this,e),r}static maxLastDim(e,n){k(e.dtype===n.dtype,"dst and src dtypes must match"),k(e.shape.at(-1)===1,"dimension we sum over should be 1 in dst");const r=Q(e.shape),i=256,s=e.dtype;return U.SourceModule(`
			@group(0) @binding(0) var<storage, read_write> dst: array<${s}>;
			@group(0) @binding(1) var<storage, read> src: array<${s}>;

			@compute @workgroup_size(${i})
			fn main(@builtin(global_invocation_id) gid : vec3u) {
				if(gid.x < ${r}) {
					let baseSrcIdx = ${H(n.shape,n.strides,"gid.x",-2)};
					let baseDstIdx = ${H(e.shape,e.strides,"gid.x",-2)};
					var max: ${s} = src[baseSrcIdx];
					for(var i: u32 = 0; i < ${n.shape.at(-1)}; i++) {
						let cur = src[baseSrcIdx + i*${n.strides.at(-1)}];
						if(cur > max) {
							max = cur;
						}
					}
					dst[baseDstIdx] = max;
				}
			}`).getFunction("main")([K(r,i)],e.gpuBuffer,n.gpuBuffer),e}static max(e,n,r=-1){O.reduceAnyDimensionGivenLastDimensionFunc(O.maxLastDim,e,n,r)}max(e=-1){const n=Ct(this.shape);n[le(n.length,e)]=1;const r=O.empty(n,this.dtype);return O.max(r,this,e),r}softmax(e=-1){const n=this.max(e),r=this.sub(n.expand(this.shape)),i=r.exp(),s=i.sum(e),a=i.div(s.expand(i.shape));return n.free(),r.free(),s.free(),i.free(),a}fillInplace(e){return this._elementWiseUnaryOpInplace(`dst[dstIdx] = ${this.dtype}(${e});`)}contiguous(){return this._elementWiseUnaryOp(dst,src,"dst[dstIdx] = src[srcIdx];")}exp(){return this._elementWiseUnaryOp("dst[dstIdx] = exp(src[srcIdx]);")}relu(){return this._elementWiseUnaryOp("dst[dstIdx] = max(src[srcIdx], 0);")}reciprocal(){return this._elementWiseUnaryOp(other,"dst[dstIdx] = 1/src[srcIdx];")}log(e=1e-6){return this._elementWiseUnaryOp(`dst[dstIdx] = log(src[srcIdx] + ${e});`)}get T(){return this.transpose()}transpose(e=void 0){if(this.shape===1)return this;e===void 0&&(e=[this.shape.length-1,0]);const n=Ct(this.shape),r=Ct(this.strides);return Cr(n,e),Cr(r,e),new O(this.gpuBuffer,n,r,this.dtype,!1)}unsqueeze(e=0){e=le(this.shape.length+1,e);const n=Fr(this.shape,e,1),r=this.shape.slice(e).reduce((s,a)=>s*a,1),i=Fr(this.strides,e,r);return new O(this.gpuBuffer,n,i,this.dtype,!1)}expandTo(e,n){if(n=le(this.shape.length,n),e===this.shape[n])return this;const r=Ct(this.shape),i=Ct(this.strides);return r[n]=e,i[n]=0,new O(this.gpuBuffer,r,i,this.dtype,!1)}expand(e){k(e.length===this.shape.length,"Must have same number of dims");let n=this;for(let r=0;r<e.length;r++){const i=e[r];n=n.expandTo(i,r)}return n}static matmul(e,n,r){k(n.shape.length===2&&r.shape.length===2&&e.shape.length===2,"tensors are matrix shaped"),k(n.shape.at(-1)===r.shape.at(0),"Inner dimension must be the same"),k(e.shape[0]===n.shape[0]&&e.shape[1]===r.shape[1],"output dimension lines up");const i=n.shape[1],s=e.dtype,a=16,o=16,f=U.SourceModule(`
			@group(0) @binding(0) var<storage, read_write> dst: array<${s}>;
			@group(0) @binding(1) var<storage, read> srcA: array<${s}>;
			@group(0) @binding(2) var<storage, read> srcB: array<${s}>;

		 	@compute @workgroup_size(${a}, ${o})
		 	fn main(@builtin(global_invocation_id) gid : vec3u) {
				let i = gid.x;
				let j = gid.y;
				if(gid.x < ${e.shape[0]} && gid.y < ${e.shape[1]}) {
					var summed: ${s} = 0;
					for(var k: u32 = 0; k < ${i}; k++) {
						let srcAIdx = i*${n.strides[0]} + k*${n.strides[1]};
						let srcBIdx = k*${r.strides[0]} + j*${r.strides[1]};
						summed += srcA[srcAIdx]*srcB[srcBIdx];	
					}

					let dstIdx = i*${e.strides[0]} + j*${e.strides[1]};
					dst[dstIdx] = summed;
				}
			}
		`).getFunction("main"),u=[K(e.shape[0],a),K(e.shape[1],o)];f(u,e.gpuBuffer,n.gpuBuffer,r.gpuBuffer)}matmul(e){const n=O.empty([this.shape[0],e.shape[1]],this.dtype);return O.matmul(n,this,e),n}static bmm(e,n,r){k(n.shape.at(-1)===r.shape.at(-2),"Inner dimension must be the same"),k(e.shape.at(-2)===n.shape.at(-2)&&e.shape.at(-1)===r.shape.at(-1),"output dimension lines up");const i=Q(e.shape.slice(0,-2)),s=e.shape.at(-2),a=e.shape.at(-1),o=n.shape.at(-1),f=e.dtype,u=4,l=8,h=8,c=U.SourceModule(`
			@group(0) @binding(0) var<storage, read_write> dst: array<${f}>;
			@group(0) @binding(1) var<storage, read> srcA: array<${f}>;
			@group(0) @binding(2) var<storage, read> srcB: array<${f}>;

		 	@compute @workgroup_size(${u}, ${l}, ${h})
		 	fn main(@builtin(global_invocation_id) gid : vec3u) {
				let b = gid.x;
				let i = gid.y;
				let j = gid.z;
				if(b < ${i} && i < ${s} && j < ${a}) {
					let srcAOffset = ${H(n.shape,n.strides,"b",-3)};
					let srcBOffset = ${H(r.shape,r.strides,"b",-3)};
					let dstOffset = ${H(e.shape,e.strides,"b",-3)};

					var summed: ${f} = 0;
					for(var k: u32 = 0; k < ${o}; k++) {
						let srcAIdx = srcAOffset + i*${n.strides.at(-2)} + k*${n.strides.at(-1)};
						let srcBIdx = srcBOffset + k*${r.strides.at(-2)} + j*${r.strides.at(-1)};
						summed += srcA[srcAIdx]*srcB[srcBIdx];	
					}

					let dstIdx = dstOffset + i*${e.strides.at(-2)} + j*${e.strides.at(-1)};
					dst[dstIdx] = summed;
				}
			}
		`).getFunction("main"),d=[K(i,u),K(s,l),K(a,h)];c(d,e.gpuBuffer,n.gpuBuffer,r.gpuBuffer)}bmm(e){const n=[...this.shape.slice(0,-2),this.shape.at(-2),e.shape.at(-1)],r=O.empty(n);return O.bmm(r,this,e),r}static _softmaxJacobianLastDim(e,n){k(e.shape.at(-1)===e.shape.at(-2)&&e.shape.at(-1)===n.shape.at(-1));const r=Q(e.shape.slice(-2)),i=e.shape.at(-1),s=e.dtype,a=4,o=8,f=8,u=U.SourceModule(`
			@group(0) @binding(0) var<storage, read_write> dst: array<${s}>;
			@group(0) @binding(1) var<storage, read> s: array<${s}>;

		 	@compute @workgroup_size(${a}, ${o}, ${f})
		 	fn main(@builtin(global_invocation_id) gid : vec3u) {
				let b = gid.x;
				let i = gid.y;
				let j = gid.z;

				if(b < ${r} && i < ${i} && j < ${i}) {
					let dstOffset = ${H(e.shape,e.strides,"b",-3)};
					let sOffset = ${H(n.shape,n.strides,"b",-2)};

					let siIdx = sOffset + i*${n.strides.at(-1)};
					let sjIdx = sOffset + j*${n.strides.at(-1)};
					let dijIdx = dstOffset + i*${e.strides.at(-2)} + j*${e.strides.at(-1)};

					let si = s[siIdx];
					let sj = s[sjIdx];
					if(i!=j) {
						dst[dijIdx] = -si*sj;
					}
					else {
						dst[dijIdx] = si*(1-si);
					}
				}
			}
		`).getFunction("main"),l=[K(r,a),K(i,o),K(i,f)];u(l,e.gpuBuffer,n.gpuBuffer)}_softmaxJacobian(){const e=this.shape.at(-1),n=O.empty([...this.shape.slice(0,-1),e,e]);return O._softmaxJacobianLastDim(n,this),n}async print(e=!0){this.assertNotFreed();const n=await this.cpuBuffer();let r="";r+=`dtype='${this.dtype}', `,r+=`shape=[${this.shape}], `,r+=`strides=[${this.strides}],
`,r+=`gpuBuffer=
${Ta(n,this.shape,this.strides,e?8:1/0)}
`,console.log(r)}async cpuBuffer(){return U.mapGPUToCPU(this.gpuBuffer,this.DTypedArray)}free(){this.gpuBuffer===void 0&&console.warn("Tried to free a gpuBuffer twice!"),this.gpuBuffer&&this.owned&&U.free(this.gpuBuffer),this.gpuBuffer=void 0}assertNotFreed(){k(this.gpuBuffer!==void 0,"This GPU Buffer has already been freed.")}}function k(t,e="ASSERT FAILED"){if(!t)throw new Error(e)}class er{constructor(e){this.device=e}static async init(){const e=await navigator.gpu.requestAdapter();k(e,"adapter exists");const n=await e.requestDevice();return k(n,"device exists"),new er(n)}async deviceSynchronize(){await this.device.queue.onSubmittedWorkDone()}memAlloc(e,n=GPUBufferUsage.STORAGE|GPUBufferUsage.COPY_DST|GPUBufferUsage.COPY_SRC){return k(e>0),this.device.createBuffer({size:e,usage:n})}memcpyHostToDevice(e,n){this.device.queue.writeBuffer(e,0,n,0)}async memcpyDeviceToHost(e,n){e.set(await this.mapGPUToCPU(n,e.constructor))}free(e){e.destroy()}async printGPUBuffer(e,n=Float32Array){const r=await this.mapGPUToCPU(e,n);console.log(Array.from(r),r.constructor.name)}printDeviceInfo(){console.table(this.device.adapterInfo)}async mapGPUToCPU(e,n=Float32Array){const r=this.memAlloc(e.size,GPUBufferUsage.COPY_DST|GPUBufferUsage.MAP_READ),i=this.device.createCommandEncoder();return i.copyBufferToBuffer(e,0,r,0,e.size),this.device.queue.submit([i.finish()]),await r.mapAsync(GPUMapMode.READ),new n(r.getMappedRange())}SourceModule(e){return new Ra(this,e)}}class Ra{constructor(e,n){this.gpu=e,this.device=e.device,this.kernel=n}getFunctionExplicitBindings(e){const n=this.device.createShaderModule({code:this.kernel}),r=this.device.createComputePipeline({layout:"auto",compute:{module:n,entryPoint:e}}),i=r.getBindGroupLayout(0);return(s,...a)=>{k(s!==void 0);const o=this.device.createBindGroup({layout:i,entries:a}),f=this.device.createCommandEncoder(),u=f.beginComputePass();u.setPipeline(r),u.setBindGroup(0,o),u.dispatchWorkgroups(...s),u.end(),this.device.queue.submit([f.finish()])}}getFunctionOnlyBuffers(e){const n=this.getFunctionExplicitBindings(e);return(r,...i)=>{const s=i.map((a,o)=>({binding:o,resource:{buffer:a}}));n(r,...s)}}getFunction(e,n=!1){return n?this.getFunctionExplicitBindings(e):this.getFunctionOnlyBuffers(e)}}const Ca=14,[Lr,nr,rr,ir,sr,ar,or,ur,fr,lr,cr,hr,dr,pr]=new Array(Ca).fill(0).map((t,e)=>e),Fa={[rr]:([t],e)=>t.sum(e),[sr]:([t])=>t.pow(2),[ur]:([t],e)=>t.transpose(e),[fr]:([t],e)=>t.expand(e),[lr]:([t])=>t.relu(),[hr]:([t])=>t.exp(),[dr]:([t],e)=>t.softmax(e),[pr]:([t])=>t.log()},La={[rr]:([t],e,n)=>[()=>n.expand(t.shape)],[sr]:([t],e,n)=>[()=>{const i=t.mul(2),s=n.mul(i);return i.free(),s}],[ur]:([t],e,n,r)=>[()=>n.transpose(r)],[fr]:([t],e,n,r)=>[()=>n.expand(t.shape)],[lr]:([t],e,n)=>[()=>e._elementWiseBinaryOp(n,`
				let result = srcA[srcAIdx];
				let resultGrad = srcB[srcBIdx];
				if(result > 0) {
					dst[dstIdx] = resultGrad;
				} else {
					dst[dstIdx] = 0;
				}
				`)],[hr]:([t],e,n)=>[()=>n.mul(e)],[dr]:([t],e,n)=>[()=>{const i=e._softmaxJacobian(),s=n.unsqueeze(1).bmm(i);return s.shape=e.shape,s.strides=e.strides,s}],[pr]:([t],e,n)=>[()=>{const i=t.pow(-1),s=n.mul(i);return i.free(),s}]},Ua={[nr]:([t,e])=>t.add(e),[ir]:([t,e])=>t.sub(e),[ar]:([t,e])=>t.mul(e),[or]:([t,e])=>t.matmul(e),[cr]:([t,e])=>t.div(e)},qa={[nr]:([t,e],n,r)=>[()=>r,()=>r],[ir]:([t,e],n,r)=>[()=>r,()=>r.mul(-1)],[ar]:([t,e],n,r)=>[()=>r.mul(e),()=>r.mul(t)],[or]:([t,e],n,r)=>[()=>r.matmul(e.T),()=>t.T.matmul(r)],[cr]:([t,e],n,r)=>[()=>{const a=typeof e=="number"?O.tensor([1/e],t.shape):e.pow(-1),o=r.mul(a);return a.free(),o},()=>{const a=typeof e=="number"?O.tensor([1/(e*e)],t.shape):e.pow(-2),o=t.mul(-1),f=o.mul(a),u=r.mul(a);return a.free(),f.free(),o.free(),u}]};class Bt{constructor(e,n,r=[],i=void 0,s=!1){this.childArgs=n,this.opArgs=r,this.OP_CODE=e,this.tensor=i,this.grad=void 0,this.requiresGrad=s}static tensor(e,n=!1){return new Bt(Lr,[],[],e,n,e.shape)}get shape(){return k(this.tensor,"Tensor must exist to get shape. TODO: implement shape tracker to get around this."),this.tensor.shape}_unaryOp(e,...n){return new Bt(e,[this],n,void 0,this.requiresGrad)}softmax(e=-1){return this._unaryOp(dr,e)}exp(){return this._unaryOp(hr)}sum(e){return this._unaryOp(rr,e)}square(){return this._unaryOp(sr)}get T(){return this.transpose()}transpose(e=void 0){return this._unaryOp(ur,e)}expand(e){return this._unaryOp(fr,e)}relu(){return this._unaryOp(lr)}log(){return this._unaryOp(pr)}_binaryOp(e,n,...r){return new Bt(n,[this,e],r,void 0,this.requiresGrad||e.requiresGrad)}div(e){return this._binaryOp(e,cr)}add(e){return this._binaryOp(e,nr)}sub(e){return this._binaryOp(e,ir)}mul(e){return this._binaryOp(e,ar)}matmul(e){return this._binaryOp(e,or)}_getOpFunc(){let e;if(this.childArgs.length===1)e=Fa;else if(this.childArgs.length===2)e=Ua;else throw new Error("Unknown op length");return k(this.OP_CODE in e,"Must have the function in the OP_MAP"),e[this.OP_CODE]}_getBackwardsOpFunc(){let e;if(this.childArgs.length===1)e=La;else if(this.childArgs.length===2)e=qa;else throw new Error("Unknown op length");return k(this.OP_CODE in e,"Must have the function in the OP_MAP"),e[this.OP_CODE]}forward(){if(this.OP_CODE===Lr)return this.tensor;let e=new Array(this.childArgs.length);for(let r=0;r<this.childArgs.length;r++){const i=this.childArgs[r];typeof i=="number"?e[r]=i:e[r]=i.forward()}const n=this._getOpFunc();return this.tensor=n(e,...this.opArgs),this.tensor}_accumulateGradient(e){this.grad===void 0&&(this.grad=O.fill(0,this.tensor.shape,this.tensor.dtype)),this.grad.add_(e)}backward(){k(this.tensor,"result needs to be evaluated"),k(de(new Ri(this.tensor.shape.length).fill(1),this.tensor.shape),"Needs to be called on a reduce value (shape dimensions all 1)");const e=r=>{if(k(r.tensor,"result needs to be evaluated"),r.childArgs.length===0)return;const i=r._getBackwardsOpFunc(),s=r.childArgs.map(o=>typeof o=="number"?o:o.tensor),a=i(s,r.tensor,r.grad,...r.opArgs);for(let o=0;o<r.childArgs.length;o++){const f=r.childArgs[o],u=a[o];if(typeof f=="number"||f.requiresGrad===!1)continue;const l=u();f._accumulateGradient(l),e(f)}},n=O.fill(1,this.tensor.shape,this.tensor.dtype);this._accumulateGradient(n),e(this)}zeroGrad(){if(!(!this.grad||!this.requiresGrad)){this.grad.fillInplace(0);for(let e=0;e<this.childArgs.length;e++)typeof this.childArgs[e]!="number"&&this.childArgs[e].zeroGrad()}}freeGraph(){this.grad&&(this.grad.free(),this.grad=void 0),this.tensor&&(this.tensor.free(),this.tensor=void 0);for(let e=0;e<this.childArgs.length;e++)typeof this.childArgs[e]!="number"&&this.childArgs[e].freeGraph()}async print(...e){k(this.tensor,"result must be populated to print"),await this.tensor.print(...e)}}class Ga{constructor(e,n=.001){e.forEach(r=>k(r.requiresGrad,"Parameters must require gradients")),this.params=e,this.lr=n}update(){for(const e of this.params){k(e.grad&&e.tensor,"Can update data with gradient.");const n=e.grad.mul(this.lr);e.tensor.sub_(n),n.free()}}}function De(t,e){return t==null||e==null?NaN:t<e?-1:t>e?1:t>=e?0:NaN}function Ha(t,e){return t==null||e==null?NaN:e<t?-1:e>t?1:e>=t?0:NaN}function Ci(t){let e,n,r;t.length!==2?(e=De,n=(o,f)=>De(t(o),f),r=(o,f)=>t(o)-f):(e=t===De||t===Ha?t:Wa,n=t,r=t);function i(o,f,u=0,l=o.length){if(u<l){if(e(f,f)!==0)return l;do{const h=u+l>>>1;n(o[h],f)<0?u=h+1:l=h}while(u<l)}return u}function s(o,f,u=0,l=o.length){if(u<l){if(e(f,f)!==0)return l;do{const h=u+l>>>1;n(o[h],f)<=0?u=h+1:l=h}while(u<l)}return u}function a(o,f,u=0,l=o.length){const h=i(o,f,u,l-1);return h>u&&r(o[h-1],f)>-r(o[h],f)?h-1:h}return{left:i,center:a,right:s}}function Wa(){return 0}function za(t){return t===null?NaN:+t}const Ya=Ci(De),Va=Ya.right;Ci(za).center;const Xa=Math.sqrt(50),Ka=Math.sqrt(10),Ja=Math.sqrt(2);function Xe(t,e,n){const r=(e-t)/Math.max(0,n),i=Math.floor(Math.log10(r)),s=r/Math.pow(10,i),a=s>=Xa?10:s>=Ka?5:s>=Ja?2:1;let o,f,u;return i<0?(u=Math.pow(10,-i)/a,o=Math.round(t*u),f=Math.round(e*u),o/u<t&&++o,f/u>e&&--f,u=-u):(u=Math.pow(10,i)*a,o=Math.round(t/u),f=Math.round(e/u),o*u<t&&++o,f*u>e&&--f),f<o&&.5<=n&&n<2?Xe(t,e,n*2):[o,f,u]}function Za(t,e,n){if(e=+e,t=+t,n=+n,!(n>0))return[];if(t===e)return[t];const r=e<t,[i,s,a]=r?Xe(e,t,n):Xe(t,e,n);if(!(s>=i))return[];const o=s-i+1,f=new Array(o);if(r)if(a<0)for(let u=0;u<o;++u)f[u]=(s-u)/-a;else for(let u=0;u<o;++u)f[u]=(s-u)*a;else if(a<0)for(let u=0;u<o;++u)f[u]=(i+u)/-a;else for(let u=0;u<o;++u)f[u]=(i+u)*a;return f}function Pn(t,e,n){return e=+e,t=+t,n=+n,Xe(t,e,n)[2]}function ja(t,e,n){e=+e,t=+t,n=+n;const r=e<t,i=r?Pn(e,t,n):Pn(t,e,n);return(r?-1:1)*(i<0?1/-i:i)}var Qa={value:()=>{}};function Fi(){for(var t=0,e=arguments.length,n={},r;t<e;++t){if(!(r=arguments[t]+"")||r in n||/[\s.]/.test(r))throw new Error("illegal type: "+r);n[r]=[]}return new Te(n)}function Te(t){this._=t}function to(t,e){return t.trim().split(/^|\s+/).map(function(n){var r="",i=n.indexOf(".");if(i>=0&&(r=n.slice(i+1),n=n.slice(0,i)),n&&!e.hasOwnProperty(n))throw new Error("unknown type: "+n);return{type:n,name:r}})}Te.prototype=Fi.prototype={constructor:Te,on:function(t,e){var n=this._,r=to(t+"",n),i,s=-1,a=r.length;if(arguments.length<2){for(;++s<a;)if((i=(t=r[s]).type)&&(i=eo(n[i],t.name)))return i;return}if(e!=null&&typeof e!="function")throw new Error("invalid callback: "+e);for(;++s<a;)if(i=(t=r[s]).type)n[i]=Ur(n[i],t.name,e);else if(e==null)for(i in n)n[i]=Ur(n[i],t.name,null);return this},copy:function(){var t={},e=this._;for(var n in e)t[n]=e[n].slice();return new Te(t)},call:function(t,e){if((i=arguments.length-2)>0)for(var n=new Array(i),r=0,i,s;r<i;++r)n[r]=arguments[r+2];if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(s=this._[t],r=0,i=s.length;r<i;++r)s[r].value.apply(e,n)},apply:function(t,e,n){if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(var r=this._[t],i=0,s=r.length;i<s;++i)r[i].value.apply(e,n)}};function eo(t,e){for(var n=0,r=t.length,i;n<r;++n)if((i=t[n]).name===e)return i.value}function Ur(t,e,n){for(var r=0,i=t.length;r<i;++r)if(t[r].name===e){t[r]=Qa,t=t.slice(0,r).concat(t.slice(r+1));break}return n!=null&&t.push({name:e,value:n}),t}var Bn="http://www.w3.org/1999/xhtml";const qr={svg:"http://www.w3.org/2000/svg",xhtml:Bn,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function vn(t){var e=t+="",n=e.indexOf(":");return n>=0&&(e=t.slice(0,n))!=="xmlns"&&(t=t.slice(n+1)),qr.hasOwnProperty(e)?{space:qr[e],local:t}:t}function no(t){return function(){var e=this.ownerDocument,n=this.namespaceURI;return n===Bn&&e.documentElement.namespaceURI===Bn?e.createElement(t):e.createElementNS(n,t)}}function ro(t){return function(){return this.ownerDocument.createElementNS(t.space,t.local)}}function Li(t){var e=vn(t);return(e.local?ro:no)(e)}function io(){}function gr(t){return t==null?io:function(){return this.querySelector(t)}}function so(t){typeof t!="function"&&(t=gr(t));for(var e=this._groups,n=e.length,r=new Array(n),i=0;i<n;++i)for(var s=e[i],a=s.length,o=r[i]=new Array(a),f,u,l=0;l<a;++l)(f=s[l])&&(u=t.call(f,f.__data__,l,s))&&("__data__"in f&&(u.__data__=f.__data__),o[l]=u);return new pt(r,this._parents)}function ao(t){return t==null?[]:Array.isArray(t)?t:Array.from(t)}function oo(){return[]}function Ui(t){return t==null?oo:function(){return this.querySelectorAll(t)}}function uo(t){return function(){return ao(t.apply(this,arguments))}}function fo(t){typeof t=="function"?t=uo(t):t=Ui(t);for(var e=this._groups,n=e.length,r=[],i=[],s=0;s<n;++s)for(var a=e[s],o=a.length,f,u=0;u<o;++u)(f=a[u])&&(r.push(t.call(f,f.__data__,u,a)),i.push(f));return new pt(r,i)}function qi(t){return function(){return this.matches(t)}}function Gi(t){return function(e){return e.matches(t)}}var lo=Array.prototype.find;function co(t){return function(){return lo.call(this.children,t)}}function ho(){return this.firstElementChild}function po(t){return this.select(t==null?ho:co(typeof t=="function"?t:Gi(t)))}var go=Array.prototype.filter;function vo(){return Array.from(this.children)}function _o(t){return function(){return go.call(this.children,t)}}function mo(t){return this.selectAll(t==null?vo:_o(typeof t=="function"?t:Gi(t)))}function yo(t){typeof t!="function"&&(t=qi(t));for(var e=this._groups,n=e.length,r=new Array(n),i=0;i<n;++i)for(var s=e[i],a=s.length,o=r[i]=[],f,u=0;u<a;++u)(f=s[u])&&t.call(f,f.__data__,u,s)&&o.push(f);return new pt(r,this._parents)}function Hi(t){return new Array(t.length)}function wo(){return new pt(this._enter||this._groups.map(Hi),this._parents)}function Ke(t,e){this.ownerDocument=t.ownerDocument,this.namespaceURI=t.namespaceURI,this._next=null,this._parent=t,this.__data__=e}Ke.prototype={constructor:Ke,appendChild:function(t){return this._parent.insertBefore(t,this._next)},insertBefore:function(t,e){return this._parent.insertBefore(t,e)},querySelector:function(t){return this._parent.querySelector(t)},querySelectorAll:function(t){return this._parent.querySelectorAll(t)}};function xo(t){return function(){return t}}function bo(t,e,n,r,i,s){for(var a=0,o,f=e.length,u=s.length;a<u;++a)(o=e[a])?(o.__data__=s[a],r[a]=o):n[a]=new Ke(t,s[a]);for(;a<f;++a)(o=e[a])&&(i[a]=o)}function Ao(t,e,n,r,i,s,a){var o,f,u=new Map,l=e.length,h=s.length,c=new Array(l),d;for(o=0;o<l;++o)(f=e[o])&&(c[o]=d=a.call(f,f.__data__,o,e)+"",u.has(d)?i[o]=f:u.set(d,f));for(o=0;o<h;++o)d=a.call(t,s[o],o,s)+"",(f=u.get(d))?(r[o]=f,f.__data__=s[o],u.delete(d)):n[o]=new Ke(t,s[o]);for(o=0;o<l;++o)(f=e[o])&&u.get(c[o])===f&&(i[o]=f)}function Eo(t){return t.__data__}function Oo(t,e){if(!arguments.length)return Array.from(this,Eo);var n=e?Ao:bo,r=this._parents,i=this._groups;typeof t!="function"&&(t=xo(t));for(var s=i.length,a=new Array(s),o=new Array(s),f=new Array(s),u=0;u<s;++u){var l=r[u],h=i[u],c=h.length,d=$o(t.call(l,l&&l.__data__,u,r)),p=d.length,g=o[u]=new Array(p),w=a[u]=new Array(p),I=f[u]=new Array(c);n(l,h,g,w,I,d,e);for(var M=0,b=0,A,x;M<p;++M)if(A=g[M]){for(M>=b&&(b=M+1);!(x=w[b])&&++b<p;);A._next=x||null}}return a=new pt(a,r),a._enter=o,a._exit=f,a}function $o(t){return typeof t=="object"&&"length"in t?t:Array.from(t)}function So(){return new pt(this._exit||this._groups.map(Hi),this._parents)}function Mo(t,e,n){var r=this.enter(),i=this,s=this.exit();return typeof t=="function"?(r=t(r),r&&(r=r.selection())):r=r.append(t+""),e!=null&&(i=e(i),i&&(i=i.selection())),n==null?s.remove():n(s),r&&i?r.merge(i).order():i}function No(t){for(var e=t.selection?t.selection():t,n=this._groups,r=e._groups,i=n.length,s=r.length,a=Math.min(i,s),o=new Array(i),f=0;f<a;++f)for(var u=n[f],l=r[f],h=u.length,c=o[f]=new Array(h),d,p=0;p<h;++p)(d=u[p]||l[p])&&(c[p]=d);for(;f<i;++f)o[f]=n[f];return new pt(o,this._parents)}function Io(){for(var t=this._groups,e=-1,n=t.length;++e<n;)for(var r=t[e],i=r.length-1,s=r[i],a;--i>=0;)(a=r[i])&&(s&&a.compareDocumentPosition(s)^4&&s.parentNode.insertBefore(a,s),s=a);return this}function ko(t){t||(t=Po);function e(h,c){return h&&c?t(h.__data__,c.__data__):!h-!c}for(var n=this._groups,r=n.length,i=new Array(r),s=0;s<r;++s){for(var a=n[s],o=a.length,f=i[s]=new Array(o),u,l=0;l<o;++l)(u=a[l])&&(f[l]=u);f.sort(e)}return new pt(i,this._parents).order()}function Po(t,e){return t<e?-1:t>e?1:t>=e?0:NaN}function Bo(){var t=arguments[0];return arguments[0]=this,t.apply(null,arguments),this}function Do(){return Array.from(this)}function To(){for(var t=this._groups,e=0,n=t.length;e<n;++e)for(var r=t[e],i=0,s=r.length;i<s;++i){var a=r[i];if(a)return a}return null}function Ro(){let t=0;for(const e of this)++t;return t}function Co(){return!this.node()}function Fo(t){for(var e=this._groups,n=0,r=e.length;n<r;++n)for(var i=e[n],s=0,a=i.length,o;s<a;++s)(o=i[s])&&t.call(o,o.__data__,s,i);return this}function Lo(t){return function(){this.removeAttribute(t)}}function Uo(t){return function(){this.removeAttributeNS(t.space,t.local)}}function qo(t,e){return function(){this.setAttribute(t,e)}}function Go(t,e){return function(){this.setAttributeNS(t.space,t.local,e)}}function Ho(t,e){return function(){var n=e.apply(this,arguments);n==null?this.removeAttribute(t):this.setAttribute(t,n)}}function Wo(t,e){return function(){var n=e.apply(this,arguments);n==null?this.removeAttributeNS(t.space,t.local):this.setAttributeNS(t.space,t.local,n)}}function zo(t,e){var n=vn(t);if(arguments.length<2){var r=this.node();return n.local?r.getAttributeNS(n.space,n.local):r.getAttribute(n)}return this.each((e==null?n.local?Uo:Lo:typeof e=="function"?n.local?Wo:Ho:n.local?Go:qo)(n,e))}function Wi(t){return t.ownerDocument&&t.ownerDocument.defaultView||t.document&&t||t.defaultView}function Yo(t){return function(){this.style.removeProperty(t)}}function Vo(t,e,n){return function(){this.style.setProperty(t,e,n)}}function Xo(t,e,n){return function(){var r=e.apply(this,arguments);r==null?this.style.removeProperty(t):this.style.setProperty(t,r,n)}}function Ko(t,e,n){return arguments.length>1?this.each((e==null?Yo:typeof e=="function"?Xo:Vo)(t,e,n??"")):re(this.node(),t)}function re(t,e){return t.style.getPropertyValue(e)||Wi(t).getComputedStyle(t,null).getPropertyValue(e)}function Jo(t){return function(){delete this[t]}}function Zo(t,e){return function(){this[t]=e}}function jo(t,e){return function(){var n=e.apply(this,arguments);n==null?delete this[t]:this[t]=n}}function Qo(t,e){return arguments.length>1?this.each((e==null?Jo:typeof e=="function"?jo:Zo)(t,e)):this.node()[t]}function zi(t){return t.trim().split(/^|\s+/)}function vr(t){return t.classList||new Yi(t)}function Yi(t){this._node=t,this._names=zi(t.getAttribute("class")||"")}Yi.prototype={add:function(t){var e=this._names.indexOf(t);e<0&&(this._names.push(t),this._node.setAttribute("class",this._names.join(" ")))},remove:function(t){var e=this._names.indexOf(t);e>=0&&(this._names.splice(e,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(t){return this._names.indexOf(t)>=0}};function Vi(t,e){for(var n=vr(t),r=-1,i=e.length;++r<i;)n.add(e[r])}function Xi(t,e){for(var n=vr(t),r=-1,i=e.length;++r<i;)n.remove(e[r])}function tu(t){return function(){Vi(this,t)}}function eu(t){return function(){Xi(this,t)}}function nu(t,e){return function(){(e.apply(this,arguments)?Vi:Xi)(this,t)}}function ru(t,e){var n=zi(t+"");if(arguments.length<2){for(var r=vr(this.node()),i=-1,s=n.length;++i<s;)if(!r.contains(n[i]))return!1;return!0}return this.each((typeof e=="function"?nu:e?tu:eu)(n,e))}function iu(){this.textContent=""}function su(t){return function(){this.textContent=t}}function au(t){return function(){var e=t.apply(this,arguments);this.textContent=e??""}}function ou(t){return arguments.length?this.each(t==null?iu:(typeof t=="function"?au:su)(t)):this.node().textContent}function uu(){this.innerHTML=""}function fu(t){return function(){this.innerHTML=t}}function lu(t){return function(){var e=t.apply(this,arguments);this.innerHTML=e??""}}function cu(t){return arguments.length?this.each(t==null?uu:(typeof t=="function"?lu:fu)(t)):this.node().innerHTML}function hu(){this.nextSibling&&this.parentNode.appendChild(this)}function du(){return this.each(hu)}function pu(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function gu(){return this.each(pu)}function vu(t){var e=typeof t=="function"?t:Li(t);return this.select(function(){return this.appendChild(e.apply(this,arguments))})}function _u(){return null}function mu(t,e){var n=typeof t=="function"?t:Li(t),r=e==null?_u:typeof e=="function"?e:gr(e);return this.select(function(){return this.insertBefore(n.apply(this,arguments),r.apply(this,arguments)||null)})}function yu(){var t=this.parentNode;t&&t.removeChild(this)}function wu(){return this.each(yu)}function xu(){var t=this.cloneNode(!1),e=this.parentNode;return e?e.insertBefore(t,this.nextSibling):t}function bu(){var t=this.cloneNode(!0),e=this.parentNode;return e?e.insertBefore(t,this.nextSibling):t}function Au(t){return this.select(t?bu:xu)}function Eu(t){return arguments.length?this.property("__data__",t):this.node().__data__}function Ou(t){return function(e){t.call(this,e,this.__data__)}}function $u(t){return t.trim().split(/^|\s+/).map(function(e){var n="",r=e.indexOf(".");return r>=0&&(n=e.slice(r+1),e=e.slice(0,r)),{type:e,name:n}})}function Su(t){return function(){var e=this.__on;if(e){for(var n=0,r=-1,i=e.length,s;n<i;++n)s=e[n],(!t.type||s.type===t.type)&&s.name===t.name?this.removeEventListener(s.type,s.listener,s.options):e[++r]=s;++r?e.length=r:delete this.__on}}}function Mu(t,e,n){return function(){var r=this.__on,i,s=Ou(e);if(r){for(var a=0,o=r.length;a<o;++a)if((i=r[a]).type===t.type&&i.name===t.name){this.removeEventListener(i.type,i.listener,i.options),this.addEventListener(i.type,i.listener=s,i.options=n),i.value=e;return}}this.addEventListener(t.type,s,n),i={type:t.type,name:t.name,value:e,listener:s,options:n},r?r.push(i):this.__on=[i]}}function Nu(t,e,n){var r=$u(t+""),i,s=r.length,a;if(arguments.length<2){var o=this.node().__on;if(o){for(var f=0,u=o.length,l;f<u;++f)for(i=0,l=o[f];i<s;++i)if((a=r[i]).type===l.type&&a.name===l.name)return l.value}return}for(o=e?Mu:Su,i=0;i<s;++i)this.each(o(r[i],e,n));return this}function Ki(t,e,n){var r=Wi(t),i=r.CustomEvent;typeof i=="function"?i=new i(e,n):(i=r.document.createEvent("Event"),n?(i.initEvent(e,n.bubbles,n.cancelable),i.detail=n.detail):i.initEvent(e,!1,!1)),t.dispatchEvent(i)}function Iu(t,e){return function(){return Ki(this,t,e)}}function ku(t,e){return function(){return Ki(this,t,e.apply(this,arguments))}}function Pu(t,e){return this.each((typeof e=="function"?ku:Iu)(t,e))}function*Bu(){for(var t=this._groups,e=0,n=t.length;e<n;++e)for(var r=t[e],i=0,s=r.length,a;i<s;++i)(a=r[i])&&(yield a)}var Du=[null];function pt(t,e){this._groups=t,this._parents=e}function Ee(){return new pt([[document.documentElement]],Du)}function Tu(){return this}pt.prototype=Ee.prototype={constructor:pt,select:so,selectAll:fo,selectChild:po,selectChildren:mo,filter:yo,data:Oo,enter:wo,exit:So,join:Mo,merge:No,selection:Tu,order:Io,sort:ko,call:Bo,nodes:Do,node:To,size:Ro,empty:Co,each:Fo,attr:zo,style:Ko,property:Qo,classed:ru,text:ou,html:cu,raise:du,lower:gu,append:vu,insert:mu,remove:wu,clone:Au,datum:Eu,on:Nu,dispatch:Pu,[Symbol.iterator]:Bu};function _r(t,e,n){t.prototype=e.prototype=n,n.constructor=t}function Ji(t,e){var n=Object.create(t.prototype);for(var r in e)n[r]=e[r];return n}function Oe(){}var we=.7,Je=1/we,ne="\\s*([+-]?\\d+)\\s*",xe="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",yt="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",Ru=/^#([0-9a-f]{3,8})$/,Cu=new RegExp(`^rgb\\(${ne},${ne},${ne}\\)$`),Fu=new RegExp(`^rgb\\(${yt},${yt},${yt}\\)$`),Lu=new RegExp(`^rgba\\(${ne},${ne},${ne},${xe}\\)$`),Uu=new RegExp(`^rgba\\(${yt},${yt},${yt},${xe}\\)$`),qu=new RegExp(`^hsl\\(${xe},${yt},${yt}\\)$`),Gu=new RegExp(`^hsla\\(${xe},${yt},${yt},${xe}\\)$`),Gr={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};_r(Oe,Rt,{copy(t){return Object.assign(new this.constructor,this,t)},displayable(){return this.rgb().displayable()},hex:Hr,formatHex:Hr,formatHex8:Hu,formatHsl:Wu,formatRgb:Wr,toString:Wr});function Hr(){return this.rgb().formatHex()}function Hu(){return this.rgb().formatHex8()}function Wu(){return Zi(this).formatHsl()}function Wr(){return this.rgb().formatRgb()}function Rt(t){var e,n;return t=(t+"").trim().toLowerCase(),(e=Ru.exec(t))?(n=e[1].length,e=parseInt(e[1],16),n===6?zr(e):n===3?new nt(e>>8&15|e>>4&240,e>>4&15|e&240,(e&15)<<4|e&15,1):n===8?Se(e>>24&255,e>>16&255,e>>8&255,(e&255)/255):n===4?Se(e>>12&15|e>>8&240,e>>8&15|e>>4&240,e>>4&15|e&240,((e&15)<<4|e&15)/255):null):(e=Cu.exec(t))?new nt(e[1],e[2],e[3],1):(e=Fu.exec(t))?new nt(e[1]*255/100,e[2]*255/100,e[3]*255/100,1):(e=Lu.exec(t))?Se(e[1],e[2],e[3],e[4]):(e=Uu.exec(t))?Se(e[1]*255/100,e[2]*255/100,e[3]*255/100,e[4]):(e=qu.exec(t))?Xr(e[1],e[2]/100,e[3]/100,1):(e=Gu.exec(t))?Xr(e[1],e[2]/100,e[3]/100,e[4]):Gr.hasOwnProperty(t)?zr(Gr[t]):t==="transparent"?new nt(NaN,NaN,NaN,0):null}function zr(t){return new nt(t>>16&255,t>>8&255,t&255,1)}function Se(t,e,n,r){return r<=0&&(t=e=n=NaN),new nt(t,e,n,r)}function zu(t){return t instanceof Oe||(t=Rt(t)),t?(t=t.rgb(),new nt(t.r,t.g,t.b,t.opacity)):new nt}function Ze(t,e,n,r){return arguments.length===1?zu(t):new nt(t,e,n,r??1)}function nt(t,e,n,r){this.r=+t,this.g=+e,this.b=+n,this.opacity=+r}_r(nt,Ze,Ji(Oe,{brighter(t){return t=t==null?Je:Math.pow(Je,t),new nt(this.r*t,this.g*t,this.b*t,this.opacity)},darker(t){return t=t==null?we:Math.pow(we,t),new nt(this.r*t,this.g*t,this.b*t,this.opacity)},rgb(){return this},clamp(){return new nt(Wt(this.r),Wt(this.g),Wt(this.b),je(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:Yr,formatHex:Yr,formatHex8:Yu,formatRgb:Vr,toString:Vr}));function Yr(){return`#${qt(this.r)}${qt(this.g)}${qt(this.b)}`}function Yu(){return`#${qt(this.r)}${qt(this.g)}${qt(this.b)}${qt((isNaN(this.opacity)?1:this.opacity)*255)}`}function Vr(){const t=je(this.opacity);return`${t===1?"rgb(":"rgba("}${Wt(this.r)}, ${Wt(this.g)}, ${Wt(this.b)}${t===1?")":`, ${t})`}`}function je(t){return isNaN(t)?1:Math.max(0,Math.min(1,t))}function Wt(t){return Math.max(0,Math.min(255,Math.round(t)||0))}function qt(t){return t=Wt(t),(t<16?"0":"")+t.toString(16)}function Xr(t,e,n,r){return r<=0?t=e=n=NaN:n<=0||n>=1?t=e=NaN:e<=0&&(t=NaN),new ct(t,e,n,r)}function Zi(t){if(t instanceof ct)return new ct(t.h,t.s,t.l,t.opacity);if(t instanceof Oe||(t=Rt(t)),!t)return new ct;if(t instanceof ct)return t;t=t.rgb();var e=t.r/255,n=t.g/255,r=t.b/255,i=Math.min(e,n,r),s=Math.max(e,n,r),a=NaN,o=s-i,f=(s+i)/2;return o?(e===s?a=(n-r)/o+(n<r)*6:n===s?a=(r-e)/o+2:a=(e-n)/o+4,o/=f<.5?s+i:2-s-i,a*=60):o=f>0&&f<1?0:a,new ct(a,o,f,t.opacity)}function Vu(t,e,n,r){return arguments.length===1?Zi(t):new ct(t,e,n,r??1)}function ct(t,e,n,r){this.h=+t,this.s=+e,this.l=+n,this.opacity=+r}_r(ct,Vu,Ji(Oe,{brighter(t){return t=t==null?Je:Math.pow(Je,t),new ct(this.h,this.s,this.l*t,this.opacity)},darker(t){return t=t==null?we:Math.pow(we,t),new ct(this.h,this.s,this.l*t,this.opacity)},rgb(){var t=this.h%360+(this.h<0)*360,e=isNaN(t)||isNaN(this.s)?0:this.s,n=this.l,r=n+(n<.5?n:1-n)*e,i=2*n-r;return new nt(bn(t>=240?t-240:t+120,i,r),bn(t,i,r),bn(t<120?t+240:t-120,i,r),this.opacity)},clamp(){return new ct(Kr(this.h),Me(this.s),Me(this.l),je(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const t=je(this.opacity);return`${t===1?"hsl(":"hsla("}${Kr(this.h)}, ${Me(this.s)*100}%, ${Me(this.l)*100}%${t===1?")":`, ${t})`}`}}));function Kr(t){return t=(t||0)%360,t<0?t+360:t}function Me(t){return Math.max(0,Math.min(1,t||0))}function bn(t,e,n){return(t<60?e+(n-e)*t/60:t<180?n:t<240?e+(n-e)*(240-t)/60:e)*255}function Xu(t,e,n,r,i){var s=t*t,a=s*t;return((1-3*t+3*s-a)*e+(4-6*s+3*a)*n+(1+3*t+3*s-3*a)*r+a*i)/6}function Ku(t){var e=t.length-1;return function(n){var r=n<=0?n=0:n>=1?(n=1,e-1):Math.floor(n*e),i=t[r],s=t[r+1],a=r>0?t[r-1]:2*i-s,o=r<e-1?t[r+2]:2*s-i;return Xu((n-r/e)*e,a,i,s,o)}}const mr=t=>()=>t;function Ju(t,e){return function(n){return t+n*e}}function Zu(t,e,n){return t=Math.pow(t,n),e=Math.pow(e,n)-t,n=1/n,function(r){return Math.pow(t+r*e,n)}}function ju(t){return(t=+t)==1?ji:function(e,n){return n-e?Zu(e,n,t):mr(isNaN(e)?n:e)}}function ji(t,e){var n=e-t;return n?Ju(t,n):mr(isNaN(t)?e:t)}const Qe=function t(e){var n=ju(e);function r(i,s){var a=n((i=Ze(i)).r,(s=Ze(s)).r),o=n(i.g,s.g),f=n(i.b,s.b),u=ji(i.opacity,s.opacity);return function(l){return i.r=a(l),i.g=o(l),i.b=f(l),i.opacity=u(l),i+""}}return r.gamma=t,r}(1);function Qu(t){return function(e){var n=e.length,r=new Array(n),i=new Array(n),s=new Array(n),a,o;for(a=0;a<n;++a)o=Ze(e[a]),r[a]=o.r||0,i[a]=o.g||0,s[a]=o.b||0;return r=t(r),i=t(i),s=t(s),o.opacity=1,function(f){return o.r=r(f),o.g=i(f),o.b=s(f),o+""}}}var tf=Qu(Ku);function ef(t,e){e||(e=[]);var n=t?Math.min(e.length,t.length):0,r=e.slice(),i;return function(s){for(i=0;i<n;++i)r[i]=t[i]*(1-s)+e[i]*s;return r}}function nf(t){return ArrayBuffer.isView(t)&&!(t instanceof DataView)}function rf(t,e){var n=e?e.length:0,r=t?Math.min(n,t.length):0,i=new Array(r),s=new Array(n),a;for(a=0;a<r;++a)i[a]=yr(t[a],e[a]);for(;a<n;++a)s[a]=e[a];return function(o){for(a=0;a<r;++a)s[a]=i[a](o);return s}}function sf(t,e){var n=new Date;return t=+t,e=+e,function(r){return n.setTime(t*(1-r)+e*r),n}}function ft(t,e){return t=+t,e=+e,function(n){return t*(1-n)+e*n}}function af(t,e){var n={},r={},i;(t===null||typeof t!="object")&&(t={}),(e===null||typeof e!="object")&&(e={});for(i in e)i in t?n[i]=yr(t[i],e[i]):r[i]=e[i];return function(s){for(i in n)r[i]=n[i](s);return r}}var Dn=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,An=new RegExp(Dn.source,"g");function of(t){return function(){return t}}function uf(t){return function(e){return t(e)+""}}function Qi(t,e){var n=Dn.lastIndex=An.lastIndex=0,r,i,s,a=-1,o=[],f=[];for(t=t+"",e=e+"";(r=Dn.exec(t))&&(i=An.exec(e));)(s=i.index)>n&&(s=e.slice(n,s),o[a]?o[a]+=s:o[++a]=s),(r=r[0])===(i=i[0])?o[a]?o[a]+=i:o[++a]=i:(o[++a]=null,f.push({i:a,x:ft(r,i)})),n=An.lastIndex;return n<e.length&&(s=e.slice(n),o[a]?o[a]+=s:o[++a]=s),o.length<2?f[0]?uf(f[0].x):of(e):(e=f.length,function(u){for(var l=0,h;l<e;++l)o[(h=f[l]).i]=h.x(u);return o.join("")})}function yr(t,e){var n=typeof e,r;return e==null||n==="boolean"?mr(e):(n==="number"?ft:n==="string"?(r=Rt(e))?(e=r,Qe):Qi:e instanceof Rt?Qe:e instanceof Date?sf:nf(e)?ef:Array.isArray(e)?rf:typeof e.valueOf!="function"&&typeof e.toString!="function"||isNaN(e)?af:ft)(t,e)}function ff(t,e){return t=+t,e=+e,function(n){return Math.round(t*(1-n)+e*n)}}var Jr=180/Math.PI,Tn={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function ts(t,e,n,r,i,s){var a,o,f;return(a=Math.sqrt(t*t+e*e))&&(t/=a,e/=a),(f=t*n+e*r)&&(n-=t*f,r-=e*f),(o=Math.sqrt(n*n+r*r))&&(n/=o,r/=o,f/=o),t*r<e*n&&(t=-t,e=-e,f=-f,a=-a),{translateX:i,translateY:s,rotate:Math.atan2(e,t)*Jr,skewX:Math.atan(f)*Jr,scaleX:a,scaleY:o}}var Ne;function lf(t){const e=new(typeof DOMMatrix=="function"?DOMMatrix:WebKitCSSMatrix)(t+"");return e.isIdentity?Tn:ts(e.a,e.b,e.c,e.d,e.e,e.f)}function cf(t){return t==null||(Ne||(Ne=document.createElementNS("http://www.w3.org/2000/svg","g")),Ne.setAttribute("transform",t),!(t=Ne.transform.baseVal.consolidate()))?Tn:(t=t.matrix,ts(t.a,t.b,t.c,t.d,t.e,t.f))}function es(t,e,n,r){function i(u){return u.length?u.pop()+" ":""}function s(u,l,h,c,d,p){if(u!==h||l!==c){var g=d.push("translate(",null,e,null,n);p.push({i:g-4,x:ft(u,h)},{i:g-2,x:ft(l,c)})}else(h||c)&&d.push("translate("+h+e+c+n)}function a(u,l,h,c){u!==l?(u-l>180?l+=360:l-u>180&&(u+=360),c.push({i:h.push(i(h)+"rotate(",null,r)-2,x:ft(u,l)})):l&&h.push(i(h)+"rotate("+l+r)}function o(u,l,h,c){u!==l?c.push({i:h.push(i(h)+"skewX(",null,r)-2,x:ft(u,l)}):l&&h.push(i(h)+"skewX("+l+r)}function f(u,l,h,c,d,p){if(u!==h||l!==c){var g=d.push(i(d)+"scale(",null,",",null,")");p.push({i:g-4,x:ft(u,h)},{i:g-2,x:ft(l,c)})}else(h!==1||c!==1)&&d.push(i(d)+"scale("+h+","+c+")")}return function(u,l){var h=[],c=[];return u=t(u),l=t(l),s(u.translateX,u.translateY,l.translateX,l.translateY,h,c),a(u.rotate,l.rotate,h,c),o(u.skewX,l.skewX,h,c),f(u.scaleX,u.scaleY,l.scaleX,l.scaleY,h,c),u=l=null,function(d){for(var p=-1,g=c.length,w;++p<g;)h[(w=c[p]).i]=w.x(d);return h.join("")}}}var hf=es(lf,"px, ","px)","deg)"),df=es(cf,", ",")",")"),ie=0,pe=0,ce=0,ns=1e3,tn,ge,en=0,Yt=0,_n=0,be=typeof performance=="object"&&performance.now?performance:Date,rs=typeof window=="object"&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(t){setTimeout(t,17)};function wr(){return Yt||(rs(pf),Yt=be.now()+_n)}function pf(){Yt=0}function nn(){this._call=this._time=this._next=null}nn.prototype=is.prototype={constructor:nn,restart:function(t,e,n){if(typeof t!="function")throw new TypeError("callback is not a function");n=(n==null?wr():+n)+(e==null?0:+e),!this._next&&ge!==this&&(ge?ge._next=this:tn=this,ge=this),this._call=t,this._time=n,Rn()},stop:function(){this._call&&(this._call=null,this._time=1/0,Rn())}};function is(t,e,n){var r=new nn;return r.restart(t,e,n),r}function gf(){wr(),++ie;for(var t=tn,e;t;)(e=Yt-t._time)>=0&&t._call.call(void 0,e),t=t._next;--ie}function Zr(){Yt=(en=be.now())+_n,ie=pe=0;try{gf()}finally{ie=0,_f(),Yt=0}}function vf(){var t=be.now(),e=t-en;e>ns&&(_n-=e,en=t)}function _f(){for(var t,e=tn,n,r=1/0;e;)e._call?(r>e._time&&(r=e._time),t=e,e=e._next):(n=e._next,e._next=null,e=t?t._next=n:tn=n);ge=t,Rn(r)}function Rn(t){if(!ie){pe&&(pe=clearTimeout(pe));var e=t-Yt;e>24?(t<1/0&&(pe=setTimeout(Zr,t-be.now()-_n)),ce&&(ce=clearInterval(ce))):(ce||(en=be.now(),ce=setInterval(vf,ns)),ie=1,rs(Zr))}}function jr(t,e,n){var r=new nn;return e=e==null?0:+e,r.restart(i=>{r.stop(),t(i+e)},e,n),r}var mf=Fi("start","end","cancel","interrupt"),yf=[],ss=0,Qr=1,Cn=2,Re=3,ti=4,Fn=5,Ce=6;function mn(t,e,n,r,i,s){var a=t.__transition;if(!a)t.__transition={};else if(n in a)return;wf(t,n,{name:e,index:r,group:i,on:mf,tween:yf,time:s.time,delay:s.delay,duration:s.duration,ease:s.ease,timer:null,state:ss})}function xr(t,e){var n=gt(t,e);if(n.state>ss)throw new Error("too late; already scheduled");return n}function Et(t,e){var n=gt(t,e);if(n.state>Re)throw new Error("too late; already running");return n}function gt(t,e){var n=t.__transition;if(!n||!(n=n[e]))throw new Error("transition not found");return n}function wf(t,e,n){var r=t.__transition,i;r[e]=n,n.timer=is(s,0,n.time);function s(u){n.state=Qr,n.timer.restart(a,n.delay,n.time),n.delay<=u&&a(u-n.delay)}function a(u){var l,h,c,d;if(n.state!==Qr)return f();for(l in r)if(d=r[l],d.name===n.name){if(d.state===Re)return jr(a);d.state===ti?(d.state=Ce,d.timer.stop(),d.on.call("interrupt",t,t.__data__,d.index,d.group),delete r[l]):+l<e&&(d.state=Ce,d.timer.stop(),d.on.call("cancel",t,t.__data__,d.index,d.group),delete r[l])}if(jr(function(){n.state===Re&&(n.state=ti,n.timer.restart(o,n.delay,n.time),o(u))}),n.state=Cn,n.on.call("start",t,t.__data__,n.index,n.group),n.state===Cn){for(n.state=Re,i=new Array(c=n.tween.length),l=0,h=-1;l<c;++l)(d=n.tween[l].value.call(t,t.__data__,n.index,n.group))&&(i[++h]=d);i.length=h+1}}function o(u){for(var l=u<n.duration?n.ease.call(null,u/n.duration):(n.timer.restart(f),n.state=Fn,1),h=-1,c=i.length;++h<c;)i[h].call(t,l);n.state===Fn&&(n.on.call("end",t,t.__data__,n.index,n.group),f())}function f(){n.state=Ce,n.timer.stop(),delete r[e];for(var u in r)return;delete t.__transition}}function xf(t,e){var n=t.__transition,r,i,s=!0,a;if(n){e=e==null?null:e+"";for(a in n){if((r=n[a]).name!==e){s=!1;continue}i=r.state>Cn&&r.state<Fn,r.state=Ce,r.timer.stop(),r.on.call(i?"interrupt":"cancel",t,t.__data__,r.index,r.group),delete n[a]}s&&delete t.__transition}}function bf(t){return this.each(function(){xf(this,t)})}function Af(t,e){var n,r;return function(){var i=Et(this,t),s=i.tween;if(s!==n){r=n=s;for(var a=0,o=r.length;a<o;++a)if(r[a].name===e){r=r.slice(),r.splice(a,1);break}}i.tween=r}}function Ef(t,e,n){var r,i;if(typeof n!="function")throw new Error;return function(){var s=Et(this,t),a=s.tween;if(a!==r){i=(r=a).slice();for(var o={name:e,value:n},f=0,u=i.length;f<u;++f)if(i[f].name===e){i[f]=o;break}f===u&&i.push(o)}s.tween=i}}function Of(t,e){var n=this._id;if(t+="",arguments.length<2){for(var r=gt(this.node(),n).tween,i=0,s=r.length,a;i<s;++i)if((a=r[i]).name===t)return a.value;return null}return this.each((e==null?Af:Ef)(n,t,e))}function br(t,e,n){var r=t._id;return t.each(function(){var i=Et(this,r);(i.value||(i.value={}))[e]=n.apply(this,arguments)}),function(i){return gt(i,r).value[e]}}function as(t,e){var n;return(typeof e=="number"?ft:e instanceof Rt?Qe:(n=Rt(e))?(e=n,Qe):Qi)(t,e)}function $f(t){return function(){this.removeAttribute(t)}}function Sf(t){return function(){this.removeAttributeNS(t.space,t.local)}}function Mf(t,e,n){var r,i=n+"",s;return function(){var a=this.getAttribute(t);return a===i?null:a===r?s:s=e(r=a,n)}}function Nf(t,e,n){var r,i=n+"",s;return function(){var a=this.getAttributeNS(t.space,t.local);return a===i?null:a===r?s:s=e(r=a,n)}}function If(t,e,n){var r,i,s;return function(){var a,o=n(this),f;return o==null?void this.removeAttribute(t):(a=this.getAttribute(t),f=o+"",a===f?null:a===r&&f===i?s:(i=f,s=e(r=a,o)))}}function kf(t,e,n){var r,i,s;return function(){var a,o=n(this),f;return o==null?void this.removeAttributeNS(t.space,t.local):(a=this.getAttributeNS(t.space,t.local),f=o+"",a===f?null:a===r&&f===i?s:(i=f,s=e(r=a,o)))}}function Pf(t,e){var n=vn(t),r=n==="transform"?df:as;return this.attrTween(t,typeof e=="function"?(n.local?kf:If)(n,r,br(this,"attr."+t,e)):e==null?(n.local?Sf:$f)(n):(n.local?Nf:Mf)(n,r,e))}function Bf(t,e){return function(n){this.setAttribute(t,e.call(this,n))}}function Df(t,e){return function(n){this.setAttributeNS(t.space,t.local,e.call(this,n))}}function Tf(t,e){var n,r;function i(){var s=e.apply(this,arguments);return s!==r&&(n=(r=s)&&Df(t,s)),n}return i._value=e,i}function Rf(t,e){var n,r;function i(){var s=e.apply(this,arguments);return s!==r&&(n=(r=s)&&Bf(t,s)),n}return i._value=e,i}function Cf(t,e){var n="attr."+t;if(arguments.length<2)return(n=this.tween(n))&&n._value;if(e==null)return this.tween(n,null);if(typeof e!="function")throw new Error;var r=vn(t);return this.tween(n,(r.local?Tf:Rf)(r,e))}function Ff(t,e){return function(){xr(this,t).delay=+e.apply(this,arguments)}}function Lf(t,e){return e=+e,function(){xr(this,t).delay=e}}function Uf(t){var e=this._id;return arguments.length?this.each((typeof t=="function"?Ff:Lf)(e,t)):gt(this.node(),e).delay}function qf(t,e){return function(){Et(this,t).duration=+e.apply(this,arguments)}}function Gf(t,e){return e=+e,function(){Et(this,t).duration=e}}function Hf(t){var e=this._id;return arguments.length?this.each((typeof t=="function"?qf:Gf)(e,t)):gt(this.node(),e).duration}function Wf(t,e){if(typeof e!="function")throw new Error;return function(){Et(this,t).ease=e}}function zf(t){var e=this._id;return arguments.length?this.each(Wf(e,t)):gt(this.node(),e).ease}function Yf(t,e){return function(){var n=e.apply(this,arguments);if(typeof n!="function")throw new Error;Et(this,t).ease=n}}function Vf(t){if(typeof t!="function")throw new Error;return this.each(Yf(this._id,t))}function Xf(t){typeof t!="function"&&(t=qi(t));for(var e=this._groups,n=e.length,r=new Array(n),i=0;i<n;++i)for(var s=e[i],a=s.length,o=r[i]=[],f,u=0;u<a;++u)(f=s[u])&&t.call(f,f.__data__,u,s)&&o.push(f);return new It(r,this._parents,this._name,this._id)}function Kf(t){if(t._id!==this._id)throw new Error;for(var e=this._groups,n=t._groups,r=e.length,i=n.length,s=Math.min(r,i),a=new Array(r),o=0;o<s;++o)for(var f=e[o],u=n[o],l=f.length,h=a[o]=new Array(l),c,d=0;d<l;++d)(c=f[d]||u[d])&&(h[d]=c);for(;o<r;++o)a[o]=e[o];return new It(a,this._parents,this._name,this._id)}function Jf(t){return(t+"").trim().split(/^|\s+/).every(function(e){var n=e.indexOf(".");return n>=0&&(e=e.slice(0,n)),!e||e==="start"})}function Zf(t,e,n){var r,i,s=Jf(e)?xr:Et;return function(){var a=s(this,t),o=a.on;o!==r&&(i=(r=o).copy()).on(e,n),a.on=i}}function jf(t,e){var n=this._id;return arguments.length<2?gt(this.node(),n).on.on(t):this.each(Zf(n,t,e))}function Qf(t){return function(){var e=this.parentNode;for(var n in this.__transition)if(+n!==t)return;e&&e.removeChild(this)}}function tl(){return this.on("end.remove",Qf(this._id))}function el(t){var e=this._name,n=this._id;typeof t!="function"&&(t=gr(t));for(var r=this._groups,i=r.length,s=new Array(i),a=0;a<i;++a)for(var o=r[a],f=o.length,u=s[a]=new Array(f),l,h,c=0;c<f;++c)(l=o[c])&&(h=t.call(l,l.__data__,c,o))&&("__data__"in l&&(h.__data__=l.__data__),u[c]=h,mn(u[c],e,n,c,u,gt(l,n)));return new It(s,this._parents,e,n)}function nl(t){var e=this._name,n=this._id;typeof t!="function"&&(t=Ui(t));for(var r=this._groups,i=r.length,s=[],a=[],o=0;o<i;++o)for(var f=r[o],u=f.length,l,h=0;h<u;++h)if(l=f[h]){for(var c=t.call(l,l.__data__,h,f),d,p=gt(l,n),g=0,w=c.length;g<w;++g)(d=c[g])&&mn(d,e,n,g,c,p);s.push(c),a.push(l)}return new It(s,a,e,n)}var rl=Ee.prototype.constructor;function il(){return new rl(this._groups,this._parents)}function sl(t,e){var n,r,i;return function(){var s=re(this,t),a=(this.style.removeProperty(t),re(this,t));return s===a?null:s===n&&a===r?i:i=e(n=s,r=a)}}function os(t){return function(){this.style.removeProperty(t)}}function al(t,e,n){var r,i=n+"",s;return function(){var a=re(this,t);return a===i?null:a===r?s:s=e(r=a,n)}}function ol(t,e,n){var r,i,s;return function(){var a=re(this,t),o=n(this),f=o+"";return o==null&&(f=o=(this.style.removeProperty(t),re(this,t))),a===f?null:a===r&&f===i?s:(i=f,s=e(r=a,o))}}function ul(t,e){var n,r,i,s="style."+e,a="end."+s,o;return function(){var f=Et(this,t),u=f.on,l=f.value[s]==null?o||(o=os(e)):void 0;(u!==n||i!==l)&&(r=(n=u).copy()).on(a,i=l),f.on=r}}function fl(t,e,n){var r=(t+="")=="transform"?hf:as;return e==null?this.styleTween(t,sl(t,r)).on("end.style."+t,os(t)):typeof e=="function"?this.styleTween(t,ol(t,r,br(this,"style."+t,e))).each(ul(this._id,t)):this.styleTween(t,al(t,r,e),n).on("end.style."+t,null)}function ll(t,e,n){return function(r){this.style.setProperty(t,e.call(this,r),n)}}function cl(t,e,n){var r,i;function s(){var a=e.apply(this,arguments);return a!==i&&(r=(i=a)&&ll(t,a,n)),r}return s._value=e,s}function hl(t,e,n){var r="style."+(t+="");if(arguments.length<2)return(r=this.tween(r))&&r._value;if(e==null)return this.tween(r,null);if(typeof e!="function")throw new Error;return this.tween(r,cl(t,e,n??""))}function dl(t){return function(){this.textContent=t}}function pl(t){return function(){var e=t(this);this.textContent=e??""}}function gl(t){return this.tween("text",typeof t=="function"?pl(br(this,"text",t)):dl(t==null?"":t+""))}function vl(t){return function(e){this.textContent=t.call(this,e)}}function _l(t){var e,n;function r(){var i=t.apply(this,arguments);return i!==n&&(e=(n=i)&&vl(i)),e}return r._value=t,r}function ml(t){var e="text";if(arguments.length<1)return(e=this.tween(e))&&e._value;if(t==null)return this.tween(e,null);if(typeof t!="function")throw new Error;return this.tween(e,_l(t))}function yl(){for(var t=this._name,e=this._id,n=us(),r=this._groups,i=r.length,s=0;s<i;++s)for(var a=r[s],o=a.length,f,u=0;u<o;++u)if(f=a[u]){var l=gt(f,e);mn(f,t,n,u,a,{time:l.time+l.delay+l.duration,delay:0,duration:l.duration,ease:l.ease})}return new It(r,this._parents,t,n)}function wl(){var t,e,n=this,r=n._id,i=n.size();return new Promise(function(s,a){var o={value:a},f={value:function(){--i===0&&s()}};n.each(function(){var u=Et(this,r),l=u.on;l!==t&&(e=(t=l).copy(),e._.cancel.push(o),e._.interrupt.push(o),e._.end.push(f)),u.on=e}),i===0&&s()})}var xl=0;function It(t,e,n,r){this._groups=t,this._parents=e,this._name=n,this._id=r}function us(){return++xl}var Ot=Ee.prototype;It.prototype={constructor:It,select:el,selectAll:nl,selectChild:Ot.selectChild,selectChildren:Ot.selectChildren,filter:Xf,merge:Kf,selection:il,transition:yl,call:Ot.call,nodes:Ot.nodes,node:Ot.node,size:Ot.size,empty:Ot.empty,each:Ot.each,on:jf,attr:Pf,attrTween:Cf,style:fl,styleTween:hl,text:gl,textTween:ml,remove:tl,tween:Of,delay:Uf,duration:Hf,ease:zf,easeVarying:Vf,end:wl,[Symbol.iterator]:Ot[Symbol.iterator]};function bl(t){return((t*=2)<=1?t*t*t:(t-=2)*t*t+2)/2}var Al={time:null,delay:0,duration:250,ease:bl};function El(t,e){for(var n;!(n=t.__transition)||!(n=n[e]);)if(!(t=t.parentNode))throw new Error(`transition ${e} not found`);return n}function Ol(t){var e,n;t instanceof It?(e=t._id,t=t._name):(e=us(),(n=Al).time=wr(),t=t==null?null:t+"");for(var r=this._groups,i=r.length,s=0;s<i;++s)for(var a=r[s],o=a.length,f,u=0;u<o;++u)(f=a[u])&&mn(f,t,e,u,a,n||El(f,e));return new It(r,this._parents,t,e)}Ee.prototype.interrupt=bf;Ee.prototype.transition=Ol;function $l(t){return Math.abs(t=Math.round(t))>=1e21?t.toLocaleString("en").replace(/,/g,""):t.toString(10)}function rn(t,e){if((n=(t=e?t.toExponential(e-1):t.toExponential()).indexOf("e"))<0)return null;var n,r=t.slice(0,n);return[r.length>1?r[0]+r.slice(2):r,+t.slice(n+1)]}function se(t){return t=rn(Math.abs(t)),t?t[1]:NaN}function Sl(t,e){return function(n,r){for(var i=n.length,s=[],a=0,o=t[0],f=0;i>0&&o>0&&(f+o+1>r&&(o=Math.max(1,r-f)),s.push(n.substring(i-=o,i+o)),!((f+=o+1)>r));)o=t[a=(a+1)%t.length];return s.reverse().join(e)}}function Ml(t){return function(e){return e.replace(/[0-9]/g,function(n){return t[+n]})}}var Nl=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function sn(t){if(!(e=Nl.exec(t)))throw new Error("invalid format: "+t);var e;return new Ar({fill:e[1],align:e[2],sign:e[3],symbol:e[4],zero:e[5],width:e[6],comma:e[7],precision:e[8]&&e[8].slice(1),trim:e[9],type:e[10]})}sn.prototype=Ar.prototype;function Ar(t){this.fill=t.fill===void 0?" ":t.fill+"",this.align=t.align===void 0?">":t.align+"",this.sign=t.sign===void 0?"-":t.sign+"",this.symbol=t.symbol===void 0?"":t.symbol+"",this.zero=!!t.zero,this.width=t.width===void 0?void 0:+t.width,this.comma=!!t.comma,this.precision=t.precision===void 0?void 0:+t.precision,this.trim=!!t.trim,this.type=t.type===void 0?"":t.type+""}Ar.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(this.width===void 0?"":Math.max(1,this.width|0))+(this.comma?",":"")+(this.precision===void 0?"":"."+Math.max(0,this.precision|0))+(this.trim?"~":"")+this.type};function Il(t){t:for(var e=t.length,n=1,r=-1,i;n<e;++n)switch(t[n]){case".":r=i=n;break;case"0":r===0&&(r=n),i=n;break;default:if(!+t[n])break t;r>0&&(r=0);break}return r>0?t.slice(0,r)+t.slice(i+1):t}var fs;function kl(t,e){var n=rn(t,e);if(!n)return t+"";var r=n[0],i=n[1],s=i-(fs=Math.max(-8,Math.min(8,Math.floor(i/3)))*3)+1,a=r.length;return s===a?r:s>a?r+new Array(s-a+1).join("0"):s>0?r.slice(0,s)+"."+r.slice(s):"0."+new Array(1-s).join("0")+rn(t,Math.max(0,e+s-1))[0]}function ei(t,e){var n=rn(t,e);if(!n)return t+"";var r=n[0],i=n[1];return i<0?"0."+new Array(-i).join("0")+r:r.length>i+1?r.slice(0,i+1)+"."+r.slice(i+1):r+new Array(i-r.length+2).join("0")}const ni={"%":(t,e)=>(t*100).toFixed(e),b:t=>Math.round(t).toString(2),c:t=>t+"",d:$l,e:(t,e)=>t.toExponential(e),f:(t,e)=>t.toFixed(e),g:(t,e)=>t.toPrecision(e),o:t=>Math.round(t).toString(8),p:(t,e)=>ei(t*100,e),r:ei,s:kl,X:t=>Math.round(t).toString(16).toUpperCase(),x:t=>Math.round(t).toString(16)};function ri(t){return t}var ii=Array.prototype.map,si=["y","z","a","f","p","n","µ","m","","k","M","G","T","P","E","Z","Y"];function Pl(t){var e=t.grouping===void 0||t.thousands===void 0?ri:Sl(ii.call(t.grouping,Number),t.thousands+""),n=t.currency===void 0?"":t.currency[0]+"",r=t.currency===void 0?"":t.currency[1]+"",i=t.decimal===void 0?".":t.decimal+"",s=t.numerals===void 0?ri:Ml(ii.call(t.numerals,String)),a=t.percent===void 0?"%":t.percent+"",o=t.minus===void 0?"−":t.minus+"",f=t.nan===void 0?"NaN":t.nan+"";function u(h){h=sn(h);var c=h.fill,d=h.align,p=h.sign,g=h.symbol,w=h.zero,I=h.width,M=h.comma,b=h.precision,A=h.trim,x=h.type;x==="n"?(M=!0,x="g"):ni[x]||(b===void 0&&(b=12),A=!0,x="g"),(w||c==="0"&&d==="=")&&(w=!0,c="0",d="=");var q=g==="$"?n:g==="#"&&/[boxX]/.test(x)?"0"+x.toLowerCase():"",G=g==="$"?r:/[%p]/.test(x)?a:"",E=ni[x],N=/[defgprs%]/.test(x);b=b===void 0?6:/[gprs]/.test(x)?Math.max(1,Math.min(21,b)):Math.max(0,Math.min(20,b));function F(_){var T=q,P=G,L,J,v;if(x==="c")P=E(_)+P,_="";else{_=+_;var y=_<0||1/_<0;if(_=isNaN(_)?f:E(Math.abs(_),b),A&&(_=Il(_)),y&&+_==0&&p!=="+"&&(y=!1),T=(y?p==="("?p:o:p==="-"||p==="("?"":p)+T,P=(x==="s"?si[8+fs/3]:"")+P+(y&&p==="("?")":""),N){for(L=-1,J=_.length;++L<J;)if(v=_.charCodeAt(L),48>v||v>57){P=(v===46?i+_.slice(L+1):_.slice(L))+P,_=_.slice(0,L);break}}}M&&!w&&(_=e(_,1/0));var $=T.length+_.length+P.length,S=$<I?new Array(I-$+1).join(c):"";switch(M&&w&&(_=e(S+_,S.length?I-P.length:1/0),S=""),d){case"<":_=T+_+P+S;break;case"=":_=T+S+_+P;break;case"^":_=S.slice(0,$=S.length>>1)+T+_+P+S.slice($);break;default:_=S+T+_+P;break}return s(_)}return F.toString=function(){return h+""},F}function l(h,c){var d=u((h=sn(h),h.type="f",h)),p=Math.max(-8,Math.min(8,Math.floor(se(c)/3)))*3,g=Math.pow(10,-p),w=si[8+p/3];return function(I){return d(g*I)+w}}return{format:u,formatPrefix:l}}var Ie,ls,cs;Bl({thousands:",",grouping:[3],currency:["$",""]});function Bl(t){return Ie=Pl(t),ls=Ie.format,cs=Ie.formatPrefix,Ie}function Dl(t){return Math.max(0,-se(Math.abs(t)))}function Tl(t,e){return Math.max(0,Math.max(-8,Math.min(8,Math.floor(se(e)/3)))*3-se(Math.abs(t)))}function Rl(t,e){return t=Math.abs(t),e=Math.abs(e)-t,Math.max(0,se(e)-se(t))+1}function Cl(t,e){switch(arguments.length){case 0:break;case 1:this.range(t);break;default:this.range(e).domain(t);break}return this}function Fl(t){return function(){return t}}function Ll(t){return+t}var ai=[0,1];function Qt(t){return t}function Ln(t,e){return(e-=t=+t)?function(n){return(n-t)/e}:Fl(isNaN(e)?NaN:.5)}function Ul(t,e){var n;return t>e&&(n=t,t=e,e=n),function(r){return Math.max(t,Math.min(e,r))}}function ql(t,e,n){var r=t[0],i=t[1],s=e[0],a=e[1];return i<r?(r=Ln(i,r),s=n(a,s)):(r=Ln(r,i),s=n(s,a)),function(o){return s(r(o))}}function Gl(t,e,n){var r=Math.min(t.length,e.length)-1,i=new Array(r),s=new Array(r),a=-1;for(t[r]<t[0]&&(t=t.slice().reverse(),e=e.slice().reverse());++a<r;)i[a]=Ln(t[a],t[a+1]),s[a]=n(e[a],e[a+1]);return function(o){var f=Va(t,o,1,r)-1;return s[f](i[f](o))}}function Hl(t,e){return e.domain(t.domain()).range(t.range()).interpolate(t.interpolate()).clamp(t.clamp()).unknown(t.unknown())}function Wl(){var t=ai,e=ai,n=yr,r,i,s,a=Qt,o,f,u;function l(){var c=Math.min(t.length,e.length);return a!==Qt&&(a=Ul(t[0],t[c-1])),o=c>2?Gl:ql,f=u=null,h}function h(c){return c==null||isNaN(c=+c)?s:(f||(f=o(t.map(r),e,n)))(r(a(c)))}return h.invert=function(c){return a(i((u||(u=o(e,t.map(r),ft)))(c)))},h.domain=function(c){return arguments.length?(t=Array.from(c,Ll),l()):t.slice()},h.range=function(c){return arguments.length?(e=Array.from(c),l()):e.slice()},h.rangeRound=function(c){return e=Array.from(c),n=ff,l()},h.clamp=function(c){return arguments.length?(a=c?!0:Qt,l()):a!==Qt},h.interpolate=function(c){return arguments.length?(n=c,l()):n},h.unknown=function(c){return arguments.length?(s=c,h):s},function(c,d){return r=c,i=d,l()}}function zl(){return Wl()(Qt,Qt)}function Yl(t,e,n,r){var i=ja(t,e,n),s;switch(r=sn(r??",f"),r.type){case"s":{var a=Math.max(Math.abs(t),Math.abs(e));return r.precision==null&&!isNaN(s=Tl(i,a))&&(r.precision=s),cs(r,a)}case"":case"e":case"g":case"p":case"r":{r.precision==null&&!isNaN(s=Rl(i,Math.max(Math.abs(t),Math.abs(e))))&&(r.precision=s-(r.type==="e"));break}case"f":case"%":{r.precision==null&&!isNaN(s=Dl(i))&&(r.precision=s-(r.type==="%")*2);break}}return ls(r)}function Vl(t){var e=t.domain;return t.ticks=function(n){var r=e();return Za(r[0],r[r.length-1],n??10)},t.tickFormat=function(n,r){var i=e();return Yl(i[0],i[i.length-1],n??10,r)},t.nice=function(n){n==null&&(n=10);var r=e(),i=0,s=r.length-1,a=r[i],o=r[s],f,u,l=10;for(o<a&&(u=a,a=o,o=u,u=i,i=s,s=u);l-- >0;){if(u=Pn(a,o,n),u===f)return r[i]=a,r[s]=o,e(r);if(u>0)a=Math.floor(a/u)*u,o=Math.ceil(o/u)*u;else if(u<0)a=Math.ceil(a*u)/u,o=Math.floor(o*u)/u;else break;f=u}return t},t}function an(){var t=zl();return t.copy=function(){return Hl(t,an())},Cl.apply(t,arguments),Vl(t)}function hs(t){for(var e=t.length/6|0,n=new Array(e),r=0;r<e;)n[r]="#"+t.slice(r*6,++r*6);return n}const Xl=hs("1f77b4ff7f0e2ca02cd627289467bd8c564be377c27f7f7fbcbd2217becf"),Kl=t=>tf(t[t.length-1]);var Jl=new Array(3).concat("f0f0f0bdbdbd636363","f7f7f7cccccc969696525252","f7f7f7cccccc969696636363252525","f7f7f7d9d9d9bdbdbd969696636363252525","f7f7f7d9d9d9bdbdbd969696737373525252252525","fffffff0f0f0d9d9d9bdbdbd969696737373525252252525","fffffff0f0f0d9d9d9bdbdbd969696737373525252252525000000").map(hs);const Zl=Kl(Jl);function ve(t,e,n){this.k=t,this.x=e,this.y=n}ve.prototype={constructor:ve,scale:function(t){return t===1?this:new ve(this.k*t,this.x,this.y)},translate:function(t,e){return t===0&e===0?this:new ve(this.k,this.x+this.k*t,this.y+this.k*e)},apply:function(t){return[t[0]*this.k+this.x,t[1]*this.k+this.y]},applyX:function(t){return t*this.k+this.x},applyY:function(t){return t*this.k+this.y},invert:function(t){return[(t[0]-this.x)/this.k,(t[1]-this.y)/this.k]},invertX:function(t){return(t-this.x)/this.k},invertY:function(t){return(t-this.y)/this.k},rescaleX:function(t){return t.copy().domain(t.range().map(this.invertX,this).map(t.invert,t))},rescaleY:function(t){return t.copy().domain(t.range().map(this.invertY,this).map(t.invert,t))},toString:function(){return"translate("+this.x+","+this.y+") scale("+this.k+")"}};ve.prototype;var jl=Pi('<line stroke="black"></line>'),Ql=Pi('<!><circle fill="black"></circle><text> </text>',1),tc=At('<div><div>Loss History</div> <div><svg style="overflow: visible; outline: 1px solid black;"><!></svg></div></div>');function ec(t,e){un(e,!1);const n=st(),r=st();let i=it(e,"height",8,250),s=it(e,"width",8,500),a=it(e,"loss",24,()=>[]);function o(d){if(d.length===0)return 0;let p=d[0];for(let g=0;g<d.length;g++)d[g]>p&&(p=d[g]);return p}Ue(()=>(Ut(a()),Ut(s())),()=>{D(n,an().domain([0,a().length-1]).range([0,s()]))}),Ue(()=>(Ut(a()),Ut(i())),()=>{D(r,an().domain([0,o(a())]).range([i(),0]))}),wi(),tr();var f=tc(),u=vt(lt(f),2),l=lt(u),h=lt(l);{var c=d=>{var p=Ql(),g=ke(p);Di(g,1,()=>({length:a().length-1}),Bi,(b,A,x)=>{var q=jl();const G=_t(()=>x),E=_t(()=>x+1),N=_t(()=>a()[m(G)]),F=_t(()=>a()[m(E)]);V(q,"stroke-width",2),Ht((_,T,P,L)=>{V(q,"x1",_),V(q,"x2",T),V(q,"y1",P),V(q,"y2",L)},[()=>m(n)(m(G)),()=>m(n)(m(E)),()=>m(r)(m(N)),()=>m(r)(m(F))],_t),ot(b,q)});var w=vt(g);V(w,"r",4);var I=vt(w),M=lt(I);Ht((b,A)=>{V(w,"cx",s()),V(w,"cy",b),V(I,"x",s()+4),V(I,"y",b),kn(M,A)},[()=>m(r)(a().at(-1)),()=>a().at(-1).toFixed(5)],_t),ot(d,p)};Ft(h,d=>{a().length>0&&d(c)})}Ht(()=>{V(l,"width",s()),V(l,"height",i())}),ot(t,f),fn()}const nc=(t,e,n,r)=>t[e*n+r],rc=(t,e,n,r,i,s)=>{t.beginPath(),t.rect(i,s,n,n),t.fillStyle=e(r),t.fill()},ic=(t,e,n,r,i,{xOffset:s=0,yOffset:a=0}={})=>{const o=e/n;for(let f=0;f<n;f++)for(let u=0;u<n;u++){const l=nc(i,n,f,u),h=o+1,c=u*o+s,d=f*o+a;rc(t,r,h,l,c,d)}};var sc=At("<div><canvas></canvas></div>");function ac(t,e){un(e,!1);let n=it(e,"style",8,"");function r(N){const F=new Float32Array(N.length);for(let _=0;_<N.length;_++)F[_]=N[_];return F}let i=it(e,"enableDrawing",8,!1),s=it(e,"data",8),a=st(),o=it(e,"onChange",8,N=>{}),f=it(e,"square",8,250),u=it(e,"dim",8,28),l=it(e,"width",24,f),h=it(e,"height",24,f),c=st(),d=st(),p=it(e,"maxVal",8,255),g=it(e,"range",24,()=>[1,0]),w=an().domain([0,p()]).range(g());const I=N=>Zl(w(N)),M=N=>{m(d).clearRect(0,0,f(),f()),ic(m(d),l(),u(),I,N)};Ti(()=>{D(d,m(c).getContext("2d"))});let b=st(!1),A=st([0,0]);function x(N,F,_,T,P){const L=[[.1,.2,.1],[.2,.4,.2],[.1,.2,.1]],J=[[[-1,-1],[0,-1],[1,-1]],[[-1,0],[0,0],[1,0]],[[-1,1],[0,1],[1,1]]];for(let v=0;v<L.length;v++)t:for(let y=0;y<L[0].length;y++){const $=L[v][y],[S,W]=J[v][y],z=F+S,Y=_+W;if(z<0||Y<0||Y>=T||z>=T)continue t;const Xt=z*P,ut=Y*P;m(d).fillRect(Xt,ut,P,P),Vs(d,m(d).fillStyle=Rt(`hsla(0, 0%, 255%, ${$})`)),N[z*T+Y]+=$,N[z*T+Y]=Math.min(1,N[z*T+Y])}o()(N)}function q(N,F,_,T){const P=F/_;for(let L=0;L<_;L++)for(let J=0;J<_;J++){const v=J*P,y=L*P,$=T[0]>=v&&T[0]<=v+P,S=T[1]>=y&&T[1]<=y+P;if($&&S){x(m(a),L,J,_,P);return}}}Ue(()=>Ut(s()),()=>{s()&&D(a,r(s()))}),Ue(()=>(Ut(s()),m(d)),()=>{s()&&m(d)&&M(s())}),wi(),tr();var G=sc(),E=lt(G);Ma(E,N=>D(c,N),()=>m(c)),Ht(()=>{V(G,"style",n()),V(E,"width",l()),V(E,"height",h())}),Be("mousedown",E,()=>{D(b,!0)}),Be("mouseup",E,()=>{D(b,!1)}),Be("mousemove",E,({offsetX:N,offsetY:F})=>{m(b)&&i()&&(D(A,[N,F]),q(m(d),l(),u(),m(A)))}),ot(t,G),fn()}var oc=At("<div>Loading MNIST Test 10k data...</div>"),uc=At("<div> </div>"),fc=At("<div>Training MLP on MNIST 10k Images</div>"),lc=At("<div></div>"),cc=At('<div> </div> <div style="width: 300px;"></div>',1),hc=At("<div><button>Clear</button></div> <div><!></div> <!>",1),dc=At("<!> <!> <!> <div><!></div> <!>",1);function pc(t,e){un(e,!1);let n=st(!1);async function r(){D(n,!0);const y=await(await fetch("mnist_test.json")).json(),$=y.x,S=y.y;return D(n,!1),[$,S]}function i(v,y){const W=Bt.tensor(O.randn([v,y],0,.1),!0),z=Bt.tensor(O.randn([1,y],0,.1),!0);return[W,z]}function s(v,y=[728,128],$=32,S=10){let W=[];for(let Z=0;Z<y.length-1;Z++){const[j,Kt]=i(y[Z],y[Z+1]);W.push(j),W.push(Kt),v=v.matmul(j).add(Kt.expand([$,y[Z+1]])).relu()}const[z,Y]=i(y.at(-1),S);return W.push(z),W.push(Y),[v.matmul(z).add(Y.expand([$,S])).softmax(-1),W]}function a(v,y,$=32){return v.log().mul(y).sum(-1).sum(0).mul(-1/$)}function o(v){const y=new Float32Array(v.length*v[0].length);for(let $=0;$<v.length;$++)for(let S=0;S<v[0].length;S++)y[$*v[0].length+S]=v[$][S];return y}const f=64,u=.1,l=10;let h=st([]),c=st(),d=st(!1),p,g;Ti(async()=>{const y=await(await navigator.gpu.requestAdapter()).requestDevice();D(c,{vendor:y.adapterInfo.vendor,architecture:y.adapterInfo.architecture}),O.setDevice(y);const[$,S]=await r();g=Bt.tensor(O.fill(1,[f,28*28]));let W;[p,W]=s(g,[28*28,256,128],f);const z=Bt.tensor(O.fill(1,[f,10])),Y=a(p,z,f),Xt=new Ga(W,u),ut=(Z,j)=>o(Z.slice(j,j+f));for(let Z=0;Z<l;Z++){console.log("EPOCH"+(Z+1));for(let j=0;j<$.length-f;j+=f)if(g.tensor.setGPUBuffer(ut($,j)),z.tensor.setGPUBuffer(ut(S,j)),Y.forward(),Y.zeroGrad(),Y.backward(),Xt.update(),j%10===0){const Kt=await Y.tensor.cpuBuffer();m(h).push(Kt[0]),D(h,m(h))}}D(d,!0)});let w=st(new Float32Array(28*28).fill(0)),I=0,M=st();async function b(v,y=5){D(w,v),I%y===0&&p&&g&&(g.tensor.setGPUBuffer(m(w)),p.forward(),D(M,(await p.tensor.cpuBuffer()).slice(0,10))),I++}function A(v){let y=0,$=v[y];for(let S=0;S<v.length;S++)v[S]>$&&($=v[S],y=S);return y}tr();var x=dc(),q=ke(x);{var G=v=>{var y=oc();ot(v,y)};Ft(q,v=>{m(n)&&v(G)})}var E=vt(q,2);{var N=v=>{var y=uc(),$=lt(y);Ht(S=>kn($,`Running on ${S??""}`),[()=>JSON.stringify(m(c),null,4)],_t),ot(v,y)};Ft(E,v=>{m(c)&&v(N)})}var F=vt(E,2);{var _=v=>{var y=fc();ot(v,y)};Ft(F,v=>{!m(n)&&!m(d)&&v(_)})}var T=vt(F,2),P=lt(T);ec(P,{get loss(){return m(h)}});var L=vt(T,2);{var J=v=>{var y=hc(),$=ke(y),S=lt($),W=vt($,2),z=lt(W);ac(z,{get data(){return m(w)},maxVal:1,enableDrawing:!0,onChange:async ut=>await b(ut)});var Y=vt(W,2);{var Xt=ut=>{var Z=cc(),j=ke(Z),Kt=lt(j),ds=vt(j,2);Di(ds,5,()=>m(M),Bi,(yn,ps,Er)=>{var wn=lc();wn.textContent=Er,Ht(()=>V(wn,"style",`width: ${m(ps)*300}px; height: 20px; background: ${Xl[Er]??""};`)),ot(yn,wn)}),Ht(yn=>kn(Kt,`Predicted Digit: ${yn??""}`),[()=>A(m(M))],_t),ot(ut,Z)};Ft(Y,ut=>{m(M)&&ut(Xt)})}Be("click",S,()=>{D(M,void 0),D(w,new Float32Array(784).fill(0))}),ot(v,y)};Ft(L,v=>{m(d)&&v(J)})}ot(t,x),fn()}var gc=At("<main><!></main>");function vc(t){var e=gc(),n=lt(e);{var r=i=>{pc(i,{})};Ft(n,i=>{i(r)})}ot(t,e)}wa(vc,{target:document.getElementById("app")});
